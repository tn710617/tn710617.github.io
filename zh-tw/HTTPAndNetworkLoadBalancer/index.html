<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>設定 Network 以及 HTTP 平衡負載器 - Ray&#39;s Coding Journey</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="前言本篇主要是利用 Google 的 Qwiklab 平台學習的同時，做的一份學習筆記  本篇將會做什麼？ 設定一個網路平衡負載器 設定一個 HTTP(S) 平衡負載器 通過實作，學習兩者之間的不同之處">
<meta name="keywords" content="GCP Essentials,QWIKLABS,Google Load Baalancers">
<meta property="og:type" content="article">
<meta property="og:title" content="設定 Network 以及 HTTP 平衡負載器">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/HTTPAndNetworkLoadBalancer/index.html">
<meta property="og:site_name" content="Ray&#39;s Coding Journey">
<meta property="og:description" content="前言本篇主要是利用 Google 的 Qwiklab 平台學習的同時，做的一份學習筆記  本篇將會做什麼？ 設定一個網路平衡負載器 設定一個 HTTP(S) 平衡負載器 通過實作，學習兩者之間的不同之處">
<meta property="og:locale" content="zh-tw">
<meta property="og:image" content="https://i.imgur.com/G0Y8mi6.png">
<meta property="og:image" content="https://i.imgur.com/Zqb6UpU.png">
<meta property="og:image" content="https://i.imgur.com/Y02cj2y.png">
<meta property="og:image" content="https://i.imgur.com/Oada6gU.png">
<meta property="og:image" content="https://i.imgur.com/XRCkS9j.png">
<meta property="og:image" content="https://i.imgur.com/QStCZUo.png">
<meta property="og:updated_time" content="2019-08-25T07:39:01.796Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="設定 Network 以及 HTTP 平衡負載器">
<meta name="twitter:description" content="前言本篇主要是利用 Google 的 Qwiklab 平台學習的同時，做的一份學習筆記  本篇將會做什麼？ 設定一個網路平衡負載器 設定一個 HTTP(S) 平衡負載器 通過實作，學習兩者之間的不同之處">
<meta name="twitter:image" content="https://i.imgur.com/G0Y8mi6.png">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


    <link href="/HTTPAndNetworkLoadBalancer/" rel="alternate" hreflang="en">








    <meta name="description" content="前言本篇主要是利用 Google 的 Qwiklab 平台學習的同時，做的一份學習筆記  本篇將會做什麼？ 設定一個網路平衡負載器 設定一個 HTTP(S) 平衡負載器 通過實作，學習兩者之間的不同之處">
<meta name="keywords" content="GCP Essentials,QWIKLABS,Google Load Baalancers">
<meta property="og:type" content="article">
<meta property="og:title" content="設定 Network 以及 HTTP 平衡負載器">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/HTTPAndNetworkLoadBalancer/index.html">
<meta property="og:site_name" content="Ray&#39;s Coding Journey">
<meta property="og:description" content="前言本篇主要是利用 Google 的 Qwiklab 平台學習的同時，做的一份學習筆記  本篇將會做什麼？ 設定一個網路平衡負載器 設定一個 HTTP(S) 平衡負載器 通過實作，學習兩者之間的不同之處">
<meta property="og:locale" content="zh-tw">
<meta property="og:image" content="https://i.imgur.com/G0Y8mi6.png">
<meta property="og:image" content="https://i.imgur.com/Zqb6UpU.png">
<meta property="og:image" content="https://i.imgur.com/Y02cj2y.png">
<meta property="og:image" content="https://i.imgur.com/Oada6gU.png">
<meta property="og:image" content="https://i.imgur.com/XRCkS9j.png">
<meta property="og:image" content="https://i.imgur.com/QStCZUo.png">
<meta property="og:updated_time" content="2019-08-25T07:39:01.796Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="設定 Network 以及 HTTP 平衡負載器">
<meta name="twitter:description" content="前言本篇主要是利用 Google 的 Qwiklab 平台學習的同時，做的一份學習筆記  本篇將會做什麼？ 設定一個網路平衡負載器 設定一個 HTTP(S) 平衡負載器 通過實作，學習兩者之間的不同之處">
<meta name="twitter:image" content="https://i.imgur.com/G0Y8mi6.png">





    <link rel="icon" href="/images/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/sunburst.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
        
    
        
    
        
    
        
    
        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135063928-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-135063928-1');
</script>


    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/zh-tw">
                
                    
                    Ray&#39;s Coding Journey
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/zh-tw/archives">歸檔</a>
            
            <a class="navbar-item " href="/zh-tw/categories">分類</a>
            
            <a class="navbar-item " href="/zh-tw/tags">標籤</a>
            
            <a class="navbar-item " href="/zh-tw/schedule">行程</a>
            
            <a class="navbar-item " href="/zh-tw/about">關於</a>
            
            <a class="navbar-item " href="/zh-tw/friends">好友</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜尋" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="目錄">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#前言">1&nbsp;&nbsp;<b>前言</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#本篇將會做什麼？">2&nbsp;&nbsp;<b>本篇將會做什麼？</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#設定及要求">3&nbsp;&nbsp;<b>設定及要求</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#需熟悉-Linux-內建的編輯器，像是-vim-emacs-或是nano">3.1&nbsp;&nbsp;需熟悉 Linux 內建的編輯器，像是 vim , emacs, 或是nano</a>
                    
                    
                    
                    <a class="navbar-item" href="#Qwiklabs-setup">3.2&nbsp;&nbsp;Qwiklabs setup</a>
                    
                    
                    
                    <a class="navbar-item" href="#在你按下-Start-Lab-按鈕之前">3.2.1&nbsp;&nbsp;在你按下 Start Lab 按鈕之前</a>
                    
                    
                    
                    <a class="navbar-item" href="#你需要什麼？">3.2.2&nbsp;&nbsp;你需要什麼？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Google-Cloud-Platform-Console">3.3&nbsp;&nbsp;Google Cloud Platform Console</a>
                    
                    
                    
                    <a class="navbar-item" href="#如何開始你的-lab-，然後登入-Console">3.3.1&nbsp;&nbsp;如何開始你的 lab ，然後登入 Console?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Cloud-Shell">3.4&nbsp;&nbsp;Cloud Shell</a>
                    
                    
                    
                    <a class="navbar-item" href="#啟動-Google-Cloud-Shell">3.4.1&nbsp;&nbsp;啟動 Google Cloud Shell</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#為你的資源設定預設的-region-以及-zone">4&nbsp;&nbsp;<b>為你的資源設定預設的 region 以及 zone</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#建立多個-web-server-instance">5&nbsp;&nbsp;<b>建立多個 web server instance</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#建立Network-Load-Balancer">6&nbsp;&nbsp;<b>建立Network Load Balancer</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#建立一個-HTTP-S-Load-Balancer">7&nbsp;&nbsp;<b>建立一個 HTTP(S) Load Balancer</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#考考你">8&nbsp;&nbsp;<b>考考你</b></a>
                    
                </div>
            </div>
            

            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true" aria-controls="dropdown-menu7">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>繁體中文</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            
                <a href="/HTTPAndNetworkLoadBalancer/" class="dropdown-item">
                    English
                </a>
            
                <a href="/zh-tw/HTTPAndNetworkLoadBalancer/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            設定 Network 以及 HTTP 平衡負載器
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-02-19T07:57:05.000Z" itemprop="datePublished">2月 19 2019</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/zh-tw/categories/GCP/">GCP</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            15 分钟 讀完 (大概 2238 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><br>本篇主要是利用 Google 的 Qwiklab 平台學習的同時，做的一份學習筆記<br></p>

<h2 id="本篇將會做什麼？"><a href="#本篇將會做什麼？" class="headerlink" title="本篇將會做什麼？"></a>本篇將會做什麼？</h2><ul>
<li>設定一個網路平衡負載器</li>
<li>設定一個 HTTP(S) 平衡負載器</li>
<li>通過實作，學習兩者之間的不同之處</li>
</ul>
<a id="more"></a> 
<h2 id="設定及要求"><a href="#設定及要求" class="headerlink" title="設定及要求"></a>設定及要求</h2><h3 id="需熟悉-Linux-內建的編輯器，像是-vim-emacs-或是nano"><a href="#需熟悉-Linux-內建的編輯器，像是-vim-emacs-或是nano" class="headerlink" title="需熟悉 Linux 內建的編輯器，像是 vim , emacs, 或是nano"></a>需熟悉 Linux 內建的編輯器，像是 vim , emacs, 或是nano</h3><h3 id="Qwiklabs-setup"><a href="#Qwiklabs-setup" class="headerlink" title="Qwiklabs setup"></a>Qwiklabs setup</h3><h4 id="在你按下-Start-Lab-按鈕之前"><a href="#在你按下-Start-Lab-按鈕之前" class="headerlink" title="在你按下 Start Lab 按鈕之前"></a>在你按下 Start Lab 按鈕之前</h4><p>詳讀所有的教學。Labs 是有時間限制的，而且你不可以停止時間倒數。倒數計時器在你按下 Start Lab 按鈕後開始倒數，上面顯示的時間為你還能使用 Cloud 資源的時間。</p>
<p>Quiklabs 的手把手環境，讓你可以在真實環境中來操作進行 Quiclabs 上提供的課程，而不是在一個模擬或是展示的環境。我們透過提供你一個全新的、暫時的帳號密碼，在計時器歸零之前，你可以用來登入並存取 Google Cloud Platform。</p>
<h4 id="你需要什麼？"><a href="#你需要什麼？" class="headerlink" title="你需要什麼？"></a>你需要什麼？</h4><p>要完成這個 lab ，你需要:</p>
<ul>
<li>一個一般的網路瀏覽器（推薦 Chrome）</li>
<li>完成這個 lab 的時間</li>
</ul>
<p>備註： 如果你已經有你自己的個人 GCP 帳號或專案，請不要使用在這一個 lab</p>
<h3 id="Google-Cloud-Platform-Console"><a href="#Google-Cloud-Platform-Console" class="headerlink" title="Google Cloud Platform Console"></a>Google Cloud Platform Console</h3><h4 id="如何開始你的-lab-，然後登入-Console"><a href="#如何開始你的-lab-，然後登入-Console" class="headerlink" title="如何開始你的 lab ，然後登入 Console?"></a>如何開始你的 lab ，然後登入 Console?</h4><ol>
<li>按下 Start Lab 按鈕。如果你需要付費，會有一個彈出視窗來讓你選擇付費的方式。在左方你會看到一個面板，上面有暫時的帳號密碼，你必須使用這些帳號密碼在此次 lab</li>
</ol>
<p><img src="https://i.imgur.com/G0Y8mi6.png" alt></p>
<ol start="2">
<li>複製 <code>username</code> , 然後點擊 <code>Open Google Console</code>。 Lab 會開啟另外一個視窗，顯示<code>選擇帳號</code>的頁面</li>
</ol>
<p>tip: 開啟一個全新的視窗，然後跟原本的頁面並排</p>
<ol start="3">
<li>在<code>選擇帳號</code>頁面, 點擊 <code>Use Another Account</code></li>
</ol>
<p><img src="https://i.imgur.com/Zqb6UpU.png" alt></p>
<ol start="4">
<li>登入頁面開啟，貼上之前複製的 <code>username</code> 以及 <code>password</code> ，然後貼上</li>
</ol>
<p>重要：必須使用之前於 <code>Connection Details 面板</code> 取得的帳號密碼，不要使用你自己的 Qwiklabs 帳號密碼。 如果你有自己的 GCP 帳號，請不要用在這裡（避免產生費用）</p>
<ol start="5">
<li>點擊並通過接下來的頁面:<ul>
<li>接受<code>terms</code>以及<code>conditions</code></li>
<li>不要增加<code>recovery optoins</code> 或 <code>two factor authentication</code> (因為這只是一個臨時帳號)</li>
<li>不要註冊免費體驗</li>
</ul>
</li>
</ol>
<p>稍待一些時候， GCP 控制台將會在這個視窗開啟。</p>
<p>注意：按下左上方位於<code>Google Cloud Platform</code> 隔壁的 <code>Navigation menu</code> ，你可以瀏覽選單，裡面有一系列的 GCP 產品以及服務</p>
<p><img src="https://i.imgur.com/Y02cj2y.png" alt></p>
<h3 id="Cloud-Shell"><a href="#Cloud-Shell" class="headerlink" title="Cloud Shell"></a>Cloud Shell</h3><h4 id="啟動-Google-Cloud-Shell"><a href="#啟動-Google-Cloud-Shell" class="headerlink" title="啟動 Google Cloud Shell"></a>啟動 Google Cloud Shell</h4><p><code>Google Cloud Shell</code> 是載有開發工具的虛擬機器。它提供了5GB的 home 資料夾，並且運行在 <code>Google Cloud</code> 上。 <code>Google Cloud Shell</code> 讓你可以利用 command-line 存取 <code>GCP</code> 資源</p>
<ol>
<li>在 <code>GCP 控制台</code> ，右上的工具列，點擊 <code>Open Cloud Shell</code> 按鈕</li>
</ol>
<p><img src="https://i.imgur.com/Oada6gU.png" alt></p>
<ol start="2">
<li>在打開的對話框裡，按下 <code>START CLOUD SHELL</code>:</li>
</ol>
<p><img src="https://i.imgur.com/XRCkS9j.png" alt></p>
<p>你可以立即按下 <code>START CLOUD SHELL</code> 當對話視窗打開。</p>
<p>連結並提供環境會需要一點時間。當你連結成功，這代表你已成功獲得授權，且此專案已被設為你的專案ID，例如：</p>
<p><img src="https://i.imgur.com/QStCZUo.png" alt></p>
<p><code>gcloud</code> 是 <code>Google Cloud Platform</code> 的 command-line 工具，他已事先被安裝在 <code>Cloud Shell</code> 並且支援自動補齊</p>
<p>使用這個 command ,你可以列出有效帳戶名稱:<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud auth list</span><br></pre></td></tr></table></figure></p>
<p>輸出:<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">Credentialed accounts:</span><br><span class="line"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span><br></pre></td></tr></table></figure></p>
<p>範例輸出:<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">Credentialed accounts:</span><br><span class="line"> - google1623327_student@qwiklabs.net</span><br></pre></td></tr></table></figure></p>
<p>你可以使用以下 command 來列出專案 ID<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud config list project</span><br></pre></td></tr></table></figure></p>
<p>輸出：<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">[core]</span><br><span class="line">project = &lt;project_ID&gt;</span><br></pre></td></tr></table></figure></p>
<p>範例輸出：<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">[core]</span><br><span class="line">project = qwiklabs-gcp-44776a13dea667a6</span><br></pre></td></tr></table></figure></p>
<p><code>gcloud</code> 的完整文件可以參閱 <a href="https://cloud.google.com/sdk/gcloud" target="_blank" rel="noopener">Google Cloud gcloud Overview</a></p>
<h2 id="為你的資源設定預設的-region-以及-zone"><a href="#為你的資源設定預設的-region-以及-zone" class="headerlink" title="為你的資源設定預設的 region 以及 zone"></a>為你的資源設定預設的 region 以及 zone</h2><ul>
<li><p>在 Cloud Shell ，設定預設 zone</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud config <span class="hljs-built_in">set</span> compute/zone us-central1<span class="hljs-_">-a</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Cloud Shell ，設定預設 region</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud config <span class="hljs-built_in">set</span> compute/region us-central1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="建立多個-web-server-instance"><a href="#建立多個-web-server-instance" class="headerlink" title="建立多個 web server instance"></a>建立多個 web server instance</h2><p><br>為了模擬使用一個群組的機器來服務，我們可以利用 Instance Template 以及 Managed Instance Groups 來創建一個群集的 Nginx  web servers 用以服務靜態的內容。 Instance Template 定義了在這個群組中的 virtual machine 的規格（ disk, CPUs, memory, 等等）。  Managed Instance Groups 可以初始化多台使用 Instance Template 定義的 virtual machine<br></p>

<p>要建立一個 Nginx web server 服務群，建立以下事物:</p>
<ul>
<li>一份用來設定所有 virtual machine 上的 Nginx server 的 script</li>
<li>一份 instance template 來使用上述的 script</li>
<li>一個 target pool</li>
<li>一個使用 instance template 的 managed instance group</li>
</ul>
<p>以下開始建立上述事物:</p>
<ul>
<li><p>建立 startup script</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; startup.sh</span><br><span class="line"><span class="hljs-meta">#! /bin/bash</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y nginx</span><br><span class="line">service nginx start</span><br><span class="line">sed -i -- <span class="hljs-string">'s/nginx/Google Cloud Platform - '</span><span class="hljs-string">"\$HOSTNAME"</span><span class="hljs-string">'/'</span> /var/www/html/index.nginx-debian.html</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立使用 startup script 的 instance template</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute instance-templates create nginx-template \</span><br><span class="line">         --metadata-from-file startup-script=startup.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立 target pool 。一個 target pool 將針對所有的群組內的 instance 提供一個存取點，且在之後的平衡負載步驟，這是必須的。</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute target-pools create nginx-pool</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立一個使用 instance template 的 managed instance group</p>
</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute instance-groups managed create nginx-group \</span><br><span class="line">         --base-instance-name nginx \</span><br><span class="line">         --size 2 \</span><br><span class="line">         --template nginx-template \</span><br><span class="line">         --target-pool nginx-pool</span><br></pre></td></tr></table></figure>
<ul>
<li>這將會建立兩個擁有相同前綴名稱 nginx-的vurtual machine ，需要幾分鐘。</li>
<li><p>檢視所有已建立的 instances</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute instances list</span><br></pre></td></tr></table></figure>
</li>
<li><p>現在設定防火牆，所以我們可以經由 port 80，EXTERNAL_IP 位址來連接我們的機器    </p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute firewall-rules create www-firewall --allow tcp:80</span><br></pre></td></tr></table></figure>
</li>
<li><p>現在我們應該要可以經由上述的 external IP 位址連接到任何一台的 instance</p>
</li>
</ul>
<h2 id="建立Network-Load-Balancer"><a href="#建立Network-Load-Balancer" class="headerlink" title="建立Network Load Balancer"></a>建立Network Load Balancer</h2><p><br>Network Load Balancing 允許我們依據收到的 IP 協議資料，像是位址， port 號，還有協議類型，來平衡負載我們的系統。<br>我們還可以取得一些 HTTP(S) load balancing 沒有提供的選項，例如說，基於 TCP/UDP 的協議- SMTP traffic ，且如果你的應用對 TCP 連結相關的特性感興趣的話， Network Load Balacing 也允許你的 app 去檢查封包，這是 HTTP(S) Load Balancing 沒有提供的。<br></p>

<ul>
<li>針對我們的 instance ，建立一個 L3 network load balancer <figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute forwarding-rules create nginx-lb \</span><br><span class="line">         --region us-central1 \</span><br><span class="line">         --ports=80 \</span><br><span class="line">         --target-pool nginx-pool</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>列出所有 Google Compute Engine 轉發的規則</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute forwarding-rules list</span><br></pre></td></tr></table></figure>
</li>
<li><p>經由瀏覽器來拜訪 load balancer    </p>
<ul>
<li><code>http://IP_ADDRESS/ where IP_ADDRESS is the address shown as the result of running the previous command.</code></li>
</ul>
</li>
</ul>
<h2 id="建立一個-HTTP-S-Load-Balancer"><a href="#建立一個-HTTP-S-Load-Balancer" class="headerlink" title="建立一個 HTTP(S) Load Balancer"></a>建立一個 HTTP(S) Load Balancer</h2><p><br>HTTP(S) Load Balancing 提供全球性的所有對我們的 instance 所做的請求。我們可以設定 URL 規則來將某些 URL 導向一些 instance ，而將另一些 URL 導向另外一些 instance 。正常下，請求將會被導向離使用者最近的 instance ，以確保該群組的 instance 有足夠的資源可以提供給使用者。如果被導向的 instance 沒有足夠的資源，那請求將會被導向離使用者最近的並且有足夠資源的 instance<br></p>

<ul>
<li><p>首先，建立一個 health check 。 Health check 可以核實 instance 有針對 HTTP 或 HTTPS 通道做回應</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute http-health-checks create http-basic-check</span><br></pre></td></tr></table></figure>
</li>
<li><p>定義一個 HTTP 服務，並且給予我們 instance 使用的 port 號</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute instance-groups managed \</span><br><span class="line">       <span class="hljs-built_in">set</span>-named-ports nginx-group \</span><br><span class="line">       --named-ports http:80</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>建立後端服務<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute backend-services create nginx-backend \</span><br><span class="line">      --protocol HTTP --http-health-checks http-basic-check --global</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>將我們的 instance 群組加到後端服務:<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute backend-services add-backend nginx-backend \</span><br><span class="line">    --instance-group nginx-group \</span><br><span class="line">    --instance-group-zone us-central1<span class="hljs-_">-a</span> \</span><br><span class="line">    --global</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>建立一個預設的 URL 指定，他將會把所有收到的請求導向我們的 instance<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute url-maps create web-map \</span><br><span class="line">    --default-service nginx-backend</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>建立一個 target HTTP proxy 來將請求導向我們的 URL map<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute target-http-proxies create http-lb-proxy \</span><br><span class="line">    --url-map web-map</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>建立一個全球轉發規則來處理導向所有收到的請求。一個轉發規則將流量送到指定的 HTTP 或 HTTPS 代理根據請求的 IP 位址， IP 協議，或特定的 port 號。全球轉發規則不支援多個 port</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute forwarding-rules create http-content-rule \</span><br><span class="line">        --global \</span><br><span class="line">        --target-http-proxy http-lb-proxy \</span><br><span class="line">        --ports 80</span><br></pre></td></tr></table></figure>
<ul>
<li>全球轉發規則建立之後，需要幾分鐘時間生效<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">gcloud compute forwarding-rules list</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>我們現在應該要可以從瀏覽器經由<code>http://IP_ADDRESS/</code>來連接，這可能會需要幾分鐘生效。如果無法連接，多等一些時間，重新整理瀏覽器。</li>
</ul>
<h2 id="考考你"><a href="#考考你" class="headerlink" title="考考你"></a>考考你</h2><ul>
<li>Network Load Balancing is regional, non-proxied load balancer<ul>
<li style="list-style: none"><input type="checkbox" checked> true</li>
<li style="list-style: none"><input type="checkbox"> false</li>
</ul>
</li>
</ul>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/GCP-Essentials/">#GCP Essentials</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/QWIKLABS/">#QWIKLABS</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Google-Load-Baalancers/">#Google Load Baalancers</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/zh-tw/UploadAndResizeImagesWithLaravel/">使用Laravel儲存並重新縮放圖片大小</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/zh-tw/createAPersistentDisk/">在 GCP 上建立一個 persistent disk</a>
            
        </span>
    </div>
    
</article>


<div class="sharebox">
    
<div class="sharethis-inline-share-buttons"></div>
<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c72643b9ea706001139fd89&amp;product=inline-share-buttons" async="async"></script>

</div>



<div class="comments">
    <h3 class="title is-4">留言</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'https://tn710617.github.io/zh-tw/HTTPAndNetworkLoadBalancer/';
        this.page.identifier = 'zh-tw/HTTPAndNetworkLoadBalancer/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'rayscodingjourney' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2019 Ray&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
                       <a class="navbar-item" title="GitHub" href="https://github.com/tn710617">
                           
                           <i class="fab fa-github"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="E-Mail" href="mailto:tn710617@gmail.com">
                           
                           <i class="far fa-envelope"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="Linkedin" href="https://www.linkedin.com/in/ray-lee-99315315a">
                           
                           <i class="fab fa-linkedin"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="Facebook" href="https://www.facebook.com/profile.php?id=100001626039430">
                           
                           <i class="fab fa-facebook"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="Skype" href="skype:adad0310?call|chat">
                           
                           <i class="fab fa-skype"></i>
                           
                       </a>
                          
                       
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站內搜尋">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '頁面',
                CATEGORIES: '分類',
                TAGS: '標籤',
                UNTITLED: '(無標題)',
            },
            CONTENT_URL: '/content.zh-tw.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>