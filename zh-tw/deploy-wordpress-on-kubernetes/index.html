<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Kubernetes - 部署 WordPress 應用 - Learn or Die</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="# 前言本文為部署 WordPress 應用到 Kubernetes cluster內容非 Production 標準, 若要使用在 Production 環境尚有許多地方要改進">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes - 部署 WordPress 應用">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/deploy-wordpress-on-kubernetes/index.html">
<meta property="og:site_name" content="Learn or Die">
<meta property="og:description" content="# 前言本文為部署 WordPress 應用到 Kubernetes cluster內容非 Production 標準, 若要使用在 Production 環境尚有許多地方要改進">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3cuIWiF5FUy6ROKR397tcfKk5zDcpzCFFANTOKT-73UhWpo30hP0ki3nthRSeYo7Bv2-1gMruVqaj6XeTEA9bcD2JEewzZB0vQnI4vDCWxjCTyMu6XQpxiqaT7PLWFhazvgUKJg1yESnUGG2d9CymMmhQ=w1880-h1818-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3d46wRrXZe83kef_MaC1xDIGYqtlu3H3mG-wRWX8j9anv5QMCh6uFQOJs2ThVKj3Z4sZ77dIqSVZhj2OLhEaZ74bdZyITag3cRj46sEsjkJXeGcafXYde4MbNggYkIEPfP3HN6I_mlsbX_gGBZUQSXW8Q=w1880-h1884-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3ePJFfgiY4U1loolAksJaL-hS6gG6hDEEgGxs-1LOhGQ5WYAk4BvLNqJIdpDBSjm65UNwvQfBKQjsc9e9rUPRN_hwpYXXv3SHWx6hVtslsqh3njbiJQYvVMjoWQKVsjzlWe8Gv1PmoTAsDHNK8Y9Dg9pw=w3800-h2002-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3eOl8tWfOEsSrffCU8xGcthi89-26pAJJx5t28wXArNnEFMZPSftOgHSQXJ4C29gLAiyO1_lv2btLHjZvykKXD_Ag5FpbO6q-Okud6_OmDJSMoyrhBrPUnKfNZT-NFbSrOZibcp5qvPrqKjXntarnLZPw=w2738-h186-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3fv4cH0Il0pryln2nOAH2kx2KNGyxES2WOi_ljmJZwCzL_2ijl1FD1afmq78BvitR8hDzmNhEVVh-pmkyXhjXAbkF2F6evo3dMgS7N68VByNWKoh6as-Q1E9V-XmusOW6diHo6ZkENGOtw70Sxc2SYWkA=w2780-h186-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3dYJ586Kx1_EQm7JXHiswfxq2ShAjRvSfxjMRvjYBCjLgis1HeWyrMHsl1QO62VzhDGgoEQrUm0rzFyMuPe1P_gCWRXUCXLNOqDcrdtZYOJ8sN28CJibNnoNFfvAoDgh7iB94_zyQC4podfatyiA9flWQ=w2442-h1128-no?authuser=0">
<meta property="article:published_time" content="2020-12-19T06:26:51.000Z">
<meta property="article:modified_time" content="2020-12-21T06:10:03.386Z">
<meta property="article:author" content="Ray">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="WordPress">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lh3.googleusercontent.com/pw/ACtC-3cuIWiF5FUy6ROKR397tcfKk5zDcpzCFFANTOKT-73UhWpo30hP0ki3nthRSeYo7Bv2-1gMruVqaj6XeTEA9bcD2JEewzZB0vQnI4vDCWxjCTyMu6XQpxiqaT7PLWFhazvgUKJg1yESnUGG2d9CymMmhQ=w1880-h1818-no?authuser=0">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


    <link href="/deploy-wordpress-on-kubernetes/" rel="alternate"
          hreflang="en"/>








    <meta name="description" content="# 前言本文為部署 WordPress 應用到 Kubernetes cluster內容非 Production 標準, 若要使用在 Production 環境尚有許多地方要改進">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes - 部署 WordPress 應用">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/deploy-wordpress-on-kubernetes/index.html">
<meta property="og:site_name" content="Learn or Die">
<meta property="og:description" content="# 前言本文為部署 WordPress 應用到 Kubernetes cluster內容非 Production 標準, 若要使用在 Production 環境尚有許多地方要改進">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3cuIWiF5FUy6ROKR397tcfKk5zDcpzCFFANTOKT-73UhWpo30hP0ki3nthRSeYo7Bv2-1gMruVqaj6XeTEA9bcD2JEewzZB0vQnI4vDCWxjCTyMu6XQpxiqaT7PLWFhazvgUKJg1yESnUGG2d9CymMmhQ=w1880-h1818-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3d46wRrXZe83kef_MaC1xDIGYqtlu3H3mG-wRWX8j9anv5QMCh6uFQOJs2ThVKj3Z4sZ77dIqSVZhj2OLhEaZ74bdZyITag3cRj46sEsjkJXeGcafXYde4MbNggYkIEPfP3HN6I_mlsbX_gGBZUQSXW8Q=w1880-h1884-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3ePJFfgiY4U1loolAksJaL-hS6gG6hDEEgGxs-1LOhGQ5WYAk4BvLNqJIdpDBSjm65UNwvQfBKQjsc9e9rUPRN_hwpYXXv3SHWx6hVtslsqh3njbiJQYvVMjoWQKVsjzlWe8Gv1PmoTAsDHNK8Y9Dg9pw=w3800-h2002-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3eOl8tWfOEsSrffCU8xGcthi89-26pAJJx5t28wXArNnEFMZPSftOgHSQXJ4C29gLAiyO1_lv2btLHjZvykKXD_Ag5FpbO6q-Okud6_OmDJSMoyrhBrPUnKfNZT-NFbSrOZibcp5qvPrqKjXntarnLZPw=w2738-h186-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3fv4cH0Il0pryln2nOAH2kx2KNGyxES2WOi_ljmJZwCzL_2ijl1FD1afmq78BvitR8hDzmNhEVVh-pmkyXhjXAbkF2F6evo3dMgS7N68VByNWKoh6as-Q1E9V-XmusOW6diHo6ZkENGOtw70Sxc2SYWkA=w2780-h186-no?authuser=0">
<meta property="og:image" content="https://lh3.googleusercontent.com/pw/ACtC-3dYJ586Kx1_EQm7JXHiswfxq2ShAjRvSfxjMRvjYBCjLgis1HeWyrMHsl1QO62VzhDGgoEQrUm0rzFyMuPe1P_gCWRXUCXLNOqDcrdtZYOJ8sN28CJibNnoNFfvAoDgh7iB94_zyQC4podfatyiA9flWQ=w2442-h1128-no?authuser=0">
<meta property="article:published_time" content="2020-12-19T06:26:51.000Z">
<meta property="article:modified_time" content="2020-12-21T06:10:03.386Z">
<meta property="article:author" content="Ray">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="WordPress">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lh3.googleusercontent.com/pw/ACtC-3cuIWiF5FUy6ROKR397tcfKk5zDcpzCFFANTOKT-73UhWpo30hP0ki3nthRSeYo7Bv2-1gMruVqaj6XeTEA9bcD2JEewzZB0vQnI4vDCWxjCTyMu6XQpxiqaT7PLWFhazvgUKJg1yESnUGG2d9CymMmhQ=w1880-h1818-no?authuser=0">





    <link rel="icon" href="/images/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/sunburst.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
        
    
        
    
        
    
        
    
        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135063928-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-135063928-1');
</script>


    


<meta name="generator" content="Hexo 6.2.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/zh-tw">
                
                    
                    不學會死
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/zh-tw/archives">歸檔</a>
            
            <a class="navbar-item "
               href="/zh-tw/categories">分類</a>
            
            <a class="navbar-item "
               href="/zh-tw/tags">標籤</a>
            
            <a class="navbar-item "
               href="/zh-tw/schedule">行程</a>
            
            <a class="navbar-item "
               href="/zh-tw/about">關於</a>
            
            <a class="navbar-item "
               href="/zh-tw/japanese">日語</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜尋" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="目錄">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#前言">1&nbsp;&nbsp;<b># 前言</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#環境">2&nbsp;&nbsp;<b># 環境</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#目標">3&nbsp;&nbsp;<b># 目標</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#實作步驟">4&nbsp;&nbsp;<b># 實作步驟</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#建立-Namespace">5&nbsp;&nbsp;<b># 建立 Namespace</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#WordPress-Deployment">6&nbsp;&nbsp;<b># WordPress Deployment</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#strategy">6.1&nbsp;&nbsp;# strategy</a>
                    
                    
                    
                    <a class="navbar-item" href="#selector">6.2&nbsp;&nbsp;# selector</a>
                    
                    
                    
                    <a class="navbar-item" href="#initContainers">6.3&nbsp;&nbsp;# initContainers</a>
                    
                    
                    
                    <a class="navbar-item" href="#env">6.4&nbsp;&nbsp;# env</a>
                    
                    
                    
                    <a class="navbar-item" href="#resources">6.5&nbsp;&nbsp;# resources</a>
                    
                    
                    
                    <a class="navbar-item" href="#Health-Check">6.6&nbsp;&nbsp;# Health Check</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#WordPress-Service">7&nbsp;&nbsp;<b># WordPress Service</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#MySQL-Deployment">8&nbsp;&nbsp;<b># MySQL Deployment</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#arg">8.1&nbsp;&nbsp;# arg</a>
                    
                    
                    
                    <a class="navbar-item" href="#env-1">8.2&nbsp;&nbsp;# env</a>
                    
                    
                    
                    <a class="navbar-item" href="#volume">8.3&nbsp;&nbsp;# volume</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#MySQL-Service">9&nbsp;&nbsp;<b># MySQL Service</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#HPA">10&nbsp;&nbsp;<b># HPA</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#部署">11&nbsp;&nbsp;<b># 部署</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#功能測試">12&nbsp;&nbsp;<b># 功能測試</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#HPA-測試">13&nbsp;&nbsp;<b># HPA 測試</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#結論">14&nbsp;&nbsp;<b># 結論</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Questions-and-Answers">15&nbsp;&nbsp;<b># Questions and Answers</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Kubernetes-example-code-代表什麼意思？">15.1.1&nbsp;&nbsp;以下的 Kubernetes example code 代表什麼意思？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Kubernetes-example-code-代表什麼意思？-1">15.1.2&nbsp;&nbsp;以下的 Kubernetes example code 代表什麼意思？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Kubernetes-example-code-代表什麼意思？-2">15.1.3&nbsp;&nbsp;以下的 Kubernetes example code 代表什麼意思？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Kubernetes-example-code-代表什麼意思？-3">15.1.4&nbsp;&nbsp;以下的 Kubernetes example code 代表什麼意思？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Kubernetes-Deployment-code-selector-的對象是？">15.1.5&nbsp;&nbsp;以下的 Kubernetes Deployment code, selector 的對象是？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#all-in-one-YAML">16&nbsp;&nbsp;<b># all-in-one YAML</b></a>
                    
                </div>
            </div>
            

            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true" aria-controls="dropdown-menu7">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>繁體中文</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            
                <a href="/deploy-wordpress-on-kubernetes/" class="dropdown-item">
                    English
                </a>
            
                <a href="/zh-tw/deploy-wordpress-on-kubernetes/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Kubernetes - 部署 WordPress 應用
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-19T06:26:51.000Z" itemprop="datePublished">12月 19 2020</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/zh-tw/categories/Ops/">Ops</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            23 分钟 讀完 (大概 3477 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="前言"><a href="#前言" class="headerlink" title="# 前言"></a># 前言</h2><p>本文為部署 WordPress 應用到 Kubernetes cluster<br>內容非 Production 標準, 若要使用在 Production 環境尚有許多地方要改進</p>
<span id="more"></span>

<br>
<br>

<h2 id="環境"><a href="#環境" class="headerlink" title="# 環境"></a># 環境</h2><p>Ray 是使用 <a target="_blank" rel="noopener" href="https://kind.sigs.k8s.io/docs/user/quick-start/">KIND</a> 當練習環境, 是個利用容器模擬出多 multi-node cluster 的應用</p>
<p>因為本文會用到 Metric Server, KIND 並不會安裝, 所以需要到 <a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/metrics-server">Metric server 官方頁面</a> 來安裝</p>
<p>如果有遇到 <code>x509: cannot validate certificate for ... because it doesn&#39;t contain any IP SANs</code> 錯誤訊息, 請到 <a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/metrics-server/releases">Metric server 官方 Github</a> 下載 component yaml, 然後加入一個 arg <code>--kubelet-insecure-tls</code></p>
<br>
<br>

<h2 id="目標"><a href="#目標" class="headerlink" title="# 目標"></a># 目標</h2><ul>
<li>部署 WordPress 應用到 Kubernetes Cluster</li>
<li>部署 MySQL 資料庫到 Kubernetes Cluster</li>
<li>WordPress 應用跟 MySQL 資料庫需可相通  </li>
<li>對 WordPress 應用做狀態檢查</li>
<li>對 WordPress 應用建立 HPA 控管, 若負載高於定義, 需自動擴展</li>
</ul>
<br>
<br>

<h2 id="實作步驟"><a href="#實作步驟" class="headerlink" title="# 實作步驟"></a># 實作步驟</h2><ul>
<li><a href="#%E5%BB%BA%E7%AB%8B-Namespace">建立特定 Namespace</a></li>
<li><a href="#WordPress-Deployment">編寫 WordPress Deployment yaml file</a></li>
<li><a href="#WordPress-Service">編寫 WordPress Service yaml file</a></li>
<li><a href="#MySQL-Deployment">編寫 MySQL Deployment yaml file</a></li>
<li><a href="#MySQL-Service">編寫 MySQL Service yaml file</a></li>
<li><a href="#HPA">編寫 HPA yaml file</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2">部署</a></li>
<li><a href="#%E5%8A%9F%E8%83%BD%E6%B8%AC%E8%A9%A6">功能測試</a></li>
<li><a href="#HPA-%E6%B8%AC%E8%A9%A6">HPA 測試</a></li>
</ul>
<br>
<br>

<h2 id="建立-Namespace"><a href="#建立-Namespace" class="headerlink" title="# 建立 Namespace"></a># 建立 Namespace</h2><p>首先, 我們先建立一個 namespace, 本次練習中建立的物件都會部署到該 namespace</p>
<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="WordPress-Deployment"><a href="#WordPress-Deployment" class="headerlink" title="# WordPress Deployment"></a># WordPress Deployment</h2><p>接著, 要來撰寫 WordPress 的 Deployment yaml<br>Deployment 作用主要是 Pod 的管理器<br>為什麼不用 Pod 呢？ 因為如果我們要具有水平擴展的能力的話, 那當流量大時, 1 個 Pod 可能並不足以應付, 所以我們使用 Deployment 來管理 Pod, 可視情況擴縮<br>直接來看 yaml</p>
<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line">  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">  <span class="hljs-attr">labels:</span></span><br><span class="line">    <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">minReadySeconds:</span> <span class="hljs-number">5</span></span><br><span class="line">  <span class="hljs-attr">strategy:</span></span><br><span class="line">    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span></span><br><span class="line">    <span class="hljs-attr">rollingUpdate:</span></span><br><span class="line">      <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">40</span><span class="hljs-string">%</span></span><br><span class="line">      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">40</span><span class="hljs-string">%</span></span><br><span class="line">  <span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">matchLabels:</span></span><br><span class="line">      <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">  <span class="hljs-attr">template:</span></span><br><span class="line">    <span class="hljs-attr">metadata:</span></span><br><span class="line">      <span class="hljs-attr">labels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">    <span class="hljs-attr">spec:</span></span><br><span class="line">      <span class="hljs-attr">initContainers:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">check-db-ready</span></span><br><span class="line">          <span class="hljs-attr">image:</span> <span class="hljs-string">imega/mysql-client</span></span><br><span class="line">          <span class="hljs-attr">command:</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;sh&#x27;</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-c&#x27;</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;until mysqladmin ping -h mysql-service &amp;&gt; /dev/null; do echo waiting; sleep 2; done&#x27;</span></span><br><span class="line">      <span class="hljs-attr">containers:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">          <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span></span><br><span class="line">          <span class="hljs-attr">ports:</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span></span><br><span class="line">              <span class="hljs-attr">name:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">          <span class="hljs-attr">env:</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_HOST</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">mysql-service:3306</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_USER</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_PASSWORD</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_NAME</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">          <span class="hljs-attr">resources:</span></span><br><span class="line">            <span class="hljs-attr">limits:</span></span><br><span class="line">              <span class="hljs-attr">cpu:</span> <span class="hljs-string">200m</span></span><br><span class="line">              <span class="hljs-attr">memory:</span> <span class="hljs-string">200Mi</span></span><br><span class="line">            <span class="hljs-attr">requests:</span></span><br><span class="line">              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span></span><br><span class="line">              <span class="hljs-attr">memory:</span> <span class="hljs-string">200Mi</span></span><br><span class="line">          <span class="hljs-attr">startupProbe:</span></span><br><span class="line">            <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">              <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span></span><br><span class="line">            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">60</span></span><br><span class="line">            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span></span><br><span class="line">          <span class="hljs-attr">livenessProbe:</span></span><br><span class="line">            <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">              <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span></span><br><span class="line">            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span></span><br><span class="line">            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">          <span class="hljs-attr">readinessProbe:</span></span><br><span class="line">            <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">              <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br></pre></td></tr></table></figure>

<p>媽媽咪啊, 一大串 yaml 檔, 誒誒, 先別走啊！ 你心裡是不是在想 <strong>是想搞死誰啊？</strong> 甭緊張, 我們一個一個來嘛…</p>
<br>

<h3 id="strategy"><a href="#strategy" class="headerlink" title="# strategy"></a># strategy</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">strategy:</span></span><br><span class="line">    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span></span><br><span class="line">    <span class="hljs-attr">rollingUpdate:</span></span><br><span class="line">        <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">40</span><span class="hljs-string">%</span></span><br><span class="line">        <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">40</span><span class="hljs-string">%</span></span><br></pre></td></tr></table></figure>

<p>RollingUpdate, 如字面上的意思為滾動更新, 那為什麼要滾動呢？ 如果今天我們觸發一個更新, 但 Deployment 把所有的 Pod 都給砍了, 一次性的啟動新的 Pod, 那服務當場就死翹翹了<br>所以凡事不要急, 要一個一個來, 心急吃不了熱豆腐！</p>
<p>至於 maxSurge 跟 maxUnavailable, 如果我現有的 Pod 是 100%, maxSurge 40% 表示最多可以啟動新的 Pod 到 140%, 而 maxUnavailable 也是同樣, 最多可減少到 60%<br>所以這兩個設定不可同時設為 0, 阿不然不能多也不能少, 是要滾動個鬼啊？ 滾, 都給我滾…</p>
<p>更多細節部分可參考<a target="_blank" rel="noopener" href="https://medium.com/learn-or-die/kubernetes-deployment-a54327e79a7e">這篇</a>, 或是<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment">官方文件</a></p>
<br>

<h3 id="selector"><a href="#selector" class="headerlink" title="# selector"></a># selector</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">matchLabels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br></pre></td></tr></table></figure>
<p>selector 主要是定義 Deployment 所管理的 Pod 對象, 所以會跟 template 裡頭的 app: wordpress-pod 一樣</p>
<br>

<h3 id="initContainers"><a href="#initContainers" class="headerlink" title="# initContainers"></a># initContainers</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">initContainers:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">check-db-ready</span></span><br><span class="line">      <span class="hljs-attr">image:</span> <span class="hljs-string">imega/mysql-client</span></span><br><span class="line">      <span class="hljs-attr">command:</span></span><br><span class="line">          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;sh&#x27;</span></span><br><span class="line">          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-c&#x27;</span></span><br><span class="line">          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;until mysqladmin ping -h mysql-service &amp;&gt; /dev/null; do echo waiting; sleep 2; done&#x27;</span></span><br></pre></td></tr></table></figure>
<p>因為 wordpress 服務會用到 MySQL, 如果 MySQL Pod 啟動好之前, wordpress 服務就先好了, 那就使用者端可是會出錯的。<br>所以這邊啟動一個 mysql-client 的 container, 目的在於確定 MySQL 是否 ready, 話說這 image 我隨便弄弄找一個可以用的, 為了可用性, production 可是要把 image 自己準備好, 不然要是人家刪了 image 你就哭哭</p>
<br>

<h3 id="env"><a href="#env" class="headerlink" title="# env"></a># env</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">env:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_HOST</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">mysql-service:3306</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_USER</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_PASSWORD</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_NAME</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br></pre></td></tr></table></figure>
<p>env 我說了不算, 請參考 <a target="_blank" rel="noopener" href="https://hub.docker.com/_/wordpress">DockerHub WordPress</a></p>
<br>

<h3 id="resources"><a href="#resources" class="headerlink" title="# resources"></a># resources</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">resources:</span></span><br><span class="line">    <span class="hljs-attr">limits:</span></span><br><span class="line">        <span class="hljs-attr">cpu:</span> <span class="hljs-string">200m</span></span><br><span class="line">        <span class="hljs-attr">memory:</span> <span class="hljs-string">200Mi</span></span><br><span class="line">    <span class="hljs-attr">requests:</span></span><br><span class="line">        <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span></span><br><span class="line">        <span class="hljs-attr">memory:</span> <span class="hljs-string">200Mi</span></span><br></pre></td></tr></table></figure>

<p>resources 簡單來說, requests 就是定義 Node 需要多少 resource 才可以放置這個 Pod, 而 limits 就是這個 Pod 最多可使用這個 Node 的多少資源<br>媽媽咪啊我怎麼有辦法說得這麼淺顯易懂, 我真是太帥了<br>細節可參考<a href>這篇文章</a></p>
<br>

<h3 id="Health-Check"><a href="#Health-Check" class="headerlink" title="# Health Check"></a># Health Check</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">startupProbe:</span></span><br><span class="line">    <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">        <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">    <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span></span><br><span class="line">    <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">60</span></span><br><span class="line">    <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">    <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span></span><br><span class="line"><span class="hljs-attr">livenessProbe:</span></span><br><span class="line">    <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">        <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">    <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span></span><br><span class="line">    <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span></span><br><span class="line">    <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-attr">readinessProbe:</span></span><br><span class="line">    <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">        <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">    <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">    <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br></pre></td></tr></table></figure>

<p>這麼多 probe, 簡單來說…<br>有些應用啟動時間比較久, 這時就可以用 startup probe<br>而 livenessProbe 如果是用來確定該 Pod 是否可用, 不可用可是會把 Pod 殺掉的！<br>readinessProbe 如果檢測沒過, 那 service 就不會把 traffic 往這個 Pod 送啦！</p>
<p>tcpSocket 只是檢測的一種方法之一, 也可使用 httpGet 或者 exec</p>
<p>細節部分可以參考<a target="_blank" rel="noopener" href="https://medium.com/learn-or-die/kubernetes-%E5%81%A5%E5%BA%B7%E6%AA%A2%E6%9F%A5-59ee2a798115">這篇文章</a></p>
<p>好啦, 到這邊 wordpress-deployment 的部份我們都講完了, 下面繼續講, 不過如果有重複的我就不贅述囉！</p>
<br>
<br>

<h2 id="WordPress-Service"><a href="#WordPress-Service" class="headerlink" title="# WordPress Service"></a># WordPress Service</h2><p>service 的作用為將流量導向複數 Pods 的一個 endpoint, 可被其他的 kubernetes cluster 內的服務存取, 也可被外部存取 (需透過 mapping)<br>這個是不是短到有點沒存在感？ 喂～ 我說的是 yaml 長度</p>
<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service</span></span><br><span class="line">  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span></span><br><span class="line">  <span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">  <span class="hljs-attr">ports:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span></span><br><span class="line">      <span class="hljs-attr">targetPort:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">      <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service-port</span></span><br><span class="line">      <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30000</span></span><br><span class="line">      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span></span><br></pre></td></tr></table></figure>

<p>首先, selector 會 select 出名稱為 wordpress-pod 的 Pods<br>接下來, 定義 service 本身的 port 為 80, 目標的 port 為 wp-pod-port, 還記得嗎？ 這是定義在 wordpress-deployment 的 Pod port<br>再來, 定義此 service 的 port 為 wordpress-service-port<br>類型為 NodePort, 並定義確切的 Port<br>protocol 為 TCP, 預設值也是 TCP</p>
<p>NodePort 的作用在於將此 service map 到 Node 的 port, 所以我們就可以透過存取 Node 的 30000 port 來存取此 service, 這樣理解吧？</p>
<br>
<br>

<h2 id="MySQL-Deployment"><a href="#MySQL-Deployment" class="headerlink" title="# MySQL Deployment"></a># MySQL Deployment</h2><p>MySQL 是有狀態的服務, 基本上本文中的部署方式絕非 production 適用的</p>
<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-deployment</span></span><br><span class="line">    <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">    <span class="hljs-attr">labels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-deployment</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">    <span class="hljs-attr">selector:</span></span><br><span class="line">        <span class="hljs-attr">matchLabels:</span></span><br><span class="line">            <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-pod</span></span><br><span class="line">    <span class="hljs-attr">template:</span></span><br><span class="line">        <span class="hljs-attr">metadata:</span></span><br><span class="line">            <span class="hljs-attr">labels:</span></span><br><span class="line">                <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-pod</span></span><br><span class="line">        <span class="hljs-attr">spec:</span></span><br><span class="line">            <span class="hljs-attr">containers:</span></span><br><span class="line">                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span></span><br><span class="line">                  <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span></span><br><span class="line">                  <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span></span><br><span class="line">                  <span class="hljs-attr">args:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">--default_authentication_plugin=mysql_native_password</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">--character-set-server=utf8mb4</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">                  <span class="hljs-attr">ports:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3306</span></span><br><span class="line">                        <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-pod-port</span></span><br><span class="line">                  <span class="hljs-attr">env:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">mysql_root_password</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_DATABASE</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_PASSWORD</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_USER</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                  <span class="hljs-attr">volumeMounts:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/mysql</span></span><br><span class="line">                        <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-db</span></span><br><span class="line">            <span class="hljs-attr">volumes:</span></span><br><span class="line">                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-db</span></span><br><span class="line">                  <span class="hljs-attr">hostPath:</span></span><br><span class="line">                      <span class="hljs-attr">path:</span> <span class="hljs-string">/var/lib/mysql</span></span><br></pre></td></tr></table></figure>

<p>媽媽咪啊, 現在都流行一大串的 yaml 啊？ 上面講過的我這邊就不會再贅述囉, 讓我們一個一個來！</p>
<br>

<h3 id="arg"><a href="#arg" class="headerlink" title="# arg"></a># arg</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">args:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-string">--default_authentication_plugin=mysql_native_password</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-string">--character-set-server=utf8mb4</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-string">--collation-server=utf8mb4_unicode_ci</span></span><br></pre></td></tr></table></figure>
<p>這個主要是定義資料庫的起始設定, 可參考<a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql">官方 Dockerhub</a></p>
<br>

<h3 id="env-1"><a href="#env-1" class="headerlink" title="# env"></a># env</h3><p>同上, env 也是定義這個資料庫的一些設定, 這邊要特別注意, wordpress env 會定義使用的 DB_HOST … 等等的各項資訊, 所以我們在建立資料庫時, 也要跟 wordpress env 定義的一樣, 這樣 wordpress 啟動之後才可以跟 MySQL 接上</p>
<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">env:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">mysql_root_password</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_DATABASE</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_PASSWORD</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_USER</span></span><br><span class="line">      <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="volume"><a href="#volume" class="headerlink" title="# volume"></a># volume</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">volumeMounts:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/mysql</span></span><br><span class="line">      <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-db</span></span><br><span class="line"><span class="hljs-attr">volumes:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-db</span></span><br><span class="line">      <span class="hljs-attr">hostPath:</span></span><br><span class="line">          <span class="hljs-attr">path:</span> <span class="hljs-string">/var/lib/mysql</span></span><br></pre></td></tr></table></figure>
<p>跟 volume 有關的就一次解決, 注意這邊的 example 格式是不對的啊！ 只是為了解說讓他們同排, 正確的請參考 yaml<br>這邊主要是做數據持久化, 將 Pod 中的 data 掛載到 Node 當中<br>mountPath 為 pod 中的 data 位置, 至於為什麼是這個位置？ 你問我我問誰去… 不是啦哈哈, 可參考 <a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql">官方 DockerHub</a>, 或者也可以自己進到 container 去看看</p>
<p>volumes 為定義一個位置, 這個 volumes 可以讓 Pod 掛載到 Pod 內的任意位置, volumes 的種類有很多種, 這邊使用 hostPath 是定義在 Node 內的一個位置, 當然這不是一個好的做法, 因為當我 MySQL 重啟後, 是否還會被 schedule 到同一個 Node 是未知數, 所以這邊應該還要加個 Node selector 的設定, 不過暫且先這樣吧！</p>
<p>所以掛載後, Pods 內的 <code>/var/lib/mysql</code> 就會跟 Node 的 <code>/var/lib/mysql</code> 數據同步, 只要 Node disk 沒掛資料就可以持久化保存</p>
<br>
<br>

<h2 id="MySQL-Service"><a href="#MySQL-Service" class="headerlink" title="# MySQL Service"></a># MySQL Service</h2><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-service</span></span><br><span class="line">  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-pod</span></span><br><span class="line">  <span class="hljs-attr">ports:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span></span><br><span class="line">      <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-service-port</span></span><br><span class="line">      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span></span><br><span class="line">      <span class="hljs-attr">targetPort:</span> <span class="hljs-string">mysql-pod-port</span></span><br></pre></td></tr></table></figure>

<p>還是 service 比較可愛, 短小精悍！<br>基本上跟 wordpress service 相同, 這邊不贅述</p>
<br>
<br>

<h2 id="HPA"><a href="#HPA" class="headerlink" title="# HPA"></a># HPA</h2><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">autoscaling/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-hpa</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">scaleTargetRef:</span></span><br><span class="line">    <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line">    <span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line">  <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span></span><br><span class="line">  <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">15</span></span><br><span class="line">  <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">50</span></span><br></pre></td></tr></table></figure>
<p>假設今天流量突然暴增, 那我原本只有一個 wordpress pod, 怎麼辦？ 使用者端畫面肯定會整個卡住, 因為光是一個 pod 無法處理這麼多 requests, 這時我們就可以使用 HPA</p>
<p>簡單來說, 他設定了最少一個 Pod, 最多 15 個 Pod, 如果目前每個 Pod 的 CPU 負載量超過 50% 的話, 那就再啟動一個 Pod, 直到負載量低於 50% 或者已達 15 個 Pod</p>
<br>
<br>

<h2 id="部署"><a href="#部署" class="headerlink" title="# 部署"></a># 部署</h2><p>接下來就到了部署的時刻啦！ 接下來只要將上面介紹的 yaml 檔案一個一個 apply 就可以完成部署啦, 為求簡單化, 我會將全部的 yaml 寫成一個 yaml, 並放在本文最下方<br>接下來只要部署此 yaml 檔就行啦！</p>
<figure class="highlight plaintext hljs"><table><tr><td class="code"><pre><span class="line">kubectl apply -f all-in-one-yaml</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="功能測試"><a href="#功能測試" class="headerlink" title="# 功能測試"></a># 功能測試</h2><p>完成部署後, 我們訪問 <code>yourNodeIp:30000</code> 就可以看到 WordPress 的首頁啦！<br><img src="https://lh3.googleusercontent.com/pw/ACtC-3cuIWiF5FUy6ROKR397tcfKk5zDcpzCFFANTOKT-73UhWpo30hP0ki3nthRSeYo7Bv2-1gMruVqaj6XeTEA9bcD2JEewzZB0vQnI4vDCWxjCTyMu6XQpxiqaT7PLWFhazvgUKJg1yESnUGG2d9CymMmhQ=w1880-h1818-no?authuser=0"></p>
<p>然後就可以進去玩耍一番！<br><img src="https://lh3.googleusercontent.com/pw/ACtC-3d46wRrXZe83kef_MaC1xDIGYqtlu3H3mG-wRWX8j9anv5QMCh6uFQOJs2ThVKj3Z4sZ77dIqSVZhj2OLhEaZ74bdZyITag3cRj46sEsjkJXeGcafXYde4MbNggYkIEPfP3HN6I_mlsbX_gGBZUQSXW8Q=w1880-h1884-no?authuser=0"><br><img src="https://lh3.googleusercontent.com/pw/ACtC-3ePJFfgiY4U1loolAksJaL-hS6gG6hDEEgGxs-1LOhGQ5WYAk4BvLNqJIdpDBSjm65UNwvQfBKQjsc9e9rUPRN_hwpYXXv3SHWx6hVtslsqh3njbiJQYvVMjoWQKVsjzlWe8Gv1PmoTAsDHNK8Y9Dg9pw=w3800-h2002-no?authuser=0"></p>
<br>
<br>

<h2 id="HPA-測試"><a href="#HPA-測試" class="headerlink" title="# HPA 測試"></a># HPA 測試</h2><p>接著, 我們要對首頁來發出大量的 request, 看看 HPA 是否運作正常</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span> wget -q -O- localhost:30000; <span class="hljs-keyword">done</span></span><br></pre></td></tr></table></figure>

<p>然後耐心地看看 HPA 狀態</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">kubectl get hpa wordpress-hpa -n wordpress</span><br></pre></td></tr></table></figure>
<p><img src="https://lh3.googleusercontent.com/pw/ACtC-3eOl8tWfOEsSrffCU8xGcthi89-26pAJJx5t28wXArNnEFMZPSftOgHSQXJ4C29gLAiyO1_lv2btLHjZvykKXD_Ag5FpbO6q-Okud6_OmDJSMoyrhBrPUnKfNZT-NFbSrOZibcp5qvPrqKjXntarnLZPw=w2738-h186-no?authuser=0"></p>
<p>好像沒在動？ 給點耐心嘛！</p>
<p>哇靠！ 有了有了！<br><img src="https://lh3.googleusercontent.com/pw/ACtC-3fv4cH0Il0pryln2nOAH2kx2KNGyxES2WOi_ljmJZwCzL_2ijl1FD1afmq78BvitR8hDzmNhEVVh-pmkyXhjXAbkF2F6evo3dMgS7N68VByNWKoh6as-Q1E9V-XmusOW6diHo6ZkENGOtw70Sxc2SYWkA=w2780-h186-no?authuser=0"></p>
<p>接下來, 看看 Pod 是否有變多了</p>
<figure class="highlight plaintext hljs"><table><tr><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></table></figure>
<p><img src="https://lh3.googleusercontent.com/pw/ACtC-3dYJ586Kx1_EQm7JXHiswfxq2ShAjRvSfxjMRvjYBCjLgis1HeWyrMHsl1QO62VzhDGgoEQrUm0rzFyMuPe1P_gCWRXUCXLNOqDcrdtZYOJ8sN28CJibNnoNFfvAoDgh7iB94_zyQC4podfatyiA9flWQ=w2442-h1128-no?authuser=0"></p>
<p>有了有了！ 等到 autoscale 完成, 再去刷刷頁面, 會發現不會卡了呢！</p>
<br>
<br>

<h2 id="結論"><a href="#結論" class="headerlink" title="# 結論"></a># 結論</h2><p>本文就到此告一段落啦！ 我們下次見！</p>
<br>
<br>

<h2 id="Questions-and-Answers"><a href="#Questions-and-Answers" class="headerlink" title="# Questions and Answers"></a># Questions and Answers</h2><h6 id="以下的-Kubernetes-example-code-代表什麼意思？"><a href="#以下的-Kubernetes-example-code-代表什麼意思？" class="headerlink" title="以下的 Kubernetes example code 代表什麼意思？"></a><strong>以下的 Kubernetes example code 代表什麼意思？</strong></h6><ul>
<li><strong>Example</strong>:<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">autoscaling/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-hpa</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">scaleTargetRef:</span></span><br><span class="line">    <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line">    <span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line">  <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span></span><br><span class="line">  <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">15</span></span><br><span class="line">  <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">50</span></span><br></pre></td></tr></table></figure></li>
<li><strong>Answer</strong>:<br>建立一個 auto scaler, 最少一個 Pod, 最多 15 個 Pod, 當所有 Pod 的平均 CPU 使用量達到 50% 時觸發</li>
</ul>
<h6 id="以下的-Kubernetes-example-code-代表什麼意思？-1"><a href="#以下的-Kubernetes-example-code-代表什麼意思？-1" class="headerlink" title="以下的 Kubernetes example code 代表什麼意思？"></a><strong>以下的 Kubernetes example code 代表什麼意思？</strong></h6><ul>
<li><strong>Example</strong>:<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service</span></span><br><span class="line">  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span></span><br><span class="line">  <span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">  <span class="hljs-attr">ports:</span></span><br><span class="line">    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span></span><br><span class="line">      <span class="hljs-attr">targetPort:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">      <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service-port</span></span><br><span class="line">      <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30000</span></span><br><span class="line">      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span></span><br></pre></td></tr></table></figure></li>
<li><strong>Answer</strong>:<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service</span></span><br><span class="line">    <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">    <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span></span><br><span class="line">    <span class="hljs-comment"># 要導向的 Pod</span></span><br><span class="line">    <span class="hljs-attr">selector:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">    <span class="hljs-attr">ports:</span></span><br><span class="line">          <span class="hljs-comment"># service 的 port</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span></span><br><span class="line">          <span class="hljs-comment"># 目標 Pod 的 port, 可直接使用 name mapping</span></span><br><span class="line">          <span class="hljs-attr">targetPort:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">          <span class="hljs-comment"># 此 service port 的 name</span></span><br><span class="line">          <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service-port</span></span><br><span class="line">          <span class="hljs-comment"># map 到 Node 上的 port</span></span><br><span class="line">          <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30000</span></span><br><span class="line">          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="以下的-Kubernetes-example-code-代表什麼意思？-2"><a href="#以下的-Kubernetes-example-code-代表什麼意思？-2" class="headerlink" title="以下的 Kubernetes example code 代表什麼意思？"></a><strong>以下的 Kubernetes example code 代表什麼意思？</strong></h6><ul>
<li><strong>Example</strong>:<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line">  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">  <span class="hljs-attr">labels:</span></span><br><span class="line">    <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">minReadySeconds:</span> <span class="hljs-number">5</span></span><br><span class="line">  <span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">matchLabels:</span></span><br><span class="line">      <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">  <span class="hljs-attr">template:</span></span><br><span class="line">    <span class="hljs-attr">metadata:</span></span><br><span class="line">      <span class="hljs-attr">labels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">    <span class="hljs-attr">spec:</span></span><br><span class="line">      <span class="hljs-attr">containers:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">          <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span></span><br><span class="line">          <span class="hljs-attr">ports:</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span></span><br><span class="line">              <span class="hljs-attr">name:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">          <span class="hljs-attr">env:</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_HOST</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">mysql-service:3306</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_USER</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_PASSWORD</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_NAME</span></span><br><span class="line">              <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br></pre></td></tr></table></figure></li>
<li><strong>Answer</strong>:<br>定義 env, 可參考 WordPress DockerHub</li>
</ul>
<h6 id="以下的-Kubernetes-example-code-代表什麼意思？-3"><a href="#以下的-Kubernetes-example-code-代表什麼意思？-3" class="headerlink" title="以下的 Kubernetes example code 代表什麼意思？"></a><strong>以下的 Kubernetes example code 代表什麼意思？</strong></h6><ul>
<li><strong>Example</strong>:<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">  <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line">  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">  <span class="hljs-attr">labels:</span></span><br><span class="line">    <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">  <span class="hljs-attr">minReadySeconds:</span> <span class="hljs-number">5</span></span><br><span class="line">  <span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">matchLabels:</span></span><br><span class="line">      <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">  <span class="hljs-attr">template:</span></span><br><span class="line">    <span class="hljs-attr">metadata:</span></span><br><span class="line">      <span class="hljs-attr">labels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">    <span class="hljs-attr">spec:</span></span><br><span class="line">      <span class="hljs-attr">initContainers:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">check-db-ready</span></span><br><span class="line">          <span class="hljs-attr">image:</span> <span class="hljs-string">imega/mysql-client</span></span><br><span class="line">          <span class="hljs-attr">command:</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;sh&#x27;</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-c&#x27;</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;until mysqladmin ping -h mysql-service &amp;&gt; /dev/null; do echo waiting; sleep 2; done&#x27;</span></span><br><span class="line">      <span class="hljs-attr">containers:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">          <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span></span><br><span class="line">          <span class="hljs-attr">ports:</span></span><br><span class="line">            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span></span><br><span class="line">              <span class="hljs-attr">name:</span> <span class="hljs-string">wp-pod-port</span></span><br></pre></td></tr></table></figure></li>
<li><strong>Answer</strong>:<br>使用 mysqladmin 確定 MySQL 已可提供服務後, 再啟動 wordpress container</li>
</ul>
<h6 id="以下的-Kubernetes-Deployment-code-selector-的對象是？"><a href="#以下的-Kubernetes-Deployment-code-selector-的對象是？" class="headerlink" title="以下的 Kubernetes Deployment code, selector 的對象是？"></a><strong>以下的 Kubernetes Deployment code, selector 的對象是？</strong></h6><ul>
<li><strong>Example</strong>:<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">selector:</span></span><br><span class="line">    <span class="hljs-attr">matchLabels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress</span></span><br></pre></td></tr></table></figure></li>
<li><strong>Answer</strong>:<br>該 Deployment 所管理的 Pod</li>
</ul>
<br>
<br>

<h2 id="all-in-one-YAML"><a href="#all-in-one-YAML" class="headerlink" title="# all-in-one YAML"></a># all-in-one YAML</h2><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">---</span></span><br><span class="line"><span class="hljs-meta"></span></span><br><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-deployment</span></span><br><span class="line">    <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">    <span class="hljs-attr">labels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-deployment</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">    <span class="hljs-attr">selector:</span></span><br><span class="line">        <span class="hljs-attr">matchLabels:</span></span><br><span class="line">            <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-pod</span></span><br><span class="line">    <span class="hljs-attr">template:</span></span><br><span class="line">        <span class="hljs-attr">metadata:</span></span><br><span class="line">            <span class="hljs-attr">labels:</span></span><br><span class="line">                <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-pod</span></span><br><span class="line">        <span class="hljs-attr">spec:</span></span><br><span class="line">            <span class="hljs-attr">containers:</span></span><br><span class="line">                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span></span><br><span class="line">                  <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span></span><br><span class="line">                  <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span></span><br><span class="line">                  <span class="hljs-attr">args:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">--default_authentication_plugin=mysql_native_password</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">--character-set-server=utf8mb4</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">                  <span class="hljs-attr">ports:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3306</span></span><br><span class="line">                        <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-pod-port</span></span><br><span class="line">                  <span class="hljs-attr">env:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">mysql_root_password</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_DATABASE</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_PASSWORD</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_USER</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                  <span class="hljs-attr">volumeMounts:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/mysql</span></span><br><span class="line">                        <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-db</span></span><br><span class="line">            <span class="hljs-attr">volumes:</span></span><br><span class="line">                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-db</span></span><br><span class="line">                  <span class="hljs-attr">hostPath:</span></span><br><span class="line">                      <span class="hljs-attr">path:</span> <span class="hljs-string">/var/lib/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">---</span></span><br><span class="line"><span class="hljs-meta"></span></span><br><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-service</span></span><br><span class="line">    <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">    <span class="hljs-attr">selector:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-pod</span></span><br><span class="line">    <span class="hljs-attr">ports:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span></span><br><span class="line">          <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-service-port</span></span><br><span class="line">          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span></span><br><span class="line">          <span class="hljs-attr">targetPort:</span> <span class="hljs-string">mysql-pod-port</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">---</span></span><br><span class="line"><span class="hljs-meta"></span></span><br><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line">    <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">    <span class="hljs-attr">labels:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">    <span class="hljs-attr">minReadySeconds:</span> <span class="hljs-number">5</span></span><br><span class="line">    <span class="hljs-attr">strategy:</span></span><br><span class="line">        <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span></span><br><span class="line">        <span class="hljs-attr">rollingUpdate:</span></span><br><span class="line">            <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">2</span></span><br><span class="line">            <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span></span><br><span class="line">    <span class="hljs-attr">selector:</span></span><br><span class="line">        <span class="hljs-attr">matchLabels:</span></span><br><span class="line">            <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">    <span class="hljs-attr">template:</span></span><br><span class="line">        <span class="hljs-attr">metadata:</span></span><br><span class="line">            <span class="hljs-attr">labels:</span></span><br><span class="line">                <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">        <span class="hljs-attr">spec:</span></span><br><span class="line">            <span class="hljs-attr">initContainers:</span></span><br><span class="line">                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">check-db-ready</span></span><br><span class="line">                  <span class="hljs-attr">image:</span> <span class="hljs-string">imega/mysql-client</span></span><br><span class="line">                  <span class="hljs-attr">command:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;sh&#x27;</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-c&#x27;</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;until mysqladmin ping -h mysql-service &amp;&gt; /dev/null; do echo waiting; sleep 2; done&#x27;</span></span><br><span class="line">            <span class="hljs-attr">containers:</span></span><br><span class="line">                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                  <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                  <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span></span><br><span class="line">                  <span class="hljs-attr">ports:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span></span><br><span class="line">                        <span class="hljs-attr">name:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">                  <span class="hljs-attr">env:</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_HOST</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">mysql-service:3306</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_USER</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_PASSWORD</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WORDPRESS_DB_NAME</span></span><br><span class="line">                        <span class="hljs-attr">value:</span> <span class="hljs-string">wordpress</span></span><br><span class="line">                  <span class="hljs-attr">resources:</span></span><br><span class="line">                      <span class="hljs-attr">limits:</span></span><br><span class="line">                          <span class="hljs-attr">cpu:</span> <span class="hljs-string">200m</span></span><br><span class="line">                          <span class="hljs-attr">memory:</span> <span class="hljs-string">200Mi</span></span><br><span class="line">                      <span class="hljs-attr">requests:</span></span><br><span class="line">                          <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span></span><br><span class="line">                          <span class="hljs-attr">memory:</span> <span class="hljs-string">200Mi</span></span><br><span class="line">                  <span class="hljs-attr">startupProbe:</span></span><br><span class="line">                      <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">                          <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">                      <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span></span><br><span class="line">                      <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">60</span></span><br><span class="line">                      <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">                      <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span></span><br><span class="line">                  <span class="hljs-attr">livenessProbe:</span></span><br><span class="line">                      <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">                          <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">                      <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span></span><br><span class="line">                      <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span></span><br><span class="line">                      <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">                  <span class="hljs-attr">readinessProbe:</span></span><br><span class="line">                      <span class="hljs-attr">tcpSocket:</span></span><br><span class="line">                          <span class="hljs-attr">port:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">                      <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line">                      <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">---</span></span><br><span class="line"><span class="hljs-meta"></span></span><br><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service</span></span><br><span class="line">    <span class="hljs-attr">namespace:</span> <span class="hljs-string">wordpress</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">    <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span></span><br><span class="line">    <span class="hljs-attr">selector:</span></span><br><span class="line">        <span class="hljs-attr">app:</span> <span class="hljs-string">wordpress-pod</span></span><br><span class="line">    <span class="hljs-attr">ports:</span></span><br><span class="line">        <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span></span><br><span class="line">          <span class="hljs-attr">targetPort:</span> <span class="hljs-string">wp-pod-port</span></span><br><span class="line">          <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-service-port</span></span><br><span class="line">          <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30000</span></span><br><span class="line">          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">---</span></span><br><span class="line"><span class="hljs-meta"></span></span><br><span class="line"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">autoscaling/v1</span></span><br><span class="line"><span class="hljs-attr">kind:</span> <span class="hljs-string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="hljs-attr">metadata:</span></span><br><span class="line">    <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-hpa</span></span><br><span class="line"><span class="hljs-attr">spec:</span></span><br><span class="line">    <span class="hljs-attr">scaleTargetRef:</span></span><br><span class="line">        <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span></span><br><span class="line">        <span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span></span><br><span class="line">        <span class="hljs-attr">name:</span> <span class="hljs-string">wordpress-deployment</span></span><br><span class="line">    <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span></span><br><span class="line">    <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">15</span></span><br><span class="line">    <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">50</span></span><br></pre></td></tr></table></figure>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Kubernetes/">#Kubernetes</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/WordPress/">#WordPress</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/zh-tw/kubernetes-daemonset/">Kubernetes - DaemonSet</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/zh-tw/install-dashboard-on-kubernetes/">Kubernetes - Dashboard - 使用自定義 Service Account 登入</a>
            
        </span>
    </div>
    
</article>


<div class="sharebox">
    
<div class="sharethis-inline-share-buttons"></div>
<script type='text/javascript' src='//platform-api.sharethis.com/js/sharethis.js#property=5c72643b9ea706001139fd89&amp;product=inline-share-buttons' async='async'></script>

</div>



<div class="comments">
    <h3 class="title is-4">留言</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'https://tn710617.github.io/zh-tw/deploy-wordpress-on-kubernetes/';
        this.page.identifier = 'zh-tw/deploy-wordpress-on-kubernetes/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'rayscodingjourney' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2022 Ray&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
                mermaid.initialize({ theme: 'default' });
            </script>

            
            
            <a class="navbar-item" title="GitHub" target="_blank" rel="noopener" href="https://github.com/tn710617">
                
                    <i class="fab fa-github"></i>
                
            </a>
            
            <a class="navbar-item" title="Medium" target="_blank" rel="noopener" href="https://medium.com/@raycodingjourney">
                
                    <i class="fab fa-medium"></i>
                
            </a>
            
            <a class="navbar-item" title="Linkedin" target="_blank" rel="noopener" href="https://www.linkedin.com/in/ray-lee-99315315a">
                
                    <i class="fab fa-linkedin"></i>
                
            </a>
            
            <a class="navbar-item" title="Facebook" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=100001626039430">
                
                    <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="navbar-item" title="CakeResume" target="_blank" rel="noopener" href="https://www.cakeresume.com/resumes/ray-6edaef/edit">
                
                    <i class="far fa-address-card"></i>
                
            </a>
            
            <a class="navbar-item" title="E-Mail" href="mailto:tn710617@gmail.com">
                
                    <i class="far fa-envelope"></i>
                
            </a>
            
            <a class="navbar-item" title="Skype" href="skype:adad0310?call|chat">
                
                    <i class="fab fa-skype"></i>
                
            </a>
            
            

        </div>
    </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站內搜尋" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '頁面',
                CATEGORIES: '分類',
                TAGS: '標籤',
                UNTITLED: '(無標題)',
            },
            CONTENT_URL: '/content.zh-tw.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>