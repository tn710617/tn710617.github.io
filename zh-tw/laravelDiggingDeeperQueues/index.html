<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Laravel - Digging Deeper - Queues - Learn or Die</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="# Introduction學習一個框架, Ray 的想法是, 在深入理解底層實作的原理之前, 應該先知道這個框架的 使用方法; 先學習怎麼使用這個前人造的輪子, 再學習怎麼樣造一個輪子。所以本篇文章重點在於細讀官方文件, 並將內容理解後以 Q&amp;amp;A 的方式記錄下來, 加速學習以及查詢。">
<meta name="keywords" content="Laravel,Laravel Documentation,Laravel Queues">
<meta property="og:type" content="article">
<meta property="og:title" content="Laravel - Digging Deeper - Queues">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/laravelDiggingDeeperQueues/index.html">
<meta property="og:site_name" content="Learn or Die">
<meta property="og:description" content="# Introduction學習一個框架, Ray 的想法是, 在深入理解底層實作的原理之前, 應該先知道這個框架的 使用方法; 先學習怎麼使用這個前人造的輪子, 再學習怎麼樣造一個輪子。所以本篇文章重點在於細讀官方文件, 並將內容理解後以 Q&amp;amp;A 的方式記錄下來, 加速學習以及查詢。">
<meta property="og:locale" content="zh-tw">
<meta property="og:updated_time" content="2021-01-01T04:11:37.764Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Laravel - Digging Deeper - Queues">
<meta name="twitter:description" content="# Introduction學習一個框架, Ray 的想法是, 在深入理解底層實作的原理之前, 應該先知道這個框架的 使用方法; 先學習怎麼使用這個前人造的輪子, 再學習怎麼樣造一個輪子。所以本篇文章重點在於細讀官方文件, 並將內容理解後以 Q&amp;amp;A 的方式記錄下來, 加速學習以及查詢。">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


    <link href="/laravelDiggingDeeperQueues/" rel="alternate" hreflang="en">








    <meta name="description" content="# Introduction學習一個框架, Ray 的想法是, 在深入理解底層實作的原理之前, 應該先知道這個框架的 使用方法; 先學習怎麼使用這個前人造的輪子, 再學習怎麼樣造一個輪子。所以本篇文章重點在於細讀官方文件, 並將內容理解後以 Q&amp;amp;A 的方式記錄下來, 加速學習以及查詢。">
<meta name="keywords" content="Laravel,Laravel Documentation,Laravel Queues">
<meta property="og:type" content="article">
<meta property="og:title" content="Laravel - Digging Deeper - Queues">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/laravelDiggingDeeperQueues/index.html">
<meta property="og:site_name" content="Learn or Die">
<meta property="og:description" content="# Introduction學習一個框架, Ray 的想法是, 在深入理解底層實作的原理之前, 應該先知道這個框架的 使用方法; 先學習怎麼使用這個前人造的輪子, 再學習怎麼樣造一個輪子。所以本篇文章重點在於細讀官方文件, 並將內容理解後以 Q&amp;amp;A 的方式記錄下來, 加速學習以及查詢。">
<meta property="og:locale" content="zh-tw">
<meta property="og:updated_time" content="2021-01-01T04:11:37.764Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Laravel - Digging Deeper - Queues">
<meta name="twitter:description" content="# Introduction學習一個框架, Ray 的想法是, 在深入理解底層實作的原理之前, 應該先知道這個框架的 使用方法; 先學習怎麼使用這個前人造的輪子, 再學習怎麼樣造一個輪子。所以本篇文章重點在於細讀官方文件, 並將內容理解後以 Q&amp;amp;A 的方式記錄下來, 加速學習以及查詢。">





    <link rel="icon" href="/images/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/sunburst.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
        
    
        
    
        
    
        
    
        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135063928-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-135063928-1');
</script>


    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/zh-tw">
                
                    
                    不學會死
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/zh-tw/archives">歸檔</a>
            
            <a class="navbar-item " href="/zh-tw/categories">分類</a>
            
            <a class="navbar-item " href="/zh-tw/tags">標籤</a>
            
            <a class="navbar-item " href="/zh-tw/schedule">行程</a>
            
            <a class="navbar-item " href="/zh-tw/about">關於</a>
            
            <a class="navbar-item " href="/zh-tw/japanese">日語</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜尋" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="目錄">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#Introduction">1&nbsp;&nbsp;<b># Introduction</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Connection-Vs-Queues">2&nbsp;&nbsp;<b># Connection Vs. Queues</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#在以下的-Laravel-Queue-的程式碼-job-會被送往哪裡？">2.1.1&nbsp;&nbsp;在以下的 Laravel Queue 的程式碼, job 會被送往哪裡？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在以下的-Laravel-Queue-的程式碼-job-會被送往哪裡？-1">2.1.2&nbsp;&nbsp;在以下的 Laravel Queue 的程式碼, job 會被送往哪裡？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？">2.1.3&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Driver-Notes-amp-Prerequisites">3&nbsp;&nbsp;<b># Driver Notes &amp;amp;amp; Prerequisites</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Database">3.1&nbsp;&nbsp;# Database</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-如果我使用的-driver-為-database-該如何建立-queue-table">3.1.1&nbsp;&nbsp;在 Laravel 中, 如果我使用的 driver 為 database, 該如何建立 queue table?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Redis">3.2&nbsp;&nbsp;# Redis</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-的-QUEUE-當中-如果我使用-redis-為-driver-該如何設定-redis-的-database-connection">3.2.1&nbsp;&nbsp;在 Laravel 的 QUEUE 當中, 如果我使用 redis 為 driver, 該如何設定 redis 的 database connection?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Redis-Cluster">3.3&nbsp;&nbsp;# Redis Cluster</a>
                    
                    
                    
                    <a class="navbar-item" href="#如果是使用-Redis-Cluster-queue-的名稱需要包含什麼？">3.3.1&nbsp;&nbsp;如果是使用 Redis Cluster, queue 的名稱需要包含什麼？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Blocking">3.4&nbsp;&nbsp;# Blocking</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-當中-如果我使用-redis-且我想要讓-redis-在進去下一輪的-polling-之前等待數秒-看有沒有新的-job-進來-我可以怎麼做？">3.4.1&nbsp;&nbsp;在 Laravel Queue 當中, 如果我使用 redis, 且我想要讓 redis 在進去下一輪的 polling 之前等待數秒, 看有沒有新的 job 進來, 我可以怎麼做？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Creating-Jobs">4&nbsp;&nbsp;<b># Creating Jobs</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Generating-Job-Classes">4.1&nbsp;&nbsp;# Generating Job Classes</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-中-一般-job-都會放在哪？">4.1.1&nbsp;&nbsp;Laravel 中, 一般 job 都會放在哪？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-中-如何建立一個-Job">4.1.2&nbsp;&nbsp;Laravel 中, 如何建立一個 Job?</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-當我們注入一個-Model-到-Job-是會整個-Model-都被注入-還是只會注入該-Model-的一個辨識物？">4.1.3&nbsp;&nbsp;在 Laravel 中, 當我們注入一個 Model 到 Job, 是會整個 Model 都被注入, 還是只會注入該 Model 的一個辨識物？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-當我在-job-中注入一個-model-當這個-job-被在-queue-中被取出執行時-請入該-model-會是我當初注入時的狀態-還是目前資料庫中最新的狀態？">4.1.4&nbsp;&nbsp;在 Laravel 中, 當我在 job 中注入一個 model, 當這個 job 被在 queue 中被取出執行時, 請入該 model 會是我當初注入時的狀態, 還是目前資料庫中最新的狀態？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Handling-Relationships">4.2&nbsp;&nbsp;# Handling Relationships</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下位於-job-的-Laravel-example-code-的意思是？">4.2.1&nbsp;&nbsp;以下位於 job 的 Laravel example code 的意思是？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Job-Middleware">5&nbsp;&nbsp;<b># Job Middleware</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-中-可以建立一個-Job-middleware-嗎？">5.1.1&nbsp;&nbsp;在 Laravel Queue 中, 可以建立一個 Job middleware 嗎？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-中-如果我想要建立一個-Job-Middleware-可以建立在什麼位置？">5.1.2&nbsp;&nbsp;在 Laravel Queue 中, 如果我想要建立一個 Job Middleware, 可以建立在什麼位置？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-中-如果我要建立一個-Job-Middleware-如何建立？">5.1.3&nbsp;&nbsp;在 Laravel Queue 中, 如果我要建立一個 Job Middleware, 如何建立？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-中-如果我要在一個-Job-中使用建立好的-Job-Middleware-我可以怎麼做？">5.1.4&nbsp;&nbsp;在 Laravel Queue 中, 如果我要在一個 Job 中使用建立好的 Job Middleware, 我可以怎麼做？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Dispatching-Jobs">6&nbsp;&nbsp;<b># Dispatching Jobs</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-中-該如何-dispatch-一個-job">6.1.1&nbsp;&nbsp;在 Laravel Queue 中, 該如何 dispatch 一個 job?</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Delayed-Dispatching">7&nbsp;&nbsp;<b># Delayed Dispatching</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-1">7.1.1&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-中-AWS-的-SQS-最多支援到-delay-多久？">7.1.2&nbsp;&nbsp;在 Laravel Queue 中, AWS 的 SQS 最多支援到 delay 多久？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Synchronous-Dispatching">8&nbsp;&nbsp;<b># Synchronous Dispatching</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-2">8.1.1&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Queue-中-如果我立即-dispatch-一個-job-不要-queue-那我可以怎麼做？">8.1.2&nbsp;&nbsp;在 Laravel Queue 中, 如果我立即 dispatch 一個 job, 不要 queue, 那我可以怎麼做？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Job-Chaining">9&nbsp;&nbsp;<b># Job Chaining</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Job-chaining-中-如果其中一個-job-失敗了-後面的還會繼續執行嗎？">9.1.1&nbsp;&nbsp;在 Laravel Job chaining 中, 如果其中一個 job 失敗了, 後面的還會繼續執行嗎？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-Job-chaining-中-如果我使用-this-gt-delete-會終止後面的-job-執行嗎？">9.1.2&nbsp;&nbsp;在 Laravel Job chaining 中, 如果我使用 $this-&amp;amp;gt;delete(), 會終止後面的 job 執行嗎？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-如何實作一個-job-chaining">9.1.3&nbsp;&nbsp;在 Laravel, 如何實作一個 job chaining?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Chain-Connection-amp-Queue">9.2&nbsp;&nbsp;# Chain Connection &amp;amp;amp; Queue</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-當我使用-job-chaining-時-如何指定這個-job-chaining-使用的-connection-以及-queue">9.2.1&nbsp;&nbsp;在 Laravel, 當我使用 job chaining 時, 如何指定這個 job chaining 使用的 connection 以及 queue?</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Customizing-The-Queue-amp-Connection">10&nbsp;&nbsp;<b># Customizing The Queue &amp;amp;amp; Connection</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Dispatching-To-A-Particular-Queue">10.1&nbsp;&nbsp;# Dispatching To A Particular Queue</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-job-當中-如何指定特定的-queue">10.1.1&nbsp;&nbsp;在 Laravel job 當中, 如何指定特定的 queue?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Dispatching-To-A-Particular-Connection">10.2&nbsp;&nbsp;# Dispatching To A Particular Connection</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-job-當中-如果我使用不只一個-connection-如何指定特定的-connection">10.2.1&nbsp;&nbsp;在 Laravel job 當中, 如果我使用不只一個 connection, 如何指定特定的 connection?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-job-當中-如果我想要從該-job-的-class-中指定該-job-使用的-connection-我可以怎麼做？">10.2.2&nbsp;&nbsp;Laravel job 當中, 如果我想要從該 job 的 class 中指定該 job 使用的 connection, 我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-job-當中-如果我想要同時指定該-job-特定的-connection-以及-queue-時-我可以怎麼做？">10.2.3&nbsp;&nbsp;Laravel job 當中, 如果我想要同時指定該 job 特定的 connection 以及 queue 時, 我可以怎麼做？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Specifying-Max-Job-Attempts-Timeout-Values">11&nbsp;&nbsp;<b># Specifying Max Job Attempts / Timeout Values</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Max-Attempts">11.1&nbsp;&nbsp;# Max Attempts</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-3">11.1.1&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-4">11.1.2&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-job-當中-當我同時在-job-class-中-以及-CLI-中都指令最大嘗試次數-Laravel-會以誰為準？">11.1.3&nbsp;&nbsp;Laravel job 當中, 當我同時在 job class 中, 以及 CLI 中都指令最大嘗試次數, Laravel 會以誰為準？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Time-Based-Attempts">11.2&nbsp;&nbsp;# Time Based Attempts</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-5">11.2.1&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Timeout">11.3&nbsp;&nbsp;# Timeout</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-job-當中-如果我要指定任務可以執行的最大秒數-通過-CLI-我可以怎麼做？">11.3.1&nbsp;&nbsp;Laravel job 當中, 如果我要指定任務可以執行的最大秒數, 通過 CLI, 我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-6">11.3.2&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-job-當中-如果我再-CLI-以及-job-的-class-同時定義的-timeout-哪一個的優先權比較大？">11.3.3&nbsp;&nbsp;Laravel job 當中, 如果我再 CLI 以及 job 的 class 同時定義的 timeout, 哪一個的優先權比較大？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Rate-Limiting">12&nbsp;&nbsp;<b># Rate Limiting</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-當中-如果我想使用-rate-limiting-哪一個服務會是必要的？">12.1.1&nbsp;&nbsp;Laravel queue 當中, 如果我想使用 rate limiting, 哪一個服務會是必要的？</a>
                    
                    
                    
                    <a class="navbar-item" href="#下面的-Laravel-程式碼代表什麼意思？">12.1.2&nbsp;&nbsp;下面的 Laravel 程式碼代表什麼意思？</a>
                    
                    
                    
                    <a class="navbar-item" href="#下面的-Laravel-程式碼中的-key-代表什麼意思？">12.1.3&nbsp;&nbsp;下面的 Laravel 程式碼中的 key, 代表什麼意思？</a>
                    
                    
                    
                    <a class="navbar-item" href="#下面的-Laravel-程式碼中-當我-release-該-job-這樣還會增加該-job-的-attempt-次數嗎？">12.1.4&nbsp;&nbsp;下面的 Laravel 程式碼中, 當我 release 該 job, 這樣還會增加該 job 的 attempt 次數嗎？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-7">12.1.5&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Queueing-Closures">13&nbsp;&nbsp;<b># Queueing Closures</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-什麼情況我們可能會需要-dispatch-一個-closure">13.1.1&nbsp;&nbsp;在 Laravel 中, 什麼情況我們可能會需要 dispatch 一個 closure?</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-如何-dispatch-一個-closure">13.1.2&nbsp;&nbsp;在 Laravel 中, 如何 dispatch 一個 closure?</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Running-The-Queue-Worker">14&nbsp;&nbsp;<b># Running The Queue Worker</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-怎麼樣啟動-worker-來執行-queued-job">14.1.1&nbsp;&nbsp;在 Laravel 中, 怎麼樣啟動 worker 來執行 queued job?</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-要維持-worker-持續運行-我們需要額外啟動什麼？">14.1.2&nbsp;&nbsp;在 Laravel 中, 要維持 worker 持續運行, 我們需要額外啟動什麼？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-當我使用-php-artisan-queue-work-當我代碼有變更時-我需要重新啟動-queue-嗎？">14.1.3&nbsp;&nbsp;在 Laravel 中, 當我使用 php artisan queue:work, 當我代碼有變更時, 我需要重新啟動 queue 嗎？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-如果我運行-php-artisan-queue-listen-然後我變更了代碼-我需要再重新啟動-queue-嗎？">14.1.4&nbsp;&nbsp;在 Laravel 中, 如果我運行 php artisan queue:listen, 然後我變更了代碼, 我需要再重新啟動 queue 嗎？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-如果我不想要每次變更代碼就重新啟動-queue-我可以使用哪一個-CLI">14.1.5&nbsp;&nbsp;在 Laravel 中, 如果我不想要每次變更代碼就重新啟動 queue, 我可以使用哪一個 CLI?</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-php-artisan-queue-work-跟-php-artisan-queue-listen-何者較有效率？">14.1.6&nbsp;&nbsp;在 Laravel 中, php artisan queue:work 跟 php artisan queue:listen 何者較有效率？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Specifying-The-Connection-amp-Queue">14.2&nbsp;&nbsp;# Specifying The Connection &amp;amp;amp; Queue</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-如何透過-CLI-指定-queue-connection">14.2.1&nbsp;&nbsp;在 Laravel 中, 如何透過 CLI 指定 queue connection?</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-如何透過-CLI-給特定的-queue-指定特定-connection">14.2.2&nbsp;&nbsp;在 Laravel 中, 如何透過 CLI 給特定的 queue 指定特定 connection?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Processing-A-Single-Job">14.3&nbsp;&nbsp;# Processing A Single Job</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-中-如何透過-CLI-指定-worker-只執行-queued-job-一次">14.3.1&nbsp;&nbsp;在 Laravel 中, 如何透過 CLI 指定 worker 只執行 queued job 一次</a>
                    
                    
                    
                    <a class="navbar-item" href="#Processing-All-Queued-Jobs-amp-Then-Exiting">14.4&nbsp;&nbsp;# Processing All Queued Jobs &amp;amp;amp; Then Exiting</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-command-的意思是？">14.4.1&nbsp;&nbsp;以下的 Laravel example command 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-指令什麼時候可能會用到？">14.4.2&nbsp;&nbsp;以下的 Laravel 指令什麼時候可能會用到？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Resource-Considerations">14.5&nbsp;&nbsp;# Resource Considerations</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-的-queue-中-因為會緩存在-RAM-中運行-所以如果我有執行到未釋放的資源-像是-image-之類的-那我是否要在-job-執行完成之後釋放掉這些資源？">14.5.1&nbsp;&nbsp;在 Laravel 的 queue 中, 因為會緩存在 RAM 中運行, 所以如果我有執行到未釋放的資源, 像是 image 之類的, 那我是否要在 job 執行完成之後釋放掉這些資源？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Queue-Priorities">15&nbsp;&nbsp;<b># Queue Priorities</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-的-queue-中-我要如何排列-queue-的優先順序？">15.1.1&nbsp;&nbsp;在 Laravel 的 queue 中, 我要如何排列 queue 的優先順序？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Queue-Workers-amp-Deployment">16&nbsp;&nbsp;<b># Queue Workers &amp;amp;amp; Deployment</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Job-Expiration">16.1&nbsp;&nbsp;# Job Expiration</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-的-queue-監聽程序中-我要如何重啟-queue？">16.1.1&nbsp;&nbsp;在 Laravel 的 queue 監聽程序中, 我要如何重啟 queue？</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-Laravel-的-queue-監聽-CLI-php-artisan-queue-restart-會不會讓我丟失執行到一半的工作？">16.1.2&nbsp;&nbsp;在 Laravel 的 queue 監聽 CLI php artisan queue:restart, 會不會讓我丟失執行到一半的工作？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-中-在沒有使用-supervisor-的情況下-如果我執行-php-artisan-queue-restart-會發生什麼事？">16.1.3&nbsp;&nbsp;Laravel 中, 在沒有使用 supervisor 的情況下, 如果我執行 php artisan queue:restart, 會發生什麼事？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-中-若要使用-php-artisan-queue-restart-務必先要確認什麼服務已經設置好？">16.1.4&nbsp;&nbsp;Laravel 中, 若要使用 php artisan queue:restart, 務必先要確認什麼服務已經設置好？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-中-當我使用-php-artisan-queue-restart-queue-會將-restart-的-signal-存在什麼地方？">16.1.5&nbsp;&nbsp;Laravel 中, 當我使用 php artisan queue:restart, queue 會將 restart 的 signal 存在什麼地方？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-如果我要指定一個-job-在執行之後多久時間之後才可以再被執行-如果沒被刪除的話-我可以怎麼做？">16.1.6&nbsp;&nbsp;Laravel queue 中, 如果我要指定一個 job 在執行之後多久時間之後才可以再被執行 (如果沒被刪除的話), 我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-哪一個服務無法在-queue-php-config-中設定-retry-after-參數">16.1.7&nbsp;&nbsp;Laravel queue 中, 哪一個服務無法在 queue.php config 中設定 retry_after 參數</a>
                    
                    
                    
                    <a class="navbar-item" href="#Worker-Timeouts">16.2&nbsp;&nbsp;# Worker Timeouts</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-timeout-跟-retry-after-的差別在哪？">16.2.1&nbsp;&nbsp;Laravel queue 中, --timeout 跟 retry_after 的差別在哪？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-timeout-跟-retry-after-的時間-哪個長哪個短？">16.2.2&nbsp;&nbsp;Laravel queue 中, --timeout 跟 retry_after 的時間, 哪個長哪個短？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-如果-retry-after-比-timeout-設定的時間還短-可能會發生什麼事？">16.2.3&nbsp;&nbsp;Laravel queue 中, 如果 retry_after 比 --timeout 設定的時間還短, 可能會發生什麼事？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Worker-Sleep-Duration">16.3&nbsp;&nbsp;# Worker Sleep Duration</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-如果我要讓-worker-沒有新的-job-時會進入休眠狀態-那我可以怎麼做？">16.3.1&nbsp;&nbsp;Laravel queue 中, 如果我要讓 worker 沒有新的 job 時會進入休眠狀態, 那我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-如果我有使用-sleep-的-option-當-queue-裡頭有很多-job-還沒有執行完畢時-worker-會進入-sleep-狀態嗎？">16.3.2&nbsp;&nbsp;Laravel queue 中, 如果我有使用 --sleep 的 option, 當 queue 裡頭有很多 job 還沒有執行完畢時, worker 會進入 sleep 狀態嗎？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-如果我有使用-sleep-的-option-當-worker-處於-sleep-的狀態時-如果有新的-job-進來-worker-會等到-sleep-結束再處理-還是會立即處理？">16.3.3&nbsp;&nbsp;Laravel queue 中, 如果我有使用 --sleep 的 option, 當 worker 處於 sleep 的狀態時, 如果有新的 job 進來, worker 會等到 sleep 結束再處理, 還是會立即處理？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Supervisor-Configuration">17&nbsp;&nbsp;<b># Supervisor Configuration</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Installing-Supervisor">17.1&nbsp;&nbsp;# Installing Supervisor</a>
                    
                    
                    
                    <a class="navbar-item" href="#如何安裝-supervisor">17.1.1&nbsp;&nbsp;如何安裝 supervisor ?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Supervisor-的設定檔位置在哪？">17.1.2&nbsp;&nbsp;Supervisor 的設定檔位置在哪？</a>
                    
                    
                    
                    <a class="navbar-item" href="#我該如何設定-Supervisor-設定檔？">17.1.3&nbsp;&nbsp;我該如何設定 Supervisor 設定檔？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Starting-Supervisor">17.2&nbsp;&nbsp;# Starting Supervisor</a>
                    
                    
                    
                    <a class="navbar-item" href="#Supervisor-如何重新讀取-config-檔-但不重啟-process">17.2.1&nbsp;&nbsp;Supervisor 如何重新讀取 config 檔, 但不重啟 process?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Supervisor-如何重新讀取-config-檔-並依照-config-檔案重啟-process">17.2.2&nbsp;&nbsp;Supervisor 如何重新讀取 config 檔, 並依照 config 檔案重啟 process?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Supervisor-如何啟動">17.2.3&nbsp;&nbsp;Supervisor 如何啟動?</a>
                    
                    
                    
                    <a class="navbar-item" href="#Supervisor-官方文件位址">17.2.4&nbsp;&nbsp;Supervisor 官方文件位址?</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Dealing-With-Failed-Jobs">18&nbsp;&nbsp;<b># Dealing With Failed Jobs</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-當一個-job-一直執行失敗-超出了指定的-tries-的限制-那這個-job-會跑到哪裡去？">18.1.1&nbsp;&nbsp;Laravel queue 中, 當一個 job 一直執行失敗, 超出了指定的 tries 的限制, 那這個 job 會跑到哪裡去？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-queue-中-如何建立-failed-jobs-table">18.1.2&nbsp;&nbsp;Laravel queue 中, 如何建立 failed_jobs table?</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-8">18.1.3&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#以下位於-job-的-Laravel-example-code-的意思是？-1">18.1.4&nbsp;&nbsp;以下位於 job 的 Laravel example code 的意思是？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Cleaning-Up-After-Failed-Jobs">19&nbsp;&nbsp;<b># Cleaning Up After Failed Jobs</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-中-當我一個-job-failed-我想要在它-fail-的時候發通知-我可以在哪一個地方寫這個邏輯？">19.1.1&nbsp;&nbsp;Laravel 中, 當我一個 job failed, 我想要在它 fail 的時候發通知, 我可以在哪一個地方寫這個邏輯？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Failed-Job-Events">20&nbsp;&nbsp;<b># Failed Job Events</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-9">20.1.1&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Retrying-Failed-Jobs">21&nbsp;&nbsp;<b># Retrying Failed Jobs</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#以下的-Laravel-example-code-的意思是？-10">21.1.1&nbsp;&nbsp;以下的 Laravel example code 的意思是？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我要使用-CLI-獲取-failed-jobs-的-ID-我可以怎麼做？">21.1.2&nbsp;&nbsp;Laravel Queue 中, 如果我要使用 CLI 獲取 failed jobs 的 ID, 我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我要從-CLI-retry-特定的-failed-jobs-我可以怎麼做？">21.1.3&nbsp;&nbsp;Laravel Queue 中, 如果我要從 CLI retry 特定的 failed jobs, 我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我要從-CLI-retry-所有的-failed-jobs-我可以怎麼做？">21.1.4&nbsp;&nbsp;Laravel Queue 中, 如果我要從 CLI retry 所有的 failed jobs, 我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我要從-CLI-刪除一個-failed-job-我可以怎麼做？">21.1.5&nbsp;&nbsp;Laravel Queue 中, 如果我要從 CLI 刪除一個 failed job, 我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我要從-CLI-刪除所有的-failed-jobs-我可以怎麼做？">21.1.6&nbsp;&nbsp;Laravel Queue 中, 如果我要從 CLI 刪除所有的 failed jobs, 我可以怎麼做？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Ignoring-Missing-Models">22&nbsp;&nbsp;<b># Ignoring Missing Models</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-我們注入一個-Eloquent-model-到一個-job-當中-而當執行該-job-時-該-model-已遭刪除-這時會發生什麼事？">22.1.1&nbsp;&nbsp;Laravel Queue 中, 我們注入一個 Eloquent model 到一個 job 當中, 而當執行該 job 時, 該 model 已遭刪除, 這時會發生什麼事？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-我們注入一個-Eloquent-model-到一個-job-當中-而當執行該-job-時-該-model-已遭刪除-這時會報錯-ModelNotFoundException-如何設定當遇到這種情況時-自動刪除-job？">22.1.2&nbsp;&nbsp;Laravel Queue 中, 我們注入一個 Eloquent model 到一個 job 當中, 而當執行該 job 時, 該 model 已遭刪除, 這時會報錯, ModelNotFoundException, 如何設定當遇到這種情況時, 自動刪除 job？</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Job-Events">23&nbsp;&nbsp;<b># Job Events</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我想要在-job-事件執行前做一些事-那麼我可以怎麼做？">23.1.1&nbsp;&nbsp;Laravel Queue 中, 如果我想要在 job 事件執行前做一些事, 那麼我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我想要在-job-事件執行後做一些事-那麼我可以怎麼做？">23.1.2&nbsp;&nbsp;Laravel Queue 中, 如果我想要在 job 事件執行後做一些事, 那麼我可以怎麼做？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-以下的程式碼通常可以應用在什麼情況？">23.1.3&nbsp;&nbsp;Laravel Queue 中, 以下的程式碼通常可以應用在什麼情況？</a>
                    
                    
                    
                    <a class="navbar-item" href="#Laravel-Queue-中-如果我想要設定一個-closure-當我的-worker-要從-queue-fetch-新的-job-回來執行之前-執行這個-closure-那我可以怎麼做？">23.1.4&nbsp;&nbsp;Laravel Queue 中, 如果我想要設定一個 closure, 當我的 worker 要從 queue fetch 新的 job 回來執行之前, 執行這個 closure, 那我可以怎麼做？</a>
                    
                </div>
            </div>
            

            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true" aria-controls="dropdown-menu7">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>繁體中文</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            
                <a href="/laravelDiggingDeeperQueues/" class="dropdown-item">
                    English
                </a>
            
                <a href="/zh-tw/laravelDiggingDeeperQueues/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Laravel - Digging Deeper - Queues
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-12-31T02:30:57.000Z" itemprop="datePublished">12月 31 2019</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/zh-tw/categories/Dev/">Dev</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            29 分钟 讀完 (大概 4343 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="# Introduction"></a># Introduction</h2><p>學習一個框架, Ray 的想法是, 在深入理解底層實作的原理之前, 應該先知道這個框架的 <code>使用方法</code>; 先學習怎麼<strong>使用</strong>這個前人造的輪子, 再學習怎麼樣<strong>造</strong>一個輪子。<br>所以本篇文章重點在於細讀<strong>官方文件</strong>, 並將內容理解後以 <strong>Q&amp;A</strong> 的方式記錄下來, 加速學習以及查詢。</p>
<a id="more"></a>
<p><br><br><br></p>
<h2 id="Connection-Vs-Queues"><a href="#Connection-Vs-Queues" class="headerlink" title="# Connection Vs. Queues"></a># Connection Vs. Queues</h2><h6 id="在以下的-Laravel-Queue-的程式碼-job-會被送往哪裡？"><a href="#在以下的-Laravel-Queue-的程式碼-job-會被送往哪裡？" class="headerlink" title="在以下的 Laravel Queue 的程式碼, job 會被送往哪裡？"></a><strong>在以下的 Laravel Queue 的程式碼, job 會被送往哪裡？</strong></h6><p>會被送往預設的 queue<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">Job::dispatch();</span><br></pre></td></tr></table></figure></p>
<h6 id="在以下的-Laravel-Queue-的程式碼-job-會被送往哪裡？-1"><a href="#在以下的-Laravel-Queue-的程式碼-job-會被送往哪裡？-1" class="headerlink" title="在以下的 Laravel Queue 的程式碼, job 會被送往哪裡？"></a><strong>在以下的 Laravel Queue 的程式碼, job 會被送往哪裡？</strong></h6><p>會被送往自定義的 emails queue<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">Job::dispatch()-&gt;onQueue(<span class="hljs-string">'emails'</span>);</span><br></pre></td></tr></table></figure></p>
<h6 id="以下的-Laravel-example-code-的意思是？"><a href="#以下的-Laravel-example-code-的意思是？" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --queue=high,default</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>啟動 queue daemon, 並排序 queue 的優先順序 high,default</p>
</li>
</ul>
<p><br><br><br></p>
<h2 id="Driver-Notes-amp-Prerequisites"><a href="#Driver-Notes-amp-Prerequisites" class="headerlink" title="# Driver Notes &amp; Prerequisites"></a># Driver Notes &amp; Prerequisites</h2><h3 id="Database"><a href="#Database" class="headerlink" title="# Database"></a># Database</h3><h6 id="在-Laravel-中-如果我使用的-driver-為-database-該如何建立-queue-table"><a href="#在-Laravel-中-如果我使用的-driver-為-database-該如何建立-queue-table" class="headerlink" title="在 Laravel 中, 如果我使用的 driver 為 database, 該如何建立 queue table?"></a><strong>在 Laravel 中, 如果我使用的 driver 為 database, 該如何建立 queue table?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:table</span><br><span class="line">php artisan migrate</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="# Redis"></a># Redis</h3><h6 id="在-Laravel-的-QUEUE-當中-如果我使用-redis-為-driver-該如何設定-redis-的-database-connection"><a href="#在-Laravel-的-QUEUE-當中-如果我使用-redis-為-driver-該如何設定-redis-的-database-connection" class="headerlink" title="在 Laravel 的 QUEUE 當中, 如果我使用 redis 為 driver, 該如何設定 redis 的 database connection?"></a><strong>在 Laravel 的 QUEUE 當中, 如果我使用 <code>redis</code> 為 driver, 該如何設定 <code>redis</code> 的 database connection?</strong></h6><p>在 <code>config/database.php</code> 檔案中</p>
<p><br></p>
<h3 id="Redis-Cluster"><a href="#Redis-Cluster" class="headerlink" title="# Redis Cluster"></a># Redis Cluster</h3><h6 id="如果是使用-Redis-Cluster-queue-的名稱需要包含什麼？"><a href="#如果是使用-Redis-Cluster-queue-的名稱需要包含什麼？" class="headerlink" title="如果是使用 Redis Cluster, queue 的名稱需要包含什麼？"></a><strong>如果是使用 Redis Cluster, queue 的名稱需要包含什麼？</strong></h6><figure class="highlight plain hljs"><table><tr><td class="code"><pre><span class="line">&apos;redis&apos; =&gt; [</span><br><span class="line">    &apos;driver&apos; =&gt; &apos;redis&apos;,</span><br><span class="line">    &apos;connection&apos; =&gt; &apos;default&apos;,</span><br><span class="line">    &apos;queue&apos; =&gt; &apos;&#123;default&#125;&apos;,</span><br><span class="line">    &apos;retry_after&apos; =&gt; 90,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Blocking"><a href="#Blocking" class="headerlink" title="# Blocking"></a># Blocking</h3><h6 id="在-Laravel-Queue-當中-如果我使用-redis-且我想要讓-redis-在進去下一輪的-polling-之前等待數秒-看有沒有新的-job-進來-我可以怎麼做？"><a href="#在-Laravel-Queue-當中-如果我使用-redis-且我想要讓-redis-在進去下一輪的-polling-之前等待數秒-看有沒有新的-job-進來-我可以怎麼做？" class="headerlink" title="在 Laravel Queue 當中, 如果我使用 redis, 且我想要讓 redis 在進去下一輪的 polling 之前等待數秒, 看有沒有新的 job 進來, 我可以怎麼做？"></a><strong>在 Laravel Queue 當中, 如果我使用 redis, 且我想要讓 redis 在進去下一輪的 polling 之前等待數秒, 看有沒有新的 job 進來, 我可以怎麼做？</strong></h6><figure class="highlight plain hljs"><table><tr><td class="code"><pre><span class="line">&apos;redis&apos; =&gt; [</span><br><span class="line">    &apos;driver&apos; =&gt; &apos;redis&apos;,</span><br><span class="line">    &apos;connection&apos; =&gt; &apos;default&apos;,</span><br><span class="line">    &apos;queue&apos; =&gt; &apos;default&apos;,</span><br><span class="line">    &apos;retry_after&apos; =&gt; 90,</span><br><span class="line">    &apos;block_for&apos; =&gt; 5,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Creating-Jobs"><a href="#Creating-Jobs" class="headerlink" title="# Creating Jobs"></a># Creating Jobs</h2><h3 id="Generating-Job-Classes"><a href="#Generating-Job-Classes" class="headerlink" title="# Generating Job Classes"></a># Generating Job Classes</h3><h6 id="Laravel-中-一般-job-都會放在哪？"><a href="#Laravel-中-一般-job-都會放在哪？" class="headerlink" title="Laravel 中, 一般 job 都會放在哪？"></a><strong>Laravel 中, 一般 job 都會放在哪？</strong></h6><p><code>app/Jobs</code></p>
<h6 id="Laravel-中-如何建立一個-Job"><a href="#Laravel-中-如何建立一個-Job" class="headerlink" title="Laravel 中, 如何建立一個 Job?"></a><strong>Laravel 中, 如何建立一個 Job?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan make:job jobName</span><br></pre></td></tr></table></figure>
<h6 id="在-Laravel-中-當我們注入一個-Model-到-Job-是會整個-Model-都被注入-還是只會注入該-Model-的一個辨識物？"><a href="#在-Laravel-中-當我們注入一個-Model-到-Job-是會整個-Model-都被注入-還是只會注入該-Model-的一個辨識物？" class="headerlink" title="在 Laravel 中, 當我們注入一個 Model 到 Job, 是會整個 Model 都被注入, 還是只會注入該 Model 的一個辨識物？"></a><strong>在 Laravel 中, 當我們注入一個 Model 到 Job, 是會整個 Model 都被注入, 還是只會注入該 Model 的一個辨識物？</strong></h6><p>Only an identifier will be stored in the job</p>
<h6 id="在-Laravel-中-當我在-job-中注入一個-model-當這個-job-被在-queue-中被取出執行時-請入該-model-會是我當初注入時的狀態-還是目前資料庫中最新的狀態？"><a href="#在-Laravel-中-當我在-job-中注入一個-model-當這個-job-被在-queue-中被取出執行時-請入該-model-會是我當初注入時的狀態-還是目前資料庫中最新的狀態？" class="headerlink" title="在 Laravel 中, 當我在 job 中注入一個 model, 當這個 job 被在 queue 中被取出執行時, 請入該 model 會是我當初注入時的狀態, 還是目前資料庫中最新的狀態？"></a><strong>在 Laravel 中, 當我在 job 中注入一個 model, 當這個 job 被在 queue 中被取出執行時, 請入該 model 會是我當初注入時的狀態, 還是目前資料庫中最新的狀態？</strong></h6><p>資料庫中的狀態</p>
<h3 id="Handling-Relationships"><a href="#Handling-Relationships" class="headerlink" title="# Handling Relationships"></a># Handling Relationships</h3><h6 id="以下位於-job-的-Laravel-example-code-的意思是？"><a href="#以下位於-job-的-Laravel-example-code-的意思是？" class="headerlink" title="以下位於 job 的 Laravel example code 的意思是？"></a><strong>以下位於 job 的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(Podcast $podcast)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">$this</span>-&gt;podcast = $podcast-&gt;withoutRelations();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>當注入 model 到 job 時, 預設會載入 relations, 可指定不載入</p>
</li>
</ul>
<p><br><br><br></p>
<h2 id="Job-Middleware"><a href="#Job-Middleware" class="headerlink" title="# Job Middleware"></a># Job Middleware</h2><h6 id="在-Laravel-Queue-中-可以建立一個-Job-middleware-嗎？"><a href="#在-Laravel-Queue-中-可以建立一個-Job-middleware-嗎？" class="headerlink" title="在 Laravel Queue 中, 可以建立一個 Job middleware 嗎？"></a><strong>在 Laravel Queue 中, 可以建立一個 Job middleware 嗎？</strong></h6><p>可以</p>
<h6 id="在-Laravel-Queue-中-如果我想要建立一個-Job-Middleware-可以建立在什麼位置？"><a href="#在-Laravel-Queue-中-如果我想要建立一個-Job-Middleware-可以建立在什麼位置？" class="headerlink" title="在 Laravel Queue 中, 如果我想要建立一個 Job Middleware, 可以建立在什麼位置？"></a><strong>在 Laravel Queue 中, 如果我想要建立一個 Job Middleware, 可以建立在什麼位置？</strong></h6><p>什麼位置都可以, 官方範例位置為 <code>app/Jobs/Middleware</code></p>
<h6 id="在-Laravel-Queue-中-如果我要建立一個-Job-Middleware-如何建立？"><a href="#在-Laravel-Queue-中-如果我要建立一個-Job-Middleware-如何建立？" class="headerlink" title="在 Laravel Queue 中, 如果我要建立一個 Job Middleware, 如何建立？"></a><strong>在 Laravel Queue 中, 如果我要建立一個 Job Middleware, 如何建立？</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Redis</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateLimited</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Process the queued job.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  mixed  $job</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  callable  $next</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">($job, $next)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        Redis::throttle(<span class="hljs-string">'key'</span>)</span><br><span class="line">                -&gt;block(<span class="hljs-number">0</span>)-&gt;allow(<span class="hljs-number">1</span>)-&gt;every(<span class="hljs-number">5</span>)</span><br><span class="line">                -&gt;then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> <span class="hljs-title">use</span> <span class="hljs-params">($job, $next)</span> </span>&#123;</span><br><span class="line">                    <span class="hljs-comment">// Lock obtained...</span></span><br><span class="line"></span><br><span class="line">                    $next($job);</span><br><span class="line">                &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> <span class="hljs-title">use</span> <span class="hljs-params">($job)</span> </span>&#123;</span><br><span class="line">                    <span class="hljs-comment">// Could not obtain lock...</span></span><br><span class="line"></span><br><span class="line">                    $job-&gt;release(<span class="hljs-number">5</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="在-Laravel-Queue-中-如果我要在一個-Job-中使用建立好的-Job-Middleware-我可以怎麼做？"><a href="#在-Laravel-Queue-中-如果我要在一個-Job-中使用建立好的-Job-Middleware-我可以怎麼做？" class="headerlink" title="在 Laravel Queue 中, 如果我要在一個 Job 中使用建立好的 Job Middleware, 我可以怎麼做？"></a><strong>在 Laravel Queue 中, 如果我要在一個 Job 中使用建立好的 Job Middleware, 我可以怎麼做？</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">Middleware</span>\<span class="hljs-title">RateLimited</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Get the middleware the job should pass through.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> array</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">middleware</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">new</span> RateLimited];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br><br><br></p>
<h2 id="Dispatching-Jobs"><a href="#Dispatching-Jobs" class="headerlink" title="# Dispatching Jobs"></a># Dispatching Jobs</h2><h6 id="在-Laravel-Queue-中-該如何-dispatch-一個-job"><a href="#在-Laravel-Queue-中-該如何-dispatch-一個-job" class="headerlink" title="在 Laravel Queue 中, 該如何 dispatch 一個 job?"></a><strong>在 Laravel Queue 中, 該如何 dispatch 一個 job?</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Controller</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">ProcessPodcast</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PodcastController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Store a new podcast.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  Request  $request</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Response</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(Request $request)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Create podcast...</span></span><br><span class="line"></span><br><span class="line">        ProcessPodcast::dispatch($podcast);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Delayed-Dispatching"><a href="#Delayed-Dispatching" class="headerlink" title="# Delayed Dispatching"></a># Delayed Dispatching</h2><h6 id="以下的-Laravel-example-code-的意思是？-1"><a href="#以下的-Laravel-example-code-的意思是？-1" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Controller</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">ProcessPodcast</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PodcastController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(Request $request)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Create podcast...</span></span><br><span class="line"></span><br><span class="line">        ProcessPodcast::dispatch($podcast)</span><br><span class="line">                -&gt;delay(now()-&gt;addMinutes(<span class="hljs-number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>delay dispatch 該 job 的時間, 10 分鐘後在 dispatch</p>
</li>
</ul>
<h6 id="在-Laravel-Queue-中-AWS-的-SQS-最多支援到-delay-多久？"><a href="#在-Laravel-Queue-中-AWS-的-SQS-最多支援到-delay-多久？" class="headerlink" title="在 Laravel Queue 中, AWS 的 SQS 最多支援到 delay 多久？"></a><strong>在 Laravel Queue 中, AWS 的 SQS 最多支援到 delay 多久？</strong></h6><p>15 分鐘</p>
<p><br><br><br></p>
<h2 id="Synchronous-Dispatching"><a href="#Synchronous-Dispatching" class="headerlink" title="# Synchronous Dispatching"></a># Synchronous Dispatching</h2><h6 id="以下的-Laravel-example-code-的意思是？-2"><a href="#以下的-Laravel-example-code-的意思是？-2" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Controller</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">ProcessPodcast</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PodcastController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(Request $request)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Create podcast...</span></span><br><span class="line"></span><br><span class="line">        ProcessPodcast::dispatchNow($podcast);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>立即 dispatch 這個 job, 不使用 queue</p>
</li>
</ul>
<h6 id="在-Laravel-Queue-中-如果我立即-dispatch-一個-job-不要-queue-那我可以怎麼做？"><a href="#在-Laravel-Queue-中-如果我立即-dispatch-一個-job-不要-queue-那我可以怎麼做？" class="headerlink" title="在 Laravel Queue 中, 如果我立即 dispatch 一個 job, 不要 queue, 那我可以怎麼做？"></a><strong>在 Laravel Queue 中, 如果我立即 dispatch 一個 job, 不要 queue, 那我可以怎麼做？</strong></h6><p><br><br><br></p>
<h2 id="Job-Chaining"><a href="#Job-Chaining" class="headerlink" title="# Job Chaining"></a># Job Chaining</h2><h6 id="在-Laravel-Job-chaining-中-如果其中一個-job-失敗了-後面的還會繼續執行嗎？"><a href="#在-Laravel-Job-chaining-中-如果其中一個-job-失敗了-後面的還會繼續執行嗎？" class="headerlink" title="在 Laravel Job chaining 中, 如果其中一個 job 失敗了, 後面的還會繼續執行嗎？"></a><strong>在 Laravel Job chaining 中, 如果其中一個 job 失敗了, 後面的還會繼續執行嗎？</strong></h6><p>不會</p>
<h6 id="在-Laravel-Job-chaining-中-如果我使用-this-gt-delete-會終止後面的-job-執行嗎？"><a href="#在-Laravel-Job-chaining-中-如果我使用-this-gt-delete-會終止後面的-job-執行嗎？" class="headerlink" title="在 Laravel Job chaining 中, 如果我使用 $this-&gt;delete(), 會終止後面的 job 執行嗎？"></a><strong>在 Laravel Job chaining 中, 如果我使用 <code>$this-&gt;delete()</code>, 會終止後面的 job 執行嗎？</strong></h6><p>不會</p>
<h6 id="在-Laravel-如何實作一個-job-chaining"><a href="#在-Laravel-如何實作一個-job-chaining" class="headerlink" title="在 Laravel, 如何實作一個 job chaining?"></a><strong>在 Laravel, 如何實作一個 job chaining?</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">ProcessPodcast::withChain([</span><br><span class="line">    <span class="hljs-keyword">new</span> OptimizePodcast,</span><br><span class="line">    <span class="hljs-keyword">new</span> ReleasePodcast</span><br><span class="line">])-&gt;dispatch();</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Chain-Connection-amp-Queue"><a href="#Chain-Connection-amp-Queue" class="headerlink" title="# Chain Connection &amp; Queue"></a># Chain Connection &amp; Queue</h3><h6 id="在-Laravel-當我使用-job-chaining-時-如何指定這個-job-chaining-使用的-connection-以及-queue"><a href="#在-Laravel-當我使用-job-chaining-時-如何指定這個-job-chaining-使用的-connection-以及-queue" class="headerlink" title="在 Laravel, 當我使用 job chaining 時, 如何指定這個 job chaining 使用的 connection 以及 queue?"></a><strong>在 Laravel, 當我使用 job chaining 時, 如何指定這個 job chaining 使用的 connection 以及 queue?</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">ProcessPodcast::withChain([</span><br><span class="line">    <span class="hljs-keyword">new</span> OptimizePodcast,</span><br><span class="line">    <span class="hljs-keyword">new</span> ReleasePodcast</span><br><span class="line">])-&gt;dispatch()-&gt;allOnConnection(<span class="hljs-string">'redis'</span>)-&gt;allOnQueue(<span class="hljs-string">'podcasts'</span>);</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Customizing-The-Queue-amp-Connection"><a href="#Customizing-The-Queue-amp-Connection" class="headerlink" title="# Customizing The Queue &amp; Connection"></a># Customizing The Queue &amp; Connection</h2><h3 id="Dispatching-To-A-Particular-Queue"><a href="#Dispatching-To-A-Particular-Queue" class="headerlink" title="# Dispatching To A Particular Queue"></a># Dispatching To A Particular Queue</h3><h6 id="在-Laravel-job-當中-如何指定特定的-queue"><a href="#在-Laravel-job-當中-如何指定特定的-queue" class="headerlink" title="在 Laravel job 當中, 如何指定特定的 queue?"></a><strong>在 Laravel job 當中, 如何指定特定的 queue?</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Controller</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">ProcessPodcast</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PodcastController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Store a new podcast.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  Request  $request</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Response</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(Request $request)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Create podcast...</span></span><br><span class="line"></span><br><span class="line">        ProcessPodcast::dispatch($podcast)-&gt;onQueue(<span class="hljs-string">'processing'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Dispatching-To-A-Particular-Connection"><a href="#Dispatching-To-A-Particular-Connection" class="headerlink" title="# Dispatching To A Particular Connection"></a># Dispatching To A Particular Connection</h3><h6 id="在-Laravel-job-當中-如果我使用不只一個-connection-如何指定特定的-connection"><a href="#在-Laravel-job-當中-如果我使用不只一個-connection-如何指定特定的-connection" class="headerlink" title="在 Laravel job 當中, 如果我使用不只一個 connection, 如何指定特定的 connection?"></a><strong>在 Laravel job 當中, 如果我使用不只一個 connection, 如何指定特定的 connection?</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?Php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Controller</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">ProcessPodcast</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PodcastController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Store a new podcast.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  Request  $request</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Response</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(Request $request)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Create podcast...</span></span><br><span class="line"></span><br><span class="line">        ProcessPodcast::dispatch($podcast)-&gt;onConnection(<span class="hljs-string">'sqs'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Laravel-job-當中-如果我想要從該-job-的-class-中指定該-job-使用的-connection-我可以怎麼做？"><a href="#Laravel-job-當中-如果我想要從該-job-的-class-中指定該-job-使用的-connection-我可以怎麼做？" class="headerlink" title="Laravel job 當中, 如果我想要從該 job 的 class 中指定該 job 使用的 connection, 我可以怎麼做？"></a><strong>Laravel job 當中, 如果我想要從該 job 的 class 中指定該 job 使用的 connection, 我可以怎麼做？</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessPodcast</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * The queue connection that should handle the job.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@var</span> string</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> $connection = <span class="hljs-string">'sqs'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Laravel-job-當中-如果我想要同時指定該-job-特定的-connection-以及-queue-時-我可以怎麼做？"><a href="#Laravel-job-當中-如果我想要同時指定該-job-特定的-connection-以及-queue-時-我可以怎麼做？" class="headerlink" title="Laravel job 當中, 如果我想要同時指定該 job 特定的 connection 以及 queue 時, 我可以怎麼做？"></a><strong>Laravel job 當中, 如果我想要同時指定該 job 特定的 connection 以及 queue 時, 我可以怎麼做？</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">ProcessPodcast::dispatch($podcast)</span><br><span class="line">              -&gt;onConnection(<span class="hljs-string">'sqs'</span>)</span><br><span class="line">              -&gt;onQueue(<span class="hljs-string">'processing'</span>);</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Specifying-Max-Job-Attempts-Timeout-Values"><a href="#Specifying-Max-Job-Attempts-Timeout-Values" class="headerlink" title="# Specifying Max Job Attempts / Timeout Values"></a># Specifying Max Job Attempts / Timeout Values</h2><h3 id="Max-Attempts"><a href="#Max-Attempts" class="headerlink" title="# Max Attempts"></a># Max Attempts</h3><h6 id="以下的-Laravel-example-code-的意思是？-3"><a href="#以下的-Laravel-example-code-的意思是？-3" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --tries=3</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>指定 worker 的嘗試次數, 會嘗試執行 job 最多 3 次, 第一次也算一次, release() 也算一次, 如果 3 次都失敗, 才會把它放到 failed_job table 內</p>
</li>
</ul>
<h6 id="以下的-Laravel-example-code-的意思是？-4"><a href="#以下的-Laravel-example-code-的意思是？-4" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessPodcast</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> $tries = <span class="hljs-number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>指定該 job 的最大嘗試次數, 如果 5 次都執行失敗, release() 也算 1 次, 第一次也算, 那 worker 就會將這個 job 放到 failed_job table 中, 不再嘗試執行</p>
</li>
</ul>
<h6 id="Laravel-job-當中-當我同時在-job-class-中-以及-CLI-中都指令最大嘗試次數-Laravel-會以誰為準？"><a href="#Laravel-job-當中-當我同時在-job-class-中-以及-CLI-中都指令最大嘗試次數-Laravel-會以誰為準？" class="headerlink" title="Laravel job 當中, 當我同時在 job class 中, 以及 CLI 中都指令最大嘗試次數, Laravel 會以誰為準？"></a><strong>Laravel job 當中, 當我同時在 job class 中, 以及 CLI 中都指令最大嘗試次數, Laravel 會以誰為準？</strong></h6><p>job class 中指定的 property</p>
<p><br></p>
<h3 id="Time-Based-Attempts"><a href="#Time-Based-Attempts" class="headerlink" title="# Time Based Attempts"></a># Time Based Attempts</h3><h6 id="以下的-Laravel-example-code-的意思是？-5"><a href="#以下的-Laravel-example-code-的意思是？-5" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retryUntil</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> now()-&gt;addSeconds(<span class="hljs-number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>為這個 job 定義一個可被執行的時間限制, 超過 5 秒後, 這個 job 就會被放到 failed_table 中</p>
</li>
</ul>
<p><br></p>
<h3 id="Timeout"><a href="#Timeout" class="headerlink" title="# Timeout"></a># Timeout</h3><h6 id="Laravel-job-當中-如果我要指定任務可以執行的最大秒數-通過-CLI-我可以怎麼做？"><a href="#Laravel-job-當中-如果我要指定任務可以執行的最大秒數-通過-CLI-我可以怎麼做？" class="headerlink" title="Laravel job 當中, 如果我要指定任務可以執行的最大秒數, 通過 CLI, 我可以怎麼做？"></a><strong>Laravel job 當中, 如果我要指定任務可以執行的最大秒數, 通過 CLI, 我可以怎麼做？</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --timeout=30</span><br></pre></td></tr></table></figure>
<h6 id="以下的-Laravel-example-code-的意思是？-6"><a href="#以下的-Laravel-example-code-的意思是？-6" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessPodcast</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> $timeout = <span class="hljs-number">120</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>指定 timeout, 為該 job 可執行的最大秒數, 通過即視為失敗, 失敗超過 tries property 限制即視為 failed</p>
</li>
</ul>
<h6 id="Laravel-job-當中-如果我再-CLI-以及-job-的-class-同時定義的-timeout-哪一個的優先權比較大？"><a href="#Laravel-job-當中-如果我再-CLI-以及-job-的-class-同時定義的-timeout-哪一個的優先權比較大？" class="headerlink" title="Laravel job 當中, 如果我再 CLI 以及 job 的 class 同時定義的 timeout, 哪一個的優先權比較大？"></a><strong>Laravel job 當中, 如果我再 CLI 以及 job 的 class 同時定義的 timeout, 哪一個的優先權比較大？</strong></h6><p>job class</p>
<p><br><br><br></p>
<h2 id="Rate-Limiting"><a href="#Rate-Limiting" class="headerlink" title="# Rate Limiting"></a># Rate Limiting</h2><h6 id="Laravel-queue-當中-如果我想使用-rate-limiting-哪一個服務會是必要的？"><a href="#Laravel-queue-當中-如果我想使用-rate-limiting-哪一個服務會是必要的？" class="headerlink" title="Laravel queue 當中, 如果我想使用 rate limiting, 哪一個服務會是必要的？"></a><strong>Laravel queue 當中, 如果我想使用 rate limiting, 哪一個服務會是必要的？</strong></h6><p>redis</p>
<h6 id="下面的-Laravel-程式碼代表什麼意思？"><a href="#下面的-Laravel-程式碼代表什麼意思？" class="headerlink" title="下面的 Laravel 程式碼代表什麼意思？"></a><strong>下面的 Laravel 程式碼代表什麼意思？</strong></h6><p>每 60 秒最大可執行 10 次, 若失敗的話, 10 秒後 release job<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">Redis::throttle(<span class="hljs-string">'key'</span>)-&gt;allow(<span class="hljs-number">10</span>)-&gt;every(<span class="hljs-number">60</span>)-&gt;then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Job logic...</span></span><br><span class="line">&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Could not obtain lock...</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;release(<span class="hljs-number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h6 id="下面的-Laravel-程式碼中的-key-代表什麼意思？"><a href="#下面的-Laravel-程式碼中的-key-代表什麼意思？" class="headerlink" title="下面的 Laravel 程式碼中的 key, 代表什麼意思？"></a><strong>下面的 Laravel 程式碼中的 key, 代表什麼意思？</strong></h6><p>可以是任意 string, 官方範例中, 可以是 <code>job 的類型 + 該 Eloquent Model 的 id</code><br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">Redis::throttle(<span class="hljs-string">'key'</span>)-&gt;allow(<span class="hljs-number">10</span>)-&gt;every(<span class="hljs-number">60</span>)-&gt;then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Job logic...</span></span><br><span class="line">&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Could not obtain lock...</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;release(<span class="hljs-number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h6 id="下面的-Laravel-程式碼中-當我-release-該-job-這樣還會增加該-job-的-attempt-次數嗎？"><a href="#下面的-Laravel-程式碼中-當我-release-該-job-這樣還會增加該-job-的-attempt-次數嗎？" class="headerlink" title="下面的 Laravel 程式碼中, 當我 release 該 job, 這樣還會增加該 job 的 attempt 次數嗎？"></a><strong>下面的 Laravel 程式碼中, 當我 release 該 job, 這樣還會增加該 job 的 attempt 次數嗎？</strong></h6><p>會哦<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">Redis::throttle(<span class="hljs-string">'key'</span>)-&gt;allow(<span class="hljs-number">10</span>)-&gt;every(<span class="hljs-number">60</span>)-&gt;then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Job logic...</span></span><br><span class="line">&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Could not obtain lock...</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;release(<span class="hljs-number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h6 id="以下的-Laravel-example-code-的意思是？-7"><a href="#以下的-Laravel-example-code-的意思是？-7" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">Redis::funnel(<span class="hljs-string">'yourKey'</span>)-&gt;limit(<span class="hljs-number">1</span>)-&gt;then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Job logic...</span></span><br><span class="line">&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Could not obtain lock...</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;release(<span class="hljs-number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>使用 redis 記錄一個 key, 並給予這個 key 一個 job, 限制有著該 key 的 job 每次只能由一個 worker 執行</p>
</li>
</ul>
<p><br><br><br></p>
<h2 id="Queueing-Closures"><a href="#Queueing-Closures" class="headerlink" title="# Queueing Closures"></a># Queueing Closures</h2><h6 id="在-Laravel-中-什麼情況我們可能會需要-dispatch-一個-closure"><a href="#在-Laravel-中-什麼情況我們可能會需要-dispatch-一個-closure" class="headerlink" title="在 Laravel 中, 什麼情況我們可能會需要 dispatch 一個 closure?"></a><strong>在 Laravel 中, 什麼情況我們可能會需要 dispatch 一個 closure?</strong></h6><p>當我們想要執行一個簡單的任務, 且需要它被在請求之外的週期執行</p>
<h6 id="在-Laravel-中-如何-dispatch-一個-closure"><a href="#在-Laravel-中-如何-dispatch-一個-closure" class="headerlink" title="在 Laravel 中, 如何 dispatch 一個 closure?"></a><strong>在 Laravel 中, 如何 dispatch 一個 closure?</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">$podcast = App\Podcast::find(<span class="hljs-number">1</span>);</span><br><span class="line"></span><br><span class="line">dispatch(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> <span class="hljs-title">use</span> <span class="hljs-params">($podcast)</span> </span>&#123;</span><br><span class="line">    $podcast-&gt;publish();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Running-The-Queue-Worker"><a href="#Running-The-Queue-Worker" class="headerlink" title="# Running The Queue Worker"></a># Running The Queue Worker</h2><h6 id="在-Laravel-中-怎麼樣啟動-worker-來執行-queued-job"><a href="#在-Laravel-中-怎麼樣啟動-worker-來執行-queued-job" class="headerlink" title="在 Laravel 中, 怎麼樣啟動 worker 來執行 queued job?"></a><strong>在 Laravel 中, 怎麼樣啟動 worker 來執行 queued job?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work</span><br></pre></td></tr></table></figure>
<h6 id="在-Laravel-中-要維持-worker-持續運行-我們需要額外啟動什麼？"><a href="#在-Laravel-中-要維持-worker-持續運行-我們需要額外啟動什麼？" class="headerlink" title="在 Laravel 中, 要維持 worker 持續運行, 我們需要額外啟動什麼？"></a><strong>在 Laravel 中, 要維持 worker 持續運行, 我們需要額外啟動什麼？</strong></h6><p>程序管理器, 像是 <code>supervisor</code>, 或 <code>pm2</code></p>
<h6 id="在-Laravel-中-當我使用-php-artisan-queue-work-當我代碼有變更時-我需要重新啟動-queue-嗎？"><a href="#在-Laravel-中-當我使用-php-artisan-queue-work-當我代碼有變更時-我需要重新啟動-queue-嗎？" class="headerlink" title="在 Laravel 中, 當我使用 php artisan queue:work, 當我代碼有變更時, 我需要重新啟動 queue 嗎？"></a><strong>在 Laravel 中, 當我使用 <code>php artisan queue:work</code>, 當我代碼有變更時, 我需要重新啟動 queue 嗎？</strong></h6><p>需要</p>
<h6 id="在-Laravel-中-如果我運行-php-artisan-queue-listen-然後我變更了代碼-我需要再重新啟動-queue-嗎？"><a href="#在-Laravel-中-如果我運行-php-artisan-queue-listen-然後我變更了代碼-我需要再重新啟動-queue-嗎？" class="headerlink" title="在 Laravel 中, 如果我運行 php artisan queue:listen, 然後我變更了代碼, 我需要再重新啟動 queue 嗎？"></a><strong>在 Laravel 中, 如果我運行 <code>php artisan queue:listen</code>, 然後我變更了代碼, 我需要再重新啟動 queue 嗎？</strong></h6><p>不需要</p>
<h6 id="在-Laravel-中-如果我不想要每次變更代碼就重新啟動-queue-我可以使用哪一個-CLI"><a href="#在-Laravel-中-如果我不想要每次變更代碼就重新啟動-queue-我可以使用哪一個-CLI" class="headerlink" title="在 Laravel 中, 如果我不想要每次變更代碼就重新啟動 queue, 我可以使用哪一個 CLI?"></a><strong>在 Laravel 中, 如果我不想要每次變更代碼就重新啟動 queue, 我可以使用哪一個 CLI?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:listen</span><br></pre></td></tr></table></figure>
<h6 id="在-Laravel-中-php-artisan-queue-work-跟-php-artisan-queue-listen-何者較有效率？"><a href="#在-Laravel-中-php-artisan-queue-work-跟-php-artisan-queue-listen-何者較有效率？" class="headerlink" title="在 Laravel 中, php artisan queue:work 跟 php artisan queue:listen 何者較有效率？"></a><strong>在 Laravel 中, <code>php artisan queue:work</code> 跟 <code>php artisan queue:listen</code> 何者較有效率？</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Specifying-The-Connection-amp-Queue"><a href="#Specifying-The-Connection-amp-Queue" class="headerlink" title="# Specifying The Connection &amp; Queue"></a># Specifying The Connection &amp; Queue</h3><h6 id="在-Laravel-中-如何透過-CLI-指定-queue-connection"><a href="#在-Laravel-中-如何透過-CLI-指定-queue-connection" class="headerlink" title="在 Laravel 中, 如何透過 CLI 指定 queue connection?"></a><strong>在 Laravel 中, 如何透過 CLI 指定 queue connection?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work redis</span><br></pre></td></tr></table></figure>
<h6 id="在-Laravel-中-如何透過-CLI-給特定的-queue-指定特定-connection"><a href="#在-Laravel-中-如何透過-CLI-給特定的-queue-指定特定-connection" class="headerlink" title="在 Laravel 中, 如何透過 CLI 給特定的 queue 指定特定 connection?"></a><strong>在 Laravel 中, 如何透過 CLI 給特定的 queue 指定特定 connection?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work redis --queue=emails</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Processing-A-Single-Job"><a href="#Processing-A-Single-Job" class="headerlink" title="# Processing A Single Job"></a># Processing A Single Job</h3><h6 id="在-Laravel-中-如何透過-CLI-指定-worker-只執行-queued-job-一次"><a href="#在-Laravel-中-如何透過-CLI-指定-worker-只執行-queued-job-一次" class="headerlink" title="在 Laravel 中, 如何透過 CLI 指定 worker 只執行 queued job 一次"></a><strong>在 Laravel 中, 如何透過 CLI 指定 worker 只執行 queued job 一次</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --once</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Processing-All-Queued-Jobs-amp-Then-Exiting"><a href="#Processing-All-Queued-Jobs-amp-Then-Exiting" class="headerlink" title="# Processing All Queued Jobs &amp; Then Exiting"></a># Processing All Queued Jobs &amp; Then Exiting</h3><h6 id="以下的-Laravel-example-command-的意思是？"><a href="#以下的-Laravel-example-command-的意思是？" class="headerlink" title="以下的 Laravel example command 的意思是？"></a><strong>以下的 Laravel example command 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --stop-when-empty</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>該 worker 執行完所有的 queue job 之後就會關閉</p>
</li>
</ul>
<h6 id="以下的-Laravel-指令什麼時候可能會用到？"><a href="#以下的-Laravel-指令什麼時候可能會用到？" class="headerlink" title="以下的 Laravel 指令什麼時候可能會用到？"></a><strong>以下的 Laravel 指令什麼時候可能會用到？</strong></h6><p>當我們利用容器運行 worker, 而我們需要工作都完成後自動關閉 container 時<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --stop-when-empty</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Resource-Considerations"><a href="#Resource-Considerations" class="headerlink" title="# Resource Considerations"></a># Resource Considerations</h3><h6 id="在-Laravel-的-queue-中-因為會緩存在-RAM-中運行-所以如果我有執行到未釋放的資源-像是-image-之類的-那我是否要在-job-執行完成之後釋放掉這些資源？"><a href="#在-Laravel-的-queue-中-因為會緩存在-RAM-中運行-所以如果我有執行到未釋放的資源-像是-image-之類的-那我是否要在-job-執行完成之後釋放掉這些資源？" class="headerlink" title="在 Laravel 的 queue 中, 因為會緩存在 RAM 中運行, 所以如果我有執行到未釋放的資源, 像是 image 之類的, 那我是否要在 job 執行完成之後釋放掉這些資源？"></a><strong>在 Laravel 的 queue 中, 因為會緩存在 RAM 中運行, 所以如果我有執行到未釋放的資源, 像是 image 之類的, 那我是否要在 job 執行完成之後釋放掉這些資源？</strong></h6><p>要哦</p>
<p><br><br><br></p>
<h2 id="Queue-Priorities"><a href="#Queue-Priorities" class="headerlink" title="# Queue Priorities"></a># Queue Priorities</h2><h6 id="在-Laravel-的-queue-中-我要如何排列-queue-的優先順序？"><a href="#在-Laravel-的-queue-中-我要如何排列-queue-的優先順序？" class="headerlink" title="在 Laravel 的 queue 中, 我要如何排列 queue 的優先順序？"></a><strong>在 Laravel 的 queue 中, 我要如何排列 queue 的優先順序？</strong></h6><p>可以使用逗號做分隔排序<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --queue=high,low</span><br></pre></td></tr></table></figure></p>
<p><br><br><br></p>
<h2 id="Queue-Workers-amp-Deployment"><a href="#Queue-Workers-amp-Deployment" class="headerlink" title="# Queue Workers &amp; Deployment"></a># Queue Workers &amp; Deployment</h2><h3 id="Job-Expiration"><a href="#Job-Expiration" class="headerlink" title="# Job Expiration"></a># Job Expiration</h3><h6 id="在-Laravel-的-queue-監聽程序中-我要如何重啟-queue？"><a href="#在-Laravel-的-queue-監聽程序中-我要如何重啟-queue？" class="headerlink" title="在 Laravel 的 queue 監聽程序中, 我要如何重啟 queue？"></a><strong>在 Laravel 的 queue 監聽程序中, 我要如何重啟 queue？</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:restart</span><br></pre></td></tr></table></figure>
<h6 id="在-Laravel-的-queue-監聽-CLI-php-artisan-queue-restart-會不會讓我丟失執行到一半的工作？"><a href="#在-Laravel-的-queue-監聽-CLI-php-artisan-queue-restart-會不會讓我丟失執行到一半的工作？" class="headerlink" title="在 Laravel 的 queue 監聽 CLI php artisan queue:restart, 會不會讓我丟失執行到一半的工作？"></a><strong>在 Laravel 的 queue 監聽 CLI <code>php artisan queue:restart</code>, 會不會讓我丟失執行到一半的工作？</strong></h6><p>不會哦, 它會 gracefully restart, 完成目前手邊工作之後再重啟</p>
<h6 id="Laravel-中-在沒有使用-supervisor-的情況下-如果我執行-php-artisan-queue-restart-會發生什麼事？"><a href="#Laravel-中-在沒有使用-supervisor-的情況下-如果我執行-php-artisan-queue-restart-會發生什麼事？" class="headerlink" title="Laravel 中, 在沒有使用 supervisor 的情況下, 如果我執行 php artisan queue:restart, 會發生什麼事？"></a><strong>Laravel 中, 在沒有使用 supervisor 的情況下, 如果我執行 <code>php artisan queue:restart</code>, 會發生什麼事？</strong></h6><p>worker 會關閉</p>
<h6 id="Laravel-中-若要使用-php-artisan-queue-restart-務必先要確認什麼服務已經設置好？"><a href="#Laravel-中-若要使用-php-artisan-queue-restart-務必先要確認什麼服務已經設置好？" class="headerlink" title="Laravel 中, 若要使用 php artisan queue:restart, 務必先要確認什麼服務已經設置好？"></a><strong>Laravel 中, 若要使用 <code>php artisan queue:restart</code>, 務必先要確認什麼服務已經設置好？</strong></h6><p>cache</p>
<h6 id="Laravel-中-當我使用-php-artisan-queue-restart-queue-會將-restart-的-signal-存在什麼地方？"><a href="#Laravel-中-當我使用-php-artisan-queue-restart-queue-會將-restart-的-signal-存在什麼地方？" class="headerlink" title="Laravel 中, 當我使用 php artisan queue:restart, queue 會將 restart 的 signal 存在什麼地方？"></a><strong>Laravel 中, 當我使用 <code>php artisan queue:restart</code>, queue 會將 restart 的 signal 存在什麼地方？</strong></h6><p>cache</p>
<h6 id="Laravel-queue-中-如果我要指定一個-job-在執行之後多久時間之後才可以再被執行-如果沒被刪除的話-我可以怎麼做？"><a href="#Laravel-queue-中-如果我要指定一個-job-在執行之後多久時間之後才可以再被執行-如果沒被刪除的話-我可以怎麼做？" class="headerlink" title="Laravel queue 中, 如果我要指定一個 job 在執行之後多久時間之後才可以再被執行 (如果沒被刪除的話), 我可以怎麼做？"></a><strong>Laravel queue 中, 如果我要指定一個 job 在執行之後多久時間之後才可以再被執行 (如果沒被刪除的話), 我可以怎麼做？</strong></h6><p>在 <code>queue.php</code> 的 config 檔案中, 可以設定 <strong>retry_after</strong> 的參數</p>
<h6 id="Laravel-queue-中-哪一個服務無法在-queue-php-config-中設定-retry-after-參數"><a href="#Laravel-queue-中-哪一個服務無法在-queue-php-config-中設定-retry-after-參數" class="headerlink" title="Laravel queue 中, 哪一個服務無法在 queue.php config 中設定 retry_after 參數"></a><strong>Laravel queue 中, 哪一個服務無法在 queue.php config 中設定 <code>retry_after</code> 參數</strong></h6><p>Amazon SQS</p>
<p><br></p>
<h3 id="Worker-Timeouts"><a href="#Worker-Timeouts" class="headerlink" title="# Worker Timeouts"></a># Worker Timeouts</h3><h6 id="Laravel-queue-中-timeout-跟-retry-after-的差別在哪？"><a href="#Laravel-queue-中-timeout-跟-retry-after-的差別在哪？" class="headerlink" title="Laravel queue 中, --timeout 跟 retry_after 的差別在哪？"></a><strong>Laravel queue 中, <code>--timeout</code> 跟 <code>retry_after</code> 的差別在哪？</strong></h6><p><code>--timeout</code>: queue 的 master 程序需等待多久的時間才可以殺掉一個執行同樣一個 job 的子程序<br><code>retry_after</code>: queue 的 master 程序需要隔多久才可以重啟一個子程序來執行之前執行過的 job</p>
<h6 id="Laravel-queue-中-timeout-跟-retry-after-的時間-哪個長哪個短？"><a href="#Laravel-queue-中-timeout-跟-retry-after-的時間-哪個長哪個短？" class="headerlink" title="Laravel queue 中, --timeout 跟 retry_after 的時間, 哪個長哪個短？"></a><strong>Laravel queue 中, <code>--timeout</code> 跟 <code>retry_after</code> 的時間, 哪個長哪個短？</strong></h6><p><code>--retry_after</code> 需要比 <code>--timeout</code> 來得長</p>
<h6 id="Laravel-queue-中-如果-retry-after-比-timeout-設定的時間還短-可能會發生什麼事？"><a href="#Laravel-queue-中-如果-retry-after-比-timeout-設定的時間還短-可能會發生什麼事？" class="headerlink" title="Laravel queue 中, 如果 retry_after 比 --timeout 設定的時間還短, 可能會發生什麼事？"></a><strong>Laravel queue 中, 如果 <code>retry_after</code> 比 <code>--timeout</code> 設定的時間還短, 可能會發生什麼事？</strong></h6><p>同一個 job 會被執行兩次</p>
<p><br></p>
<h3 id="Worker-Sleep-Duration"><a href="#Worker-Sleep-Duration" class="headerlink" title="# Worker Sleep Duration"></a># Worker Sleep Duration</h3><h6 id="Laravel-queue-中-如果我要讓-worker-沒有新的-job-時會進入休眠狀態-那我可以怎麼做？"><a href="#Laravel-queue-中-如果我要讓-worker-沒有新的-job-時會進入休眠狀態-那我可以怎麼做？" class="headerlink" title="Laravel queue 中, 如果我要讓 worker 沒有新的 job 時會進入休眠狀態, 那我可以怎麼做？"></a><strong>Laravel queue 中, 如果我要讓 worker 沒有新的 job 時會進入休眠狀態, 那我可以怎麼做？</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work --sleep=3</span><br></pre></td></tr></table></figure>
<h6 id="Laravel-queue-中-如果我有使用-sleep-的-option-當-queue-裡頭有很多-job-還沒有執行完畢時-worker-會進入-sleep-狀態嗎？"><a href="#Laravel-queue-中-如果我有使用-sleep-的-option-當-queue-裡頭有很多-job-還沒有執行完畢時-worker-會進入-sleep-狀態嗎？" class="headerlink" title="Laravel queue 中, 如果我有使用 --sleep 的 option, 當 queue 裡頭有很多 job 還沒有執行完畢時, worker 會進入 sleep 狀態嗎？"></a><strong>Laravel queue 中, 如果我有使用 <code>--sleep</code> 的 option, 當 queue 裡頭有很多 job 還沒有執行完畢時, worker 會進入 sleep 狀態嗎？</strong></h6><p>不會, 會等到所有 job 都處理完畢, 沒有新的 job 了 worker 才會進入 sleep 狀態</p>
<h6 id="Laravel-queue-中-如果我有使用-sleep-的-option-當-worker-處於-sleep-的狀態時-如果有新的-job-進來-worker-會等到-sleep-結束再處理-還是會立即處理？"><a href="#Laravel-queue-中-如果我有使用-sleep-的-option-當-worker-處於-sleep-的狀態時-如果有新的-job-進來-worker-會等到-sleep-結束再處理-還是會立即處理？" class="headerlink" title="Laravel queue 中, 如果我有使用 --sleep 的 option, 當 worker 處於 sleep 的狀態時, 如果有新的 job 進來, worker 會等到 sleep 結束再處理, 還是會立即處理？"></a><strong>Laravel queue 中, 如果我有使用 <code>--sleep</code> 的 option, 當 worker 處於 sleep 的狀態時, 如果有新的 job 進來, worker 會等到 sleep 結束再處理, 還是會立即處理？</strong></h6><p>待 sleep 結束才會處理</p>
<p><br><br><br></p>
<h2 id="Supervisor-Configuration"><a href="#Supervisor-Configuration" class="headerlink" title="# Supervisor Configuration"></a># Supervisor Configuration</h2><h3 id="Installing-Supervisor"><a href="#Installing-Supervisor" class="headerlink" title="# Installing Supervisor"></a># Installing Supervisor</h3><h6 id="如何安裝-supervisor"><a href="#如何安裝-supervisor" class="headerlink" title="如何安裝 supervisor ?"></a><strong>如何安裝 supervisor ?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-get install supervisor</span><br></pre></td></tr></table></figure>
<h6 id="Supervisor-的設定檔位置在哪？"><a href="#Supervisor-的設定檔位置在哪？" class="headerlink" title="Supervisor 的設定檔位置在哪？"></a><strong>Supervisor 的設定檔位置在哪？</strong></h6><p><code>/etc/supervisor/conf.d</code></p>
<h6 id="我該如何設定-Supervisor-設定檔？"><a href="#我該如何設定-Supervisor-設定檔？" class="headerlink" title="我該如何設定 Supervisor 設定檔？"></a><strong>我該如何設定 Supervisor 設定檔？</strong></h6><figure class="highlight plain hljs"><table><tr><td class="code"><pre><span class="line">[program:laravel-worker]</span><br><span class="line">process_name=%(program_name)s_%(process_num)02d</span><br><span class="line">command=php /home/forge/app.com/artisan queue:work sqs --sleep=3 --tries=3</span><br><span class="line">// 是否隨 supervisor 啟動一起啟動</span><br><span class="line">autostart=true</span><br><span class="line">// 程序異常退出後自動重啟</span><br><span class="line">autorestart=true</span><br><span class="line">user=forge</span><br><span class="line">numprocs=8</span><br><span class="line">// 是否教錯誤的 log 一併記錄到 stdout</span><br><span class="line">redirect_stderr=true</span><br><span class="line">// 一般輸出的記錄檔案位址</span><br><span class="line">stdout_logfile=/home/forge/app.com/worker.log</span><br><span class="line">// 刪除一個 job 的等待時間, 這邊需設定大於會執行最久的 job 的時間, 不然會在執行完畢前被砍掉</span><br><span class="line">stopwaitsecs=3600</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Starting-Supervisor"><a href="#Starting-Supervisor" class="headerlink" title="# Starting Supervisor"></a># Starting Supervisor</h3><h6 id="Supervisor-如何重新讀取-config-檔-但不重啟-process"><a href="#Supervisor-如何重新讀取-config-檔-但不重啟-process" class="headerlink" title="Supervisor 如何重新讀取 config 檔, 但不重啟 process?"></a><strong>Supervisor 如何重新讀取 config 檔, 但不重啟 process?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo supervisorctl reread</span><br></pre></td></tr></table></figure>
<h6 id="Supervisor-如何重新讀取-config-檔-並依照-config-檔案重啟-process"><a href="#Supervisor-如何重新讀取-config-檔-並依照-config-檔案重啟-process" class="headerlink" title="Supervisor 如何重新讀取 config 檔, 並依照 config 檔案重啟 process?"></a><strong>Supervisor 如何重新讀取 config 檔, 並依照 config 檔案重啟 process?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo supervisorctl update</span><br></pre></td></tr></table></figure>
<h6 id="Supervisor-如何啟動"><a href="#Supervisor-如何啟動" class="headerlink" title="Supervisor 如何啟動?"></a><strong>Supervisor 如何啟動?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo supervisorctl start laravel-worker:*</span><br></pre></td></tr></table></figure>
<h6 id="Supervisor-官方文件位址"><a href="#Supervisor-官方文件位址" class="headerlink" title="Supervisor 官方文件位址?"></a><strong>Supervisor 官方文件位址?</strong></h6><p><a href="http://supervisord.org/running.html#running-supervisord" target="_blank" rel="noopener">Supervisor 官方文件</a></p>
<p><br><br><br></p>
<h2 id="Dealing-With-Failed-Jobs"><a href="#Dealing-With-Failed-Jobs" class="headerlink" title="# Dealing With Failed Jobs"></a># Dealing With Failed Jobs</h2><h6 id="Laravel-queue-中-當一個-job-一直執行失敗-超出了指定的-tries-的限制-那這個-job-會跑到哪裡去？"><a href="#Laravel-queue-中-當一個-job-一直執行失敗-超出了指定的-tries-的限制-那這個-job-會跑到哪裡去？" class="headerlink" title="Laravel queue 中, 當一個 job 一直執行失敗, 超出了指定的 tries 的限制, 那這個 job 會跑到哪裡去？"></a><strong>Laravel queue 中, 當一個 job 一直執行失敗, 超出了指定的 tries 的限制, 那這個 job 會跑到哪裡去？</strong></h6><p>failed_jobs</p>
<h6 id="Laravel-queue-中-如何建立-failed-jobs-table"><a href="#Laravel-queue-中-如何建立-failed-jobs-table" class="headerlink" title="Laravel queue 中, 如何建立 failed_jobs table?"></a><strong>Laravel queue 中, 如何建立 failed_jobs table?</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:failed-table</span><br><span class="line">php artisan migrate</span><br></pre></td></tr></table></figure>
<h6 id="以下的-Laravel-example-code-的意思是？-8"><a href="#以下的-Laravel-example-code-的意思是？-8" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:work redis --tries=3 --delay=3</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>如果失敗, 最多嘗試 3 次, 超過 3 次的會被歸類到 fail job 中, 每次嘗試的間隔最少 3 秒</p>
</li>
</ul>
<h6 id="以下位於-job-的-Laravel-example-code-的意思是？-1"><a href="#以下位於-job-的-Laravel-example-code-的意思是？-1" class="headerlink" title="以下位於 job 的 Laravel example code 的意思是？"></a><strong>以下位於 job 的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-keyword">public</span> $retryAfter = <span class="hljs-number">3</span>;</span><br><span class="line"><span class="hljs-keyword">public</span> $backOff = <span class="hljs-number">3</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>定義該 job 如果執行失敗了, 或被 release 回 queue 中, 要間隔多久時間才會再被 worker pick up 執行。 有時失敗是因為第三方服務短時間內故障, 若不定義間隔時間, 很可能會在短時間內將 tries 的次數全部耗光, 如此便失去了給第三方服務時間恢復正常的空間<br>$backOff 為 Laravel 8 的用法</p>
</li>
</ul>
<p><br><br><br></p>
<h2 id="Cleaning-Up-After-Failed-Jobs"><a href="#Cleaning-Up-After-Failed-Jobs" class="headerlink" title="# Cleaning Up After Failed Jobs"></a># Cleaning Up After Failed Jobs</h2><h6 id="Laravel-中-當我一個-job-failed-我想要在它-fail-的時候發通知-我可以在哪一個地方寫這個邏輯？"><a href="#Laravel-中-當我一個-job-failed-我想要在它-fail-的時候發通知-我可以在哪一個地方寫這個邏輯？" class="headerlink" title="Laravel 中, 當我一個 job failed, 我想要在它 fail 的時候發通知, 我可以在哪一個地方寫這個邏輯？"></a><strong>Laravel 中, 當我一個 job failed, 我想要在它 fail 的時候發通知, 我可以在哪一個地方寫這個邏輯？</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">AudioProcessor</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Podcast</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Exception</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">SerializesModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessPodcast</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">use</span> <span class="hljs-title">InteractsWithQueue</span>, <span class="hljs-title">Queueable</span>, <span class="hljs-title">SerializesModels</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">protected</span> $podcast;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Create a new job instance.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  Podcast  $podcast</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(Podcast $podcast)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;podcast = $podcast;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Execute the job.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  AudioProcessor  $processor</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">(AudioProcessor $processor)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Process uploaded podcast...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * The job failed to process.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  Exception  $exception</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failed</span><span class="hljs-params">(Exception $exception)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Send user notification of failure, etc...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Failed-Job-Events"><a href="#Failed-Job-Events" class="headerlink" title="# Failed Job Events"></a># Failed Job Events</h2><h6 id="以下的-Laravel-example-code-的意思是？-9"><a href="#以下的-Laravel-example-code-的意思是？-9" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Queue</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">ServiceProvider</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">Events</span>\<span class="hljs-title">JobFailed</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppServiceProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceProvider</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boot</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        Queue::failing(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JobFailed $event)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// $event-&gt;connectionName</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;exception</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>在 AppServiceProvider 的 boot method 中, 使用 Queue class 的 failing method, 定義了當 job 失敗時, 就會觸發這個事件, 並執行 closure 內的邏輯</p>
</li>
</ul>
<p><br><br><br></p>
<h2 id="Retrying-Failed-Jobs"><a href="#Retrying-Failed-Jobs" class="headerlink" title="# Retrying Failed Jobs"></a># Retrying Failed Jobs</h2><h6 id="以下的-Laravel-example-code-的意思是？-10"><a href="#以下的-Laravel-example-code-的意思是？-10" class="headerlink" title="以下的 Laravel example code 的意思是？"></a><strong>以下的 Laravel example code 的意思是？</strong></h6><ul>
<li><p><strong>Example</strong>:</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:failed</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Answer</strong>:<br>從 failed_jobs table 中檢視所有的 failed jobs</p>
</li>
</ul>
<h6 id="Laravel-Queue-中-如果我要使用-CLI-獲取-failed-jobs-的-ID-我可以怎麼做？"><a href="#Laravel-Queue-中-如果我要使用-CLI-獲取-failed-jobs-的-ID-我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我要使用 CLI 獲取 failed jobs 的 ID, 我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我要使用 CLI 獲取 failed jobs 的 ID, 我可以怎麼做？</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:failed</span><br></pre></td></tr></table></figure>
<h6 id="Laravel-Queue-中-如果我要從-CLI-retry-特定的-failed-jobs-我可以怎麼做？"><a href="#Laravel-Queue-中-如果我要從-CLI-retry-特定的-failed-jobs-我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我要從 CLI retry 特定的 failed jobs, 我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我要從 CLI retry 特定的 failed jobs, 我可以怎麼做？</strong></h6><p>5 為 failed job ID<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:retry 5</span><br></pre></td></tr></table></figure></p>
<h6 id="Laravel-Queue-中-如果我要從-CLI-retry-所有的-failed-jobs-我可以怎麼做？"><a href="#Laravel-Queue-中-如果我要從-CLI-retry-所有的-failed-jobs-我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我要從 CLI retry 所有的 failed jobs, 我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我要從 CLI retry 所有的 failed jobs, 我可以怎麼做？</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:retry all</span><br></pre></td></tr></table></figure>
<h6 id="Laravel-Queue-中-如果我要從-CLI-刪除一個-failed-job-我可以怎麼做？"><a href="#Laravel-Queue-中-如果我要從-CLI-刪除一個-failed-job-我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我要從 CLI 刪除一個 failed job, 我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我要從 CLI 刪除一個 failed job, 我可以怎麼做？</strong></h6><p>5 為 failed job ID<br><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:forget 5</span><br></pre></td></tr></table></figure></p>
<h6 id="Laravel-Queue-中-如果我要從-CLI-刪除所有的-failed-jobs-我可以怎麼做？"><a href="#Laravel-Queue-中-如果我要從-CLI-刪除所有的-failed-jobs-我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我要從 CLI 刪除所有的 failed jobs, 我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我要從 CLI 刪除所有的 failed jobs, 我可以怎麼做？</strong></h6><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">php artisan queue:flush</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Ignoring-Missing-Models"><a href="#Ignoring-Missing-Models" class="headerlink" title="# Ignoring Missing Models"></a># Ignoring Missing Models</h2><h6 id="Laravel-Queue-中-我們注入一個-Eloquent-model-到一個-job-當中-而當執行該-job-時-該-model-已遭刪除-這時會發生什麼事？"><a href="#Laravel-Queue-中-我們注入一個-Eloquent-model-到一個-job-當中-而當執行該-job-時-該-model-已遭刪除-這時會發生什麼事？" class="headerlink" title="Laravel Queue 中, 我們注入一個 Eloquent model 到一個 job 當中, 而當執行該 job 時, 該 model 已遭刪除, 這時會發生什麼事？"></a><strong>Laravel Queue 中, 我們注入一個 Eloquent model 到一個 job 當中, 而當執行該 job 時, 該 model 已遭刪除, 這時會發生什麼事？</strong></h6><p>這個 job 會失敗, <code>ModelNotFoundException</code></p>
<h6 id="Laravel-Queue-中-我們注入一個-Eloquent-model-到一個-job-當中-而當執行該-job-時-該-model-已遭刪除-這時會報錯-ModelNotFoundException-如何設定當遇到這種情況時-自動刪除-job？"><a href="#Laravel-Queue-中-我們注入一個-Eloquent-model-到一個-job-當中-而當執行該-job-時-該-model-已遭刪除-這時會報錯-ModelNotFoundException-如何設定當遇到這種情況時-自動刪除-job？" class="headerlink" title="Laravel Queue 中, 我們注入一個 Eloquent model 到一個 job 當中, 而當執行該 job 時, 該 model 已遭刪除, 這時會報錯, ModelNotFoundException, 如何設定當遇到這種情況時, 自動刪除 job？"></a><strong>Laravel Queue 中, 我們注入一個 Eloquent model 到一個 job 當中, 而當執行該 job 時, 該 model 已遭刪除, 這時會報錯, <code>ModelNotFoundException</code>, 如何設定當遇到這種情況時, 自動刪除 job？</strong></h6><p>在 job class 當中<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Delete the job if its models no longer exist.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@var</span> bool</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> $deleteWhenMissingModels = <span class="hljs-keyword">true</span>;</span><br></pre></td></tr></table></figure></p>
<p><br><br><br></p>
<h2 id="Job-Events"><a href="#Job-Events" class="headerlink" title="# Job Events"></a># Job Events</h2><h6 id="Laravel-Queue-中-如果我想要在-job-事件執行前做一些事-那麼我可以怎麼做？"><a href="#Laravel-Queue-中-如果我想要在-job-事件執行前做一些事-那麼我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我想要在 job 事件執行前做一些事, 那麼我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我想要在 job 事件執行前做一些事, 那麼我可以怎麼做？</strong></h6><p>在 <code>AppServiceProvider</code> 中<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Queue</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">ServiceProvider</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">Events</span>\<span class="hljs-title">JobProcessed</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">Events</span>\<span class="hljs-title">JobProcessing</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppServiceProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceProvider</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Register any application services.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Bootstrap any application services.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boot</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        Queue::before(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JobProcessing $event)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// $event-&gt;connectionName</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job-&gt;payload()</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Queue::after(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JobProcessed $event)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// $event-&gt;connectionName</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job-&gt;payload()</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h6 id="Laravel-Queue-中-如果我想要在-job-事件執行後做一些事-那麼我可以怎麼做？"><a href="#Laravel-Queue-中-如果我想要在-job-事件執行後做一些事-那麼我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我想要在 job 事件執行後做一些事, 那麼我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我想要在 job 事件執行後做一些事, 那麼我可以怎麼做？</strong></h6><p>在 <code>AppServiceProvider</code> 中<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Queue</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">ServiceProvider</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">Events</span>\<span class="hljs-title">JobProcessed</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">Events</span>\<span class="hljs-title">JobProcessing</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppServiceProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceProvider</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Register any application services.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Bootstrap any application services.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boot</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        Queue::before(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JobProcessing $event)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// $event-&gt;connectionName</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job-&gt;payload()</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Queue::after(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JobProcessed $event)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// $event-&gt;connectionName</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job-&gt;payload()</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h6 id="Laravel-Queue-中-以下的程式碼通常可以應用在什麼情況？"><a href="#Laravel-Queue-中-以下的程式碼通常可以應用在什麼情況？" class="headerlink" title="Laravel Queue 中, 以下的程式碼通常可以應用在什麼情況？"></a><strong>Laravel Queue 中, 以下的程式碼通常可以應用在什麼情況？</strong></h6><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Queue</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">ServiceProvider</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">Events</span>\<span class="hljs-title">JobProcessed</span>;</span><br><span class="line"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">Events</span>\<span class="hljs-title">JobProcessing</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppServiceProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceProvider</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Register any application services.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Bootstrap any application services.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boot</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        Queue::before(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JobProcessing $event)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// $event-&gt;connectionName</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job-&gt;payload()</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Queue::after(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JobProcessed $event)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// $event-&gt;connectionName</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job</span></span><br><span class="line">            <span class="hljs-comment">// $event-&gt;job-&gt;payload()</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>記 log<br>統計特定 job 運行次數</p>
<h6 id="Laravel-Queue-中-如果我想要設定一個-closure-當我的-worker-要從-queue-fetch-新的-job-回來執行之前-執行這個-closure-那我可以怎麼做？"><a href="#Laravel-Queue-中-如果我想要設定一個-closure-當我的-worker-要從-queue-fetch-新的-job-回來執行之前-執行這個-closure-那我可以怎麼做？" class="headerlink" title="Laravel Queue 中, 如果我想要設定一個 closure, 當我的 worker 要從 queue fetch 新的 job 回來執行之前, 執行這個 closure, 那我可以怎麼做？"></a><strong>Laravel Queue 中, 如果我想要設定一個 closure, 當我的 worker 要從 queue fetch 新的 job 回來執行之前, 執行這個 closure, 那我可以怎麼做？</strong></h6><p>在 <code>AppServiceProvider</code> 當中<br><figure class="highlight php hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">Queue::looping(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">while</span> (DB::transactionLevel() &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        DB::rollBack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Laravel/">#Laravel</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Laravel-Documentation/">#Laravel Documentation</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Laravel-Queues/">#Laravel Queues</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/zh-tw/GKEMigratingToContainers/">GKE Migrating to Containers</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/zh-tw/introductionToDocker/">Docker 實戰入門</a>
            
        </span>
    </div>
    
</article>


<div class="sharebox">
    
<div class="sharethis-inline-share-buttons"></div>
<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c72643b9ea706001139fd89&amp;product=inline-share-buttons" async="async"></script>

</div>



<div class="comments">
    <h3 class="title is-4">留言</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'https://tn710617.github.io/zh-tw/laravelDiggingDeeperQueues/';
        this.page.identifier = 'zh-tw/laravelDiggingDeeperQueues/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'rayscodingjourney' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2021 Ray&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
                       <a class="navbar-item" title="GitHub" href="https://github.com/tn710617">
                           
                           <i class="fab fa-github"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="Medium" href="https://medium.com/@raycodingjourney">
                           
                           <i class="fab fa-medium"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="Linkedin" href="https://www.linkedin.com/in/ray-lee-99315315a">
                           
                           <i class="fab fa-linkedin"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="Facebook" href="https://www.facebook.com/profile.php?id=100001626039430">
                           
                           <i class="fab fa-facebook"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="CakeResume" href="https://www.cakeresume.com/resumes/ray-6edaef/edit">
                           
                           <i class="far fa-address-card"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="E-Mail" href="mailto:tn710617@gmail.com">
                           
                           <i class="far fa-envelope"></i>
                           
                       </a>
                          
                       <a class="navbar-item" title="Skype" href="skype:adad0310?call|chat">
                           
                           <i class="fab fa-skype"></i>
                           
                       </a>
                          
                       
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站內搜尋">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '頁面',
                CATEGORIES: '分類',
                TAGS: '標籤',
                UNTITLED: '(無標題)',
            },
            CONTENT_URL: '/content.zh-tw.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>