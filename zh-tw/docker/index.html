<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Docker 技術筆記 - Learn or Die</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="前言這是一份未整理過的 Docker 學習筆記">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 技術筆記">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/docker/index.html">
<meta property="og:site_name" content="Learn or Die">
<meta property="og:description" content="前言這是一份未整理過的 Docker 學習筆記">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/DmPAq2F.png">
<meta property="og:image" content="https://i.imgur.com/vutGwyU.png">
<meta property="og:image" content="https://i.imgur.com/3JMwS1e.png">
<meta property="og:image" content="https://i.imgur.com/FVqToOL.png">
<meta property="og:image" content="https://i.imgur.com/rvXklxG.png">
<meta property="og:image" content="https://i.imgur.com/I47eC9I.png">
<meta property="og:image" content="https://i.imgur.com/ofPsRZo.png">
<meta property="article:published_time" content="2019-04-08T02:04:43.000Z">
<meta property="article:modified_time" content="2020-02-07T12:08:01.488Z">
<meta property="article:author" content="Ray">
<meta property="article:tag" content="Docker Image">
<meta property="article:tag" content="Docker Container">
<meta property="article:tag" content="Docker Swarm">
<meta property="article:tag" content="Docker Multi Stage">
<meta property="article:tag" content="Docker Compose">
<meta property="article:tag" content="Docker Service">
<meta property="article:tag" content="Docker Rolling Update">
<meta property="article:tag" content="Docker Push">
<meta property="article:tag" content="Docker Deployment">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/DmPAq2F.png">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


    <link href="/docker/" rel="alternate"
          hreflang="en"/>








    <meta name="description" content="前言這是一份未整理過的 Docker 學習筆記">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 技術筆記">
<meta property="og:url" content="https://tn710617.github.io/zh-tw/docker/index.html">
<meta property="og:site_name" content="Learn or Die">
<meta property="og:description" content="前言這是一份未整理過的 Docker 學習筆記">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/DmPAq2F.png">
<meta property="og:image" content="https://i.imgur.com/vutGwyU.png">
<meta property="og:image" content="https://i.imgur.com/3JMwS1e.png">
<meta property="og:image" content="https://i.imgur.com/FVqToOL.png">
<meta property="og:image" content="https://i.imgur.com/rvXklxG.png">
<meta property="og:image" content="https://i.imgur.com/I47eC9I.png">
<meta property="og:image" content="https://i.imgur.com/ofPsRZo.png">
<meta property="article:published_time" content="2019-04-08T02:04:43.000Z">
<meta property="article:modified_time" content="2020-02-07T12:08:01.488Z">
<meta property="article:author" content="Ray">
<meta property="article:tag" content="Docker Image">
<meta property="article:tag" content="Docker Container">
<meta property="article:tag" content="Docker Swarm">
<meta property="article:tag" content="Docker Multi Stage">
<meta property="article:tag" content="Docker Compose">
<meta property="article:tag" content="Docker Service">
<meta property="article:tag" content="Docker Rolling Update">
<meta property="article:tag" content="Docker Push">
<meta property="article:tag" content="Docker Deployment">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/DmPAq2F.png">





    <link rel="icon" href="/images/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/sunburst.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
        
    
        
    
        
    
        
    
        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135063928-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-135063928-1');
</script>


    


<meta name="generator" content="Hexo 6.2.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/zh-tw">
                
                    
                    不學會死
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/zh-tw/archives">歸檔</a>
            
            <a class="navbar-item "
               href="/zh-tw/categories">分類</a>
            
            <a class="navbar-item "
               href="/zh-tw/tags">標籤</a>
            
            <a class="navbar-item "
               href="/zh-tw/schedule">行程</a>
            
            <a class="navbar-item "
               href="/zh-tw/about">關於</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜尋" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="目錄">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#前言">1&nbsp;&nbsp;<b>前言</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#環境">2&nbsp;&nbsp;<b>環境</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#安裝">3&nbsp;&nbsp;<b>安裝</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#移除舊版本">3.1&nbsp;&nbsp;移除舊版本</a>
                    
                    
                    
                    <a class="navbar-item" href="#安裝前設定">3.2&nbsp;&nbsp;安裝前設定</a>
                    
                    
                    
                    <a class="navbar-item" href="#更新-apt">3.2.1&nbsp;&nbsp;更新 apt</a>
                    
                    
                    
                    <a class="navbar-item" href="#使-apt-可以經由-HTTPS-使用倉庫">3.2.2&nbsp;&nbsp;使 apt 可以經由 HTTPS 使用倉庫</a>
                    
                    
                    
                    <a class="navbar-item" href="#增加-Docker-的正式-GPG-密鑰">3.2.3&nbsp;&nbsp;增加 Docker 的正式 GPG 密鑰</a>
                    
                    
                    
                    <a class="navbar-item" href="#設定-Docker-倉庫版本">3.2.4&nbsp;&nbsp;設定 Docker 倉庫版本</a>
                    
                    
                    
                    <a class="navbar-item" href="#安裝-Docker">3.3&nbsp;&nbsp;安裝 Docker</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#解除安裝">4&nbsp;&nbsp;<b>解除安裝</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker">5&nbsp;&nbsp;<b>docker</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-version">6&nbsp;&nbsp;<b>docker version</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Docker-info">7&nbsp;&nbsp;<b>Docker info</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-network">8&nbsp;&nbsp;<b>docker network</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#列出-network">8.1&nbsp;&nbsp;列出 network</a>
                    
                    
                    
                    <a class="navbar-item" href="#查看-network">8.2&nbsp;&nbsp;查看 network</a>
                    
                    
                    
                    <a class="navbar-item" href="#建立-network">8.3&nbsp;&nbsp;建立 network</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-volume">9&nbsp;&nbsp;<b>docker volume</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#列出-volume-清單">9.1&nbsp;&nbsp;列出 volume 清單</a>
                    
                    
                    
                    <a class="navbar-item" href="#列出特定-volume-訊息">9.2&nbsp;&nbsp;列出特定 volume 訊息</a>
                    
                    
                    
                    <a class="navbar-item" href="#刪除-volume">9.3&nbsp;&nbsp;刪除 volume</a>
                    
                    
                    
                    <a class="navbar-item" href="#清除所有未掛載的-volume">9.4&nbsp;&nbsp;清除所有未掛載的 volume</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-container-exec">10&nbsp;&nbsp;<b>docker container exec</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#以-root-登入容器">10.1&nbsp;&nbsp;以 root 登入容器</a>
                    
                    
                    
                    <a class="navbar-item" href="#連接還在運行中的-container">10.2&nbsp;&nbsp;連接還在運行中的 container</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-cp">11&nbsp;&nbsp;<b>docker cp</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#傳檔案進-container">11.1&nbsp;&nbsp;傳檔案進 container</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#確認-Docker-daemon-運行狀況">12&nbsp;&nbsp;<b>確認 Docker daemon 運行狀況</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Docker-container-run">13&nbsp;&nbsp;<b>Docker container run</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#運行-container">13.1&nbsp;&nbsp;運行 container</a>
                    
                    
                    
                    <a class="navbar-item" href="#架設一個私有倉庫">13.2&nbsp;&nbsp;架設一個私有倉庫</a>
                    
                    
                    
                    <a class="navbar-item" href="#我們也可以將上傳的映像檔備份一份到容器外">13.3&nbsp;&nbsp;我們也可以將上傳的映像檔備份一份到容器外</a>
                    
                    
                    
                    <a class="navbar-item" href="#備份容器的-volume">13.4&nbsp;&nbsp;備份容器的 volume</a>
                    
                    
                    
                    <a class="navbar-item" href="#掛載一個-volume">13.5&nbsp;&nbsp;掛載一個 volume</a>
                    
                    
                    
                    <a class="navbar-item" href="#連接到一個指定的容器">13.6&nbsp;&nbsp;連接到一個指定的容器</a>
                    
                    
                    
                    <a class="navbar-item" href="#指定一個-network">13.7&nbsp;&nbsp;指定一個 network</a>
                    
                    
                    
                    <a class="navbar-item" href="#與該-container-共享網路">13.8&nbsp;&nbsp;與該 container 共享網路</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-system">14&nbsp;&nbsp;<b>docker system</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#離開-container-但不關掉它">15&nbsp;&nbsp;<b>離開 container 但不關掉它</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-container-ls">16&nbsp;&nbsp;<b>docker container ls</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-container-stop">17&nbsp;&nbsp;<b>docker container stop</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-container-start">18&nbsp;&nbsp;<b>docker container start</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-rm">19&nbsp;&nbsp;<b>docker rm</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-commit">20&nbsp;&nbsp;<b>docker commit</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Multi-Stage-多階段構建">21&nbsp;&nbsp;<b>Multi Stage (多階段構建)</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Docker-image-pull">22&nbsp;&nbsp;<b>Docker image pull</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-image-ls">23&nbsp;&nbsp;<b>docker image ls</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-rmi">24&nbsp;&nbsp;<b>docker rmi</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-build">25&nbsp;&nbsp;<b>docker build</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-image-inspect">26&nbsp;&nbsp;<b>docker image inspect</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-save">27&nbsp;&nbsp;<b>docker save</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#docker-logs">28&nbsp;&nbsp;<b>docker logs</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Docker-push">28.1&nbsp;&nbsp;Docker push</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Docker-Compose">29&nbsp;&nbsp;<b>Docker-Compose</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#安裝-docker-compose">29.1&nbsp;&nbsp;安裝 docker-compose</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#建立一個-Swarm">30&nbsp;&nbsp;<b>建立一個 Swarm</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#開啟一個-SERVICE">31&nbsp;&nbsp;<b>開啟一個 SERVICE</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#滾動升級-rolling-update">32&nbsp;&nbsp;<b>滾動升級 rolling update</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Composer">33&nbsp;&nbsp;<b>Composer</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#利用-Docker-compose-部署-Laravel">34&nbsp;&nbsp;<b>利用 Docker-compose 部署 Laravel</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#安裝-docker-compose-1">34.1&nbsp;&nbsp;安裝 docker-compose</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#利用-Docker-來安裝環境">35&nbsp;&nbsp;<b>利用 Docker 來安裝環境</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#MySQL">35.1&nbsp;&nbsp;MySQL</a>
                    
                    
                    
                    <a class="navbar-item" href="#製作-Docker-image">35.2&nbsp;&nbsp;製作 Docker image</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#ENV">36&nbsp;&nbsp;<b>ENV</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#man-指令">37&nbsp;&nbsp;<b>man 指令</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Q-amp-A">38&nbsp;&nbsp;<b>Q &amp;amp;amp; A</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#使用-docker-compose-部署-Laravel-LEMP">39&nbsp;&nbsp;<b>使用 docker-compose 部署 Laravel-LEMP</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#下載專案並安裝依賴">39.1&nbsp;&nbsp;下載專案並安裝依賴</a>
                    
                    
                    
                    <a class="navbar-item" href="#建立-Docker-Compose-檔案">39.2&nbsp;&nbsp;建立 Docker Compose 檔案</a>
                    
                    
                    
                    <a class="navbar-item" href="#建立-Dockerfile">39.3&nbsp;&nbsp;建立 Dockerfile</a>
                    
                    
                    
                    <a class="navbar-item" href="#PHP-設定檔">39.4&nbsp;&nbsp;PHP 設定檔</a>
                    
                    
                    
                    <a class="navbar-item" href="#Nginx-設定檔">39.5&nbsp;&nbsp;Nginx 設定檔</a>
                    
                    
                    
                    <a class="navbar-item" href="#設定-MySQL">39.6&nbsp;&nbsp;設定 MySQL</a>
                    
                    
                    
                    <a class="navbar-item" href="#運行容器以及修改-env-設定">39.7&nbsp;&nbsp;運行容器以及修改 env 設定</a>
                    
                </div>
            </div>
            

            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true" aria-controls="dropdown-menu7">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>繁體中文</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            
                <a href="/docker/" class="dropdown-item">
                    English
                </a>
            
                <a href="/zh-tw/docker/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Docker 技術筆記
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-04-08T02:04:43.000Z" itemprop="datePublished">4月 8 2019</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/zh-tw/categories/Ops/">Ops</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 小时 讀完 (大概 7232 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>這是一份未整理過的 Docker 學習筆記</p>
<span id="more"></span>
<h2 id="環境"><a href="#環境" class="headerlink" title="環境"></a>環境</h2><p>GCP - ubuntu 18.04</p>
<h2 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h2><h3 id="移除舊版本"><a href="#移除舊版本" class="headerlink" title="移除舊版本"></a>移除舊版本</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>

<br>

<h3 id="安裝前設定"><a href="#安裝前設定" class="headerlink" title="安裝前設定"></a>安裝前設定</h3><h4 id="更新-apt"><a href="#更新-apt" class="headerlink" title="更新 apt"></a>更新 apt</h4><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<br>

<h4 id="使-apt-可以經由-HTTPS-使用倉庫"><a href="#使-apt-可以經由-HTTPS-使用倉庫" class="headerlink" title="使 apt 可以經由 HTTPS 使用倉庫"></a>使 apt 可以經由 HTTPS 使用倉庫</h4><ul>
<li>安裝以下套件，使 <code>apt</code> 可以經由 HTTPS 使用倉庫<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -y \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg-agent \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h4 id="增加-Docker-的正式-GPG-密鑰"><a href="#增加-Docker-的正式-GPG-密鑰" class="headerlink" title="增加 Docker 的正式 GPG 密鑰"></a>增加 Docker 的正式 GPG 密鑰</h4><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<ul>
<li><p>核對一下我們現在擁有含有 <code>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88</code> 指印的密鑰，我們可以搜尋最後八碼</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br></pre></td></tr></table></figure></li>
<li><p>理應得到輸出如下：</p>
<figure class="highlight plaintext hljs"><table><tr><td class="code"><pre><span class="line">pub   rsa4096 2017-02-22 [SCEA]</span><br><span class="line">      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class="line">uid           [ unknown] Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class="line">sub   rsa4096 2017-02-22 [S]</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h4 id="設定-Docker-倉庫版本"><a href="#設定-Docker-倉庫版本" class="headerlink" title="設定 Docker 倉庫版本"></a>設定 Docker 倉庫版本</h4><ul>
<li>將 <code>Docker 倉庫</code> 設定為 <code>stable</code> 版，若要設定為 <code>nightly</code> 或 <code>test</code> 版，可在以下的指令中自由取代 <code>stable</code><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository \</span><br><span class="line">   <span class="hljs-string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="hljs-string">   <span class="hljs-subst">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="hljs-string">   stable&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="安裝-Docker"><a href="#安裝-Docker" class="headerlink" title="安裝 Docker"></a>安裝 Docker</h3><ul>
<li><p>安裝最新的 <code>Docker CE</code> 版本</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io -y</span><br></pre></td></tr></table></figure></li>
<li><p>你也可以安裝特定版本的 <code>Docker</code>:</p>
</li>
</ul>
<ol>
<li><p>列出版本</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">apt-cache madison docker-ce</span><br></pre></td></tr></table></figure></li>
<li><p>應該會得到輸出如下：</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker-ce | 5:18.09.1~3-0~ubuntu-xenial | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">  docker-ce | 5:18.09.0~3-0~ubuntu-xenial | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">  docker-ce | 18.06.1~ce~3-0~ubuntu       | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">  docker-ce | 18.06.0~ce~3-0~ubuntu       | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></li>
<li><p>使用上面輸出的第二欄位版本號，結合下面的指令來安裝特定版本</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-get install docker-ce=&lt;VERSION_STRING&gt; docker-ce-cli=&lt;VERSION_STRING&gt; containerd.io</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>運行鏡像 <code>hello-world</code> 來驗證 <code>Docker CE</code> 是否已經正確安裝</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure></li>
<li><p>如果要使用非 <code>root</code> 身份運行 <code>Docker</code> 的話，可以把你的使用者加到 <code>Docker</code> 群組</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo usermod -aG docker your-user</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="解除安裝"><a href="#解除安裝" class="headerlink" title="解除安裝"></a>解除安裝</h2><ul>
<li><p>解除安裝 <code>Docker CE</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo apt-get purge docker-ce</span><br></pre></td></tr></table></figure></li>
<li><p>刪除所有的 <code>image</code>, <code>containers</code>, <code>volumes</code>, 可以使用以下指令。慎用！此指令適合解除安裝後使用。</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo <span class="hljs-built_in">rm</span> -rf /var/lib/docker/</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><ul>
<li>列出 <code>Docker</code> 的指令<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-version"><a href="#docker-version" class="headerlink" title="docker version"></a>docker version</h2><ul>
<li>查看 <code>Docker</code> 版本<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="Docker-info"><a href="#Docker-info" class="headerlink" title="Docker info"></a>Docker info</h2><ul>
<li>查看 <code>Docker</code> 完美安裝資訊<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-network"><a href="#docker-network" class="headerlink" title="docker network"></a>docker network</h2><h3 id="列出-network"><a href="#列出-network" class="headerlink" title="列出 network"></a>列出 network</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker network <span class="hljs-built_in">ls</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="查看-network"><a href="#查看-network" class="headerlink" title="查看 network"></a>查看 network</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker network inspect networkName</span><br></pre></td></tr></table></figure>

<br>

<h3 id="建立-network"><a href="#建立-network" class="headerlink" title="建立 network"></a>建立 network</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker network create -d driverType networkName</span><br></pre></td></tr></table></figure>

<h2 id="docker-volume"><a href="#docker-volume" class="headerlink" title="docker volume"></a>docker volume</h2><h3 id="列出-volume-清單"><a href="#列出-volume-清單" class="headerlink" title="列出 volume 清單"></a>列出 volume 清單</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker volume <span class="hljs-built_in">ls</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="列出特定-volume-訊息"><a href="#列出特定-volume-訊息" class="headerlink" title="列出特定 volume 訊息"></a>列出特定 volume 訊息</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker volume inspect volumeName</span><br></pre></td></tr></table></figure>

<br>

<h3 id="刪除-volume"><a href="#刪除-volume" class="headerlink" title="刪除 volume"></a>刪除 volume</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker volume <span class="hljs-built_in">rm</span> volumeName</span><br></pre></td></tr></table></figure>

<br>

<h3 id="清除所有未掛載的-volume"><a href="#清除所有未掛載的-volume" class="headerlink" title="清除所有未掛載的 volume"></a>清除所有未掛載的 volume</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="docker-container-exec"><a href="#docker-container-exec" class="headerlink" title="docker container exec"></a>docker container exec</h2><h3 id="以-root-登入容器"><a href="#以-root-登入容器" class="headerlink" title="以 root 登入容器"></a>以 root 登入容器</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker <span class="hljs-built_in">exec</span> -it --user root &lt;container <span class="hljs-built_in">id</span>&gt; /bin/bash</span><br></pre></td></tr></table></figure>

<br>

<h3 id="連接還在運行中的-container"><a href="#連接還在運行中的-container" class="headerlink" title="連接還在運行中的 container"></a>連接還在運行中的 <code>container</code></h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker container <span class="hljs-built_in">exec</span> -it yourContainerIDOrContainerName bash</span><br></pre></td></tr></table></figure>

<p><code>exec</code> 在運行中的 <code>container</code> 中運行一個新的程序</p>
<br>
<br>
<br>

<h2 id="docker-cp"><a href="#docker-cp" class="headerlink" title="docker cp"></a>docker cp</h2><h3 id="傳檔案進-container"><a href="#傳檔案進-container" class="headerlink" title="傳檔案進 container"></a>傳檔案進 container</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker <span class="hljs-built_in">cp</span> file containerName:/location</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="確認-Docker-daemon-運行狀況"><a href="#確認-Docker-daemon-運行狀況" class="headerlink" title="確認 Docker daemon 運行狀況"></a>確認 <code>Docker daemon</code> 運行狀況</h2><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">service docker status</span><br></pre></td></tr></table></figure>

<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">systemctl is-active docker</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Docker-container-run"><a href="#Docker-container-run" class="headerlink" title="Docker container run"></a>Docker container run</h2><h3 id="運行-container"><a href="#運行-container" class="headerlink" title="運行 container"></a>運行 <code>container</code></h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker container run -it ubuntu:latest /bin/bash</span><br></pre></td></tr></table></figure>

<ol>
<li><code>Docker container run</code> 告訴 <code>Docker daemon</code> 開始一個新的 <code>container</code></li>
<li><code>-i</code> 告訴 <code>Docker daeman</code> 讓 <code>container</code> 可以互動 </li>
<li><code>-t</code> 使目前的 terminal 視窗連接 <code>container</code> 的 <code>shell</code></li>
<li><code>ubuntu:latest</code> 為開始這個 <code>container</code> 的 <code>image</code></li>
<li><code>/bin/bash</code> 指定了我們想要運行 <code>container</code> 裡頭的哪一個程序</li>
</ol>
<br>

<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker container run -d \</span><br><span class="line">--name web1 \ </span><br><span class="line">-p 8080:8080 \</span><br><span class="line"><span class="hljs-built_in">test</span>:latest</span><br></pre></td></tr></table></figure>

<p><code>-d</code> 表示讓 <code>container</code> 運行在背景 ， 與 <code>-it</code> 相反，無法共存<br><code>--name</code> 指定 <code>container</code> 的名稱<br><code>-p</code> 指定 <code>port</code> ， 左邊的是外部可以從瀏覽器存取的 port ，右邊的是 container 向外暴露的 port</p>
<br>

<h3 id="架設一個私有倉庫"><a href="#架設一個私有倉庫" class="headerlink" title="架設一個私有倉庫"></a>架設一個私有倉庫</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run -d -p 5000:5000 registry</span><br></pre></td></tr></table></figure>

<br>

<h3 id="我們也可以將上傳的映像檔備份一份到容器外"><a href="#我們也可以將上傳的映像檔備份一份到容器外" class="headerlink" title="我們也可以將上傳的映像檔備份一份到容器外"></a>我們也可以將上傳的映像檔備份一份到容器外</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v outsideAddress:insideAddress registry</span><br></pre></td></tr></table></figure>

<h3 id="備份容器的-volume"><a href="#備份容器的-volume" class="headerlink" title="備份容器的 volume"></a>備份容器的 volume</h3><ul>
<li><p>比方說, 先建立一個容器叫做 dbstore, 並且內建一個匿名 volume, 掛在容器內的 /dbdata 位址</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run -v /dbdata --name dbstore ubuntu /bin/bash</span><br></pre></td></tr></table></figure></li>
<li><p>接下來, 備份的步驟如下：</p>
<ul>
<li>建立一個新容器, 並且掛載 dbstore 上的 volume, 下面指令中的 <code>--volumes-from</code> 達成這一項</li>
<li>將本機的一個資料夾掛到容器中的 /backup, 下面指令中的 <code>-v $(pwd):/backup</code> 達成這一項</li>
<li>接下來, 我們要把從 dbstore 掛載過來的, 容器內的 /dbdata 資料夾備份到容器外, 下面指令中的 <code>tar cvf /backup/backup.tar /dbdata</code> 達成這一項</li>
<li>當備份完成後, 該容器內沒有其他執行的任務, 所以該容器關閉, <code>--rm</code> 會讓關閉後的容器自行銷毀</li>
</ul>
</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run --<span class="hljs-built_in">rm</span> --volumes-from dbstore -v $(<span class="hljs-built_in">pwd</span>):/backup ubuntu tar cvf /backup/backup.tar /dbdata</span><br></pre></td></tr></table></figure>

<br>

<h3 id="掛載一個-volume"><a href="#掛載一個-volume" class="headerlink" title="掛載一個 volume"></a>掛載一個 volume</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run -d --name mysql2 -v mysql:/var/lib/mysql -p 3310:3306 -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="hljs-literal">true</span> mysql:5.7</span><br></pre></td></tr></table></figure>

<p><code>-v</code>: 外部建立一個 volume 叫做 <strong>mysql</strong>, 並且掛載到容器內部的 <strong>/var/lib/mysql</strong> 位置<br><code>-p</code>: 映射內外 port<br><code>-e</code>: 環境變數<br><code>-d</code>: 背景執行</p>
<br>

<h3 id="連接到一個指定的容器"><a href="#連接到一個指定的容器" class="headerlink" title="連接到一個指定的容器"></a>連接到一個指定的容器</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run --name test2 --<span class="hljs-built_in">link</span> test1 -d busybox /bin/sh -c <span class="hljs-string">&quot;while true; do echo hello; sleep 10; done&quot;</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="指定一個-network"><a href="#指定一個-network" class="headerlink" title="指定一個 network"></a>指定一個 network</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run --name test3 --network demo -d busybox /bin/bash</span><br></pre></td></tr></table></figure>
<p><code>--network</code>: 指定連接到 demo network</p>
<h3 id="與該-container-共享網路"><a href="#與該-container-共享網路" class="headerlink" title="與該 container 共享網路"></a>與該 container 共享網路</h3><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run --name test3 --network container:test2 -d busybox /bin/bash</span><br></pre></td></tr></table></figure>


<br>
<br>
<br>

<h2 id="docker-system"><a href="#docker-system" class="headerlink" title="docker system"></a>docker system</h2><p>查看 Docker 真實系統佔用空間</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker system <span class="hljs-built_in">df</span></span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="離開-container-但不關掉它"><a href="#離開-container-但不關掉它" class="headerlink" title="離開 container 但不關掉它"></a>離開 <code>container</code> 但不關掉它</h2><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">CTRL + PQ</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="docker-container-ls"><a href="#docker-container-ls" class="headerlink" title="docker container ls"></a>docker container ls</h2><ul>
<li><p>列出運行中的 <code>container</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker container <span class="hljs-built_in">ls</span></span><br></pre></td></tr></table></figure></li>
<li><p>列出所有的 <code>container</code> ， 包含已停止的</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker container <span class="hljs-built_in">ls</span> -a</span><br></pre></td></tr></table></figure></li>
</ul>
<p>or</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>


<br>
<br>
<br>

<h2 id="docker-container-stop"><a href="#docker-container-stop" class="headerlink" title="docker container stop"></a>docker container stop</h2><ul>
<li>停止 <code>container</code><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker container stop containerIdOrContainerName</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-container-start"><a href="#docker-container-start" class="headerlink" title="docker container start"></a>docker container start</h2><ul>
<li>重新開始停止中的 <code>container</code><figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker container start containerName</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-rm"><a href="#docker-rm" class="headerlink" title="docker rm"></a>docker rm</h2><ul>
<li><p>刪除 <code>container</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker <span class="hljs-built_in">rm</span> containerID</span><br></pre></td></tr></table></figure></li>
<li><p>刪除所有的 <code>container</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker <span class="hljs-built_in">rm</span> $(docker container <span class="hljs-built_in">ls</span> -aq) -f</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-commit"><a href="#docker-commit" class="headerlink" title="docker commit"></a>docker commit</h2><ul>
<li>將現有的 container 存成一個新的 image<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker commit -m <span class="hljs-string">&#x27;imageMessage&#x27;</span> -a <span class="hljs-string">&#x27;AuthorName&#x27;</span> containerSHA imageName:imageTag</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Multi-Stage-多階段構建"><a href="#Multi-Stage-多階段構建" class="headerlink" title="Multi Stage (多階段構建)"></a>Multi Stage (多階段構建)</h2><ul>
<li><code>Multi Stage Build</code> 範本<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-comment"># 給予該層一個名字, storefront</span></span><br><span class="line">FROM node:latest AS storefront</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 指定目前工作目錄</span></span><br><span class="line">WORKDIR /usr/src/atsea/app/react-app</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 複製 context 中的 react-app 到當前目錄, 即上一行指令的 react-app</span></span><br><span class="line">COPY react-app .</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 執行 npm install</span></span><br><span class="line">RUN npm install</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 執行 npm run build</span></span><br><span class="line">RUN npm run build</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 給予該層一個名字, 即 appserver</span></span><br><span class="line">FROM maven:latest AS appserver</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 指定目前的工作目錄, 即 /usr/src/atsea</span></span><br><span class="line">WORKDIR /usr/src/atsea</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 複製 context 中的 pom.xml 到當前位置, 即 atsea</span></span><br><span class="line">COPY pom.xml .</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 執行以下指令</span></span><br><span class="line">RUN mvn -B -f pom.xml -s /usr/share/maven/ref/settings-docker.xml dependency:resolve</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 複製 context 中的所有檔案到容器內的當前目錄下, 即 atsea</span></span><br><span class="line">COPY . .</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 執行以下指令</span></span><br><span class="line">RUN mvn -B -s /usr/share/maven/ref/settings-docker.xml package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 該是最終鏡像了, 沒給 alias</span></span><br><span class="line">FROM java:8-jdk-alpine</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 執行以下命令</span></span><br><span class="line">RUN adduser -Dh /home/gordon gordon</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 指令當前工作目錄</span></span><br><span class="line">WORKDIR /static</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 從上面建構 storefront 中, 複製 /usr/src/atsea/app/react-app/build/ 當中的所有資料到當前工作目錄, 即 /static</span></span><br><span class="line">COPY --from=storefront /usr/src/atsea/app/react-app/build/ .</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 指令當前工作目錄, 即 /app</span></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 從上面建構的 appserver 中, 複製 /usr/src/atsea/target/AtSea-0.0.1-SNAPSHOT.jar 到當前工作目錄, 即 appserver</span></span><br><span class="line">COPY --from=appserver /usr/src/atsea/target/AtSea-0.0.1-SNAPSHOT.jar .</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 指令 ENTRYPOINT, 該命令為容器啟動後默認一定會執行的命令, 無法被替換</span></span><br><span class="line">ENTRYPOINT [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;/app/AtSea-0.0.1-SNAPSHOT.jar&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># CMD 在這個位置的角色為上面的 ENTRYPOINT 的 flag, 若在容器啟動指令輸入其他命令, 該 CMD 將會被替換掉</span></span><br><span class="line">CMD [<span class="hljs-string">&quot;--spring.profiles.active=postgres&quot;</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>-t</code> 用來指定 <code>image</code> 的名字<br><code>-f</code> 可以用來指定名稱不是 <code>Dockfile</code> 的 <code>Dockerfile</code><br><code>From</code> 指定基礎 <code>image</code> 來源<br><code>RUN</code> 可以在 <code>image</code> 內執行 <code>command</code> 並建立新的 <code>layer</code> ，每一個 <code>RUN</code> 都會建立一層 <code>layer</code><br><code>COPY</code> 可以增加複製檔案到你的 <code>image</code> 內<br><code>EXPOSE</code> 暴露 APP 用的 <code>port</code><br><code>ENTRYPOINT</code> 設定當 <code>image</code> 被啟動為一個 <code>container</code> 時，預設執行的指令</p>
<br>
<br>
<br>

<h2 id="Docker-image-pull"><a href="#Docker-image-pull" class="headerlink" title="Docker image pull"></a>Docker image pull</h2><ul>
<li><p>拉下 <code>image</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker image pull ubuntu:latest</span><br></pre></td></tr></table></figure></li>
<li><p>根據 <code>digests</code> 拉下 <code>image</code> </p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker image pull imageNane@sha256:specificDigests</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-image-ls"><a href="#docker-image-ls" class="headerlink" title="docker image ls"></a>docker image ls</h2><ul>
<li><p>列出下載過的 <code>image</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker image <span class="hljs-built_in">ls</span></span><br></pre></td></tr></table></figure></li>
<li><p>列出下載過的 <code>image</code> 以及 <code>digest</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker image <span class="hljs-built_in">ls</span> --digests</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h2><ul>
<li><p>刪除 <code>image</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker rmi imageID</span><br></pre></td></tr></table></figure></li>
<li><p>刪除所有的 <code>image</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker image <span class="hljs-built_in">rm</span> $(docker image <span class="hljs-built_in">ls</span> -q) -f</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-build"><a href="#docker-build" class="headerlink" title="docker build"></a>docker build</h2><ul>
<li>建立 <code>image</code> <figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker image build -t imageName:tagName .</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-image-inspect"><a href="#docker-image-inspect" class="headerlink" title="docker image inspect"></a>docker image inspect</h2><ul>
<li>列出一個 <code>image</code> 的結構<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker image inspect inamgeID</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="docker-save"><a href="#docker-save" class="headerlink" title="docker save"></a>docker save</h2><ul>
<li>將 image 存成映像檔<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker save -o outputFileName imageName:imageTag</span><br></pre></td></tr></table></figure>
<code>-o</code> 代表 output</li>
</ul>
<br>
<br>
<br>

<h2 id="docker-logs"><a href="#docker-logs" class="headerlink" title="docker logs"></a>docker logs</h2><ul>
<li>查 log<figure class="highlight docker hljs"><table><tr><td class="code"><pre><span class="line">docker logs -f containerID</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h3 id="Docker-push"><a href="#Docker-push" class="headerlink" title="Docker push"></a>Docker push</h3><ol>
<li><p>首先， tag 本地的 image 一個可以用來推上 DockerHub 的名字</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker tag localImageName:localTagName userAccount/toBeTaggedImageName:toBeTaggedImageTagName</span><br></pre></td></tr></table></figure></li>
<li><p>推上 DockerHub</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker push userAccount/taggedImageName:taggedImageTag</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h2><h3 id="安裝-docker-compose"><a href="#安裝-docker-compose" class="headerlink" title="安裝 docker-compose"></a>安裝 docker-compose</h3><ul>
<li>安裝 <code>Docker Compose</code>, 儘管我們可以從官方的 <code>ubuntu 倉庫</code> 安裝 <code>Docker Compose</code> ，但因為最新的版本中有很多細小的版本差異，所以我們從 <code>Docker GitHub</code> 來安裝。 先到<a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases">官方頁面</a>確認版本，並且視需求更新下面指令的版本號。</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-`<span class="hljs-built_in">uname</span> -s`-`<span class="hljs-built_in">uname</span> -m` -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<ul>
<li><p>設定權限</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure></li>
<li><p>確認 <code>Docker-compose</code> 版本</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure></li>
<li><p>建立 <code>yaml</code> 檔案</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure></li>
<li><p>輸入內容如下：</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">my-test:</span><br><span class="line">image: hello-world</span><br></pre></td></tr></table></figure></li>
<li><p>建立一個 <code>container</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker-compose up</span><br></pre></td></tr></table></figure></li>
<li><p>輸出理應如下：<br><img src="https://i.imgur.com/DmPAq2F.png"></p>
</li>
</ul>
<br>
<br>
<br>

<h2 id="建立一個-Swarm"><a href="#建立一個-Swarm" class="headerlink" title="建立一個 Swarm"></a>建立一個 Swarm</h2><ul>
<li>開啟 <code>docker swarm</code> 模式<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm init \</span><br><span class="line">--advertise-addr 0.0.0.1:8080 \</span><br><span class="line">--listen-addr 0.0.0.1:8080</span><br></pre></td></tr></table></figure>
上面的 <code>IP</code> 跟 <code>PORT</code> 自己訂的<br><code>--advertise-addr</code>: 指定別的節點要連接這個 manager 時該使用的 <code>IP</code> 以及 <code>port</code>。這不是個必要的選項，但是你可以對哪個 <code>IP</code> 被使用有完全的控制權，並且你也可以訂一個不存在於節點上的 <code>IP</code> ，像是負載平衡的 <code>IP</code></li>
</ul>
<p><code>--listen-addr</code>: 讓你可以指定用來聽 <code>swarm</code> traffic 的 <code>IP</code> 以及 <code>port</code> ，通常他會跟 <code>--advertise-addr</code> 相同，但如果你想要限制 <code>swarm</code> 在特定的 <code>IP</code>，就特別有用。 還有一種情況，當 <code>advertise-addr</code> 是一個遠端的 <code>IP</code> ，像是平衡負載器，那這個也是必要的。</p>
<p>建議總是使用兩個附加選項。</p>
<ul>
<li><p>從一個 <code>node</code> 開始 <code>swarm mode</code> ，並且設為 leader</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm init \</span><br><span class="line">--advertise-addr yourInternalIP:yourPort \</span><br><span class="line">--listen-addr yourInternalIP:yourPort</span><br></pre></td></tr></table></figure></li>
<li><p>取得新增 <code>manager</code> 的 token </p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm join-token manager</span><br></pre></td></tr></table></figure>
<p>輸出大概如下：</p>
</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm <span class="hljs-built_in">join</span> \</span><br><span class="line">token SWMTKN-1-0uahebax...c87tu8dx2c \</span><br><span class="line">10.0.0.1:2377</span><br></pre></td></tr></table></figure>


<ul>
<li>取得新增 <code>worker</code> 的 token<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm join-token token</span><br></pre></td></tr></table></figure></li>
</ul>
<p>輸出大概如下：</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm <span class="hljs-built_in">join</span> \</span><br><span class="line">token SWMTKN-1-0uahebax...c87tu8dx2c \</span><br><span class="line">10.0.0.1:2377</span><br></pre></td></tr></table></figure>

<ul>
<li><p>重新產生 token</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm join-token --rotate managerOrWorker</span><br></pre></td></tr></table></figure></li>
<li><p>開啟並且登入一台新的 <code>instance</code> ， 輸入上面的 token 還有自己的 IP 位址</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm <span class="hljs-built_in">join</span> \</span><br><span class="line">token SWMTKN-1-0uahebax...c87tu8dx2c \</span><br><span class="line">10.0.0.1:2377 \</span><br><span class="line">advertise-addr yourInternalIP:yourPort \</span><br><span class="line">listen-addr yourInternalIP:yourPort</span><br></pre></td></tr></table></figure></li>
<li><p>不管你是想加入成為 <code>manager</code> 或是 <code>workder</code> ，只要輸入相對應的 token 就可以加入。</p>
</li>
<li><p>在 Leader 的 <code>node</code> 上可以查看 <code>swarm</code> 的詳細資料</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm node <span class="hljs-built_in">ls</span></span><br></pre></td></tr></table></figure></li>
<li><p>離開當前的 <code>swarm</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>


<h2 id="開啟一個-SERVICE"><a href="#開啟一個-SERVICE" class="headerlink" title="開啟一個 SERVICE"></a>開啟一個 SERVICE</h2><ul>
<li>要開立 <code>service</code> 首先必須確定， <code>swarm</code> 已建立。<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service create --name web-fe \</span><br><span class="line">-p 8080:8080 \</span><br><span class="line">--replicas 5 \</span><br><span class="line">nigelpoulton/pluralsight-docker-ci</span><br></pre></td></tr></table></figure>
<code>docker service create</code>: 建立一個 <code>service</code><br><code>--name</code>: 指定 <code>service</code> 的名稱<br><code>-p</code>: 指定 <code>container</code> 內以及連接外部的 <code>port</code><br><code>--replicas</code>: 在這個服務內，至少要有 5 個 <code>container</code><br><code>nigelpoulton/pluralsight-docker-ci</code>: <code>image</code> 以及 <code>tag</code></li>
</ul>
<p>開立 <code>service</code> 之後， <code>swarm</code> 會一直的監看真實的狀態是否跟我的理想的狀態一致，如果一致的話那很好，如果不， <code>swarm</code> 會採取相對應的動作。<br>舉例來說，如果五個 <code>container</code> 裡面有一個關閉了， <code>swarm</code> 會自動在啟動一個</p>
<p><img src="https://i.imgur.com/vutGwyU.png"></p>
<ul>
<li><p>查看 <code>service</code> 清單</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service <span class="hljs-built_in">ls</span></span><br></pre></td></tr></table></figure></li>
<li><p>查看 <code>service</code> 內的任務狀態</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service ps serviceName</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/3JMwS1e.png"></p>
</li>
<li><p>更詳盡的資訊</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service inspect --pretty serviceName</span><br></pre></td></tr></table></figure></li>
<li><p>擴展規模</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service scale web-fe=10</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/FVqToOL.png"></p>
</li>
</ul>
<p><img src="https://i.imgur.com/rvXklxG.png"></p>
<ul>
<li><p>刪除 <code>service</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service <span class="hljs-built_in">rm</span> web-fe</span><br></pre></td></tr></table></figure></li>
<li><p>建立一個 overlay <code>network</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker network create -d overlay uber-net</span><br></pre></td></tr></table></figure>
<p>連接到相同 overlay <code>network</code> 的 <code>container</code> ， 儘管他們的 <code>docker host</code> 連接的網路不同，彼此也可以互相溝通連接。</p>
</li>
<li><p>列出 <code>network</code> 資料</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker network <span class="hljs-built_in">ls</span></span><br></pre></td></tr></table></figure></li>
<li><p>刪除一個 <code>network</code></p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker network <span class="hljs-built_in">rm</span> networkName</span><br></pre></td></tr></table></figure></li>
<li><p>依據指定的 <code>network</code> 建立一個新的服務</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service create --name uber-svc \</span><br><span class="line">--network uber-net \</span><br><span class="line">-p 80:80 --replicas 12 \</span><br><span class="line">nigelpoulton/tu-demo:v1</span><br></pre></td></tr></table></figure>
<p><code>--network</code>: 指定 <code>network</code></p>
</li>
</ul>
<br>
<br>
<br>

<h2 id="滾動升級-rolling-update"><a href="#滾動升級-rolling-update" class="headerlink" title="滾動升級 rolling update"></a>滾動升級 rolling update</h2><ul>
<li><p>滾動升級運行中的服務</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service update \</span><br><span class="line">--image nigelpoulton/tu-demo:v2 \</span><br><span class="line">--update-parallelism 2 \</span><br><span class="line">--update-delay 20s uber-svc</span><br></pre></td></tr></table></figure>
<p><code>docker service update</code>: 升級 <code>service</code><br><code>--image</code>: 升級的 <code>image</code> 來源<br><code>--update-parallelism 2</code>: 一次升級兩個 <code>container</code><br><code>--update-delay 20s uber-svc</code>: 每批次的等待時間為 20 秒 ， 需等當前批次的升級完成，時間才會開始計算。 最後指定要升級的 <code>service</code> 名稱</p>
</li>
<li><p>查看上次升級的參數</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker service inspect --pretty serviceName</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/I47eC9I.png"></p>
</li>
</ul>
<p>如上圖，前一次升級的參數都會被保留下來，除非你再次升級去覆蓋它</p>
<br>
<br>
<br>

<h2 id="Composer"><a href="#Composer" class="headerlink" title="Composer"></a>Composer</h2><ul>
<li>利用 <code>container</code> 安裝 <code>Composer</code> <figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run --<span class="hljs-built_in">rm</span> -v $(<span class="hljs-built_in">pwd</span>):/app composer install</span><br></pre></td></tr></table></figure>
<code>--rm</code>: 當 <code>container</code> 關閉後，自動刪除<br><code>-v</code>: 使用 <code>volumes</code><br><code>$(pwd):/app</code>: <code>$(pwd)</code> 表示當前資料夾, <code>/app</code> 表示 <code>container</code> 裡頭一個叫做 <code>app</code> 的資料夾, 所以這個指令代表 <code>:</code> 前後的兩個資料夾會在 <code>container</code> 關閉之前，同步所有資料<br><code>composer install</code>: 安裝 <code>composer</code></li>
</ul>
<p>所以這個指令實際上做的事情，就是從 <code>Docker Hub</code> 拉下官方的 composer <code>image</code> ，然後開啟一個 <code>container</code> 並執行安裝， composer 會依照資料夾內 <code>composer.json</code> 或 <code>composer.lock</code> 來安裝相對應的 package 。 package 會被安裝在 app 這個資料夾內，但因為 <code>volumes</code> 的關係，所以兩個資料夾會同步， <code>$(pwd)</code> 內也會有安裝的 package 。 當安裝結束後， <code>container</code> 關閉，因為 <code>--rm</code> 的作用， <code>container</code> 會自動刪除。</p>
<br>
<br>
<br>

<h2 id="利用-Docker-compose-部署-Laravel"><a href="#利用-Docker-compose-部署-Laravel" class="headerlink" title="利用 Docker-compose 部署 Laravel"></a>利用 Docker-compose 部署 Laravel</h2><h3 id="安裝-docker-compose-1"><a href="#安裝-docker-compose-1" class="headerlink" title="安裝 docker-compose"></a>安裝 docker-compose</h3><ul>
<li>環境為 <code>Ubuntu 18.04</code> </li>
<li>安裝 <code>Docker Compose</code>, 儘管我們可以從官方的 <code>ubuntu 倉庫</code> 安裝 <code>Docker Compose</code> ，但因為最新的版本中有很多細小的版本差異，所以我們從 <code>Docker GitHub</code> 來安裝。 先到<a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases">官方頁面</a>確認版本，並且視需求更新下面指令的版本號。</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-`<span class="hljs-built_in">uname</span> -s`-`<span class="hljs-built_in">uname</span> -m` -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<ul>
<li>設定權限<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h2 id="利用-Docker-來安裝環境"><a href="#利用-Docker-來安裝環境" class="headerlink" title="利用 Docker 來安裝環境"></a>利用 Docker 來安裝環境</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><ul>
<li><p>安裝 MySQL ， 並指定連接一個外部不同的 port 號 ， 像是 52000</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run --name serviceName -e MYSQL_ROOT_PASSWORD=yourPassword -d -p 52000:3306 mysql:5.7</span><br></pre></td></tr></table></figure>
<p><code>docker run</code>: 啟動一個 container<br><code>--name</code>: 指定這個服務的名稱<br><code>-e MYSQL_ROOT_PASSWORD</code>: 指定環境參數<br><code>-d</code>: 使這個服務跑在 container 當中<br><code>-p</code>: 指定外跟內的 port 號， container 內部的 3306 連接外部的 52000<br><code>mysql:5.7</code>: 指定 image 以及 tag</p>
</li>
<li><p>連接本地安裝的 MySQL 以及 Docker container 內的 MySQL</p>
</li>
</ul>
<ol>
<li><p>本地安裝的</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo mysql -uroot</span><br></pre></td></tr></table></figure></li>
<li><p>Docker Container</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">mysql -h 127.0.0.1 -uroot -p2434 -P52000</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="製作-Docker-image"><a href="#製作-Docker-image" class="headerlink" title="製作 Docker image"></a>製作 Docker image</h3><ul>
<li>時區問題<br>我的第一個目標，是利用 Docker commit 來做一個專屬的 image。簡單來說，就是起一個純淨的 container ，然後在這個 container 裡頭部署完之後，再使用 docker commit 將這個 container 變成一個 image ， 結果發現在安裝 <code>php7.2-imagick</code> 中會出現 <code>Configuring tzdata</code> ，會彈出一個視窗並要求選擇時區，如下圖<br><img src="https://i.imgur.com/ofPsRZo.png"></li>
</ul>
<p>後來找到解決方法，是在安裝 <code>php7.2-imagick</code> 之前就把時區設定好，所以在一開始就加入 </p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">export</span> DEBIAN_FRONTEND=noninteractive &amp;&amp; apt-get install -y tzdata &amp;&amp; <span class="hljs-built_in">ln</span> -fs /usr/share/zoneinfo/Asia/Taipei /etc/localtime &amp;&amp; dpkg-reconfigure --frontend noninteractive tzdata</span><br></pre></td></tr></table></figure>

<ul>
<li><p>MySQL 問題<br>接下來，又遇到一個問題，在我利用我製作好的 image 開一個 container 時， MySQL 無法成功啟動，會一直出現 Failed<br>後來的解決方法非常的奇怪，我是到 /var/www/mysql/mysql 中，下 <code>chown -R mysql:mysql .</code> 的指令，然後它就好了…<br>可問題是，我仔細地確認過，在我下這指令之前，這個資料夾下的所有 user 以及 group 早就已經是 mysql:mysql 了</p>
</li>
<li><p>Apache 以及 MySQL 無法設定自動重啟的問題 所以我們必須要在 container 裏頭啟動這些服務，需要啟動的服務如下：</p>
<ul>
<li>Apache</li>
<li>MySQL</li>
</ul>
</li>
</ul>
<p>所以從目前的進度看來， container 啟動之後，我們必須要執行三個指令，如下：</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">chown</span> -R mysql:mysql /var/www/mysql/mysql</span><br><span class="line">service apache restart</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<p>沒想到實際執行之後，我們遇到了一個新的問題…</p>
<ul>
<li><p>Container 自動退出的問題<br>Container 的特性，是只要 command 執行完畢後，就會自動退出。 container 一旦退出了，我們原本建構的環境當然也就不在了。<br>我們怎麼可以容許這種事情發生呢？<br>因此，我們需要給 container 一個會一直持續存在的指令，好比是 /bin/bash</p>
</li>
<li><p>該怎麼樣讓 container 在啟動的時候又執行多個指令呢？<br>在 container 啟動時， 我們需要執行多個指令來啟動 container 裡面的服務，但是 entrypoint 只能帶一個指令進去，所以我們要寫一個 shell script ，然後當 container 開啟之後去執行這個 shell script ，當然，這個 shell script 裡頭的指令就是上述提到的指令，如下：</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">chown</span> -R mysql:mysql /var/www/mysql/mysql</span><br><span class="line">service apache2 restart</span><br><span class="line">service mysql restart</span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure></li>
</ul>
<p>假設這個 shell script 叫做 test.sh ，然後放在 /usr/sbin/ 之下，那我們的 docker 指令如下：</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run -dt --entrypoint <span class="hljs-string">&quot;/usr/sbin/test.sh&quot;</span> -p 8880:80 --name containerName yourAccount/imageName:tagName</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h2><br>
<br>
<br>

<h2 id="man-指令"><a href="#man-指令" class="headerlink" title="man 指令"></a>man 指令</h2><p>Docker 為了縮小 image 大小，預設不產生 man 說明文件。 在安裝 man 以及 man-pages 之前，需要先將此設定改掉</p>
<ul>
<li>修改設定<br>Docker 為了縮小 image 大小，預設不產生 man 說明文件。 在安裝 man 以及 man-pages 之前，需要先將此設定改掉<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">vi /etc/yum.conf</span><br></pre></td></tr></table></figure></li>
</ul>
<p>將以下這行 comment 掉</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">tsflags=nodocs</span><br></pre></td></tr></table></figure>

<ul>
<li><p>安裝 </p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">yum install man-pages -y; yum install man -y</span><br></pre></td></tr></table></figure></li>
<li><p>更新 mandb</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">mandb</span><br></pre></td></tr></table></figure></li>
<li><p>安裝 <code>vim</code> 套件測試</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">yum install vim</span><br></pre></td></tr></table></figure></li>
<li><p>測試</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">man vim</span><br></pre></td></tr></table></figure></li>
</ul>
<p>可以用了</p>
<br>
<br>
<br>


<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h2><ul>
<li><p><strong>當執行 Docker build 時, 如果不想要 context 中的某些資料夾或檔案被上傳到 docker daemon 去, 可以怎麼做？</strong> 建立一個 dockerignore 檔案, 並將不想上傳的檔案或資料夾加進去</p>
</li>
<li><p><strong>如果不想使用預設的 <code>dockerfile</code>, 可以怎麼做？</strong> <code>docker -t -f dockerFileNameYouWant .</code></p>
</li>
<li><p><strong>在 Docker CLI, 哪一個 flag 可以指定環境變數？</strong>  <code>-e</code></p>
</li>
<li><p><strong>在 Docker CLI, 哪一個 MYSQL 的 flag 可以允許空的密碼？</strong>  <code>-e MYSQL_ALLOW_EMPTY_PASSWORD=yes</code> </p>
</li>
<li><p><strong>在 Docker CLI, 哪一個 flag 可以指定 volume？</strong>  <code>-v</code></p>
</li>
<li><p><strong>如何列出 volume 清單？</strong> <code>docker volume ls</code></p>
</li>
<li><p><strong>如何列出指定 volume 訊息？</strong> <code>docker volume inspect volumeName</code></p>
</li>
<li><p><strong>Docker 中, 預設的網路模式是？</strong> Bridge</p>
</li>
<li><p><strong>可透過何種方式證明 Docker 預設容器可互聯互通？</strong> 在容器內取得 ip, 並使用 ping</p>
</li>
<li><p><strong>當使用 –link 來連接到一個容器時, 實際上容器做了什麼事, 讓我們可以直接使用名字連接？</strong> Docker 在 /etc/hosts 裡頭將 IP 以及該容器名稱做連結</p>
</li>
<li><p><strong>Docker 當中, <code>--link</code> 是單向還是雙向的？</strong> 單向</p>
</li>
<li><p><strong>Docker 當中, <code>--network</code> 是單向還是雙向的？</strong> 雙向</p>
</li>
<li><p><strong>docker –network host 只在哪一個 OS 上有用</strong> Linux</p>
</li>
<li><p><strong>docker –network container 的效果?</strong> 與指定的 container 共用網路</p>
</li>
<li><p><strong>docker –network host 的效果?</strong> 與當前宿主機同網路, 換言之, 不需 port binding</p>
</li>
<li><p><strong>docker –network none 的效果？</strong> 不為容器配置任何網路</p>
</li>
<li><p><strong>以下的 Docker command 會輸出什麼？</strong> Hello, Cloud Man 。 環境變量 <code>name</code> 已經被值 <code>Cloud Man</code> 替換掉了</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-keyword">ENV</span> name Cloud Man</span><br><span class="line"><span class="hljs-keyword">ENTRYPOINT</span><span class="hljs-language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$name</span>&quot;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>以下的 Docker command 會輸出什麼？</strong> Hello, $name 。 環境變量沒有被替換</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-keyword">ENV</span> name Cloud Man  </span><br><span class="line"><span class="hljs-keyword">ENTRYPOINT</span><span class="hljs-language-bash"> [<span class="hljs-string">&quot;/bin/echo&quot;</span>, <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$name</span>&quot;</span>]</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>以下的 Docker command 中, 如果要使輸出使用環境變量, 該怎麼修改？</strong> 在 <code>/bin/echo</code> 跟 <code>Hello, $name</code> 之間新增 command <code>-c</code></p>
<figure class="highlight dockerfile hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-keyword">ENV</span> name Cloud Man  </span><br><span class="line"><span class="hljs-keyword">ENTRYPOINT</span><span class="hljs-language-bash"> [<span class="hljs-string">&quot;/bin/echo&quot;</span>, <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$name</span>&quot;</span>]</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>Docker 中, apt-get update 和 apt-get install 建議放在同一個 RUN 指令中執行, 為什麼？</strong> Docker 會使用 Cache 如果指令沒有改變的話。 要是將這兩個指令分開了, 當執行到 <code>apt-get update</code> 時, 由於指令沒有變更, 所以 docker 使用緩存, 但是 <code>apt-get install</code> 這層的指令變了, 可能會變成使用很久之前的緩存來安裝新的套件的情況, 這樣就找不到套件了。</p>
</li>
<li><p><strong>Docker 中, CMD 允許被使用者替換嗎？</strong> 允許</p>
</li>
<li><p><strong>Docker 中, 如果 CMD 已有設定, 但 docker run 之後沒有指令命令, 那 container 會執行哪一個命令？</strong> CMD </p>
</li>
<li><p><strong>如果 Dockerfile 中有多個 CMD, 哪一個為準？</strong> 只有最後一個 CMD 有效</p>
</li>
<li><p><strong>CMD 有幾種格式？</strong> 三種</p>
</li>
<li><p><strong>CMD 有哪三種格式？</strong> exec, shell, CMD [“param1”, “param2”]</p>
</li>
<li><p><strong>在 Docker image 中, CMD 設定為 [“/bin/echo”, “Hello World”], 執行 <code>docker run -it [image] /bin/bash</code> 時, 會怎麼樣？</strong> 會只執行 <code>/bin/bash</code></p>
</li>
<li><p><strong>Docker 中, ENTRYPOINT 有幾種格式？</strong> 兩種？</p>
</li>
<li><p><strong>Docker 中, ENTRYPOINT 有哪兩種格式？</strong> exec, shell</p>
</li>
<li><p><strong>Docker 中, ENTRYPOINT 的參數可以被動態替換掉嗎？</strong> 不行</p>
</li>
<li><p><strong>在 Docker image 中, ENTRYPOINT 的設定為 [“/bin/echo”, “Hello”], CMD 為[“world”], 當我執行容器 <code>docker run -it [image]</code>, 輸出為？</strong> Hello world</p>
</li>
<li><p><strong>在 Docker image 中, ENTRYPOINT 的設定為 [“/bin/echo”, “Hello”], CMD 為[“world”], 當我執行容器 <code>docker run -it [image] Ray</code>, 輸出為？</strong> Hello Ray</p>
</li>
<li><p><strong>在 Docker image 中, ENTRYPOINT 為 shell 格式時, CMD 跟 docker run 的參數會？</strong> 被無視</p>
</li>
<li><p><strong>在 Dockerfile 中, 哪三個指令會增加新的層數？</strong> RUN, ADD, COPY</p>
</li>
<li><p><strong>在多階段構建中, 如何從指定層數 COPY 東西過來當層</strong> 藉由 <code>AS</code> 給該層一個名字, 然後使用 <code>COPY --from NAME</code> </p>
</li>
<li><p><strong>在 Docker 中, 如何使用 ENV 來更新 PATH 環境變量？</strong> 如下</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-keyword">ENV</span> PATH /new/directory:$PATH</span><br></pre></td></tr></table></figure></li>
<li><p><strong>在 Docker 中, 當 COPY 的內容變了, 緩存是否會失效？</strong> 會哦</p>
</li>
</ul>
<br>
<br>
<br>

<h2 id="使用-docker-compose-部署-Laravel-LEMP"><a href="#使用-docker-compose-部署-Laravel-LEMP" class="headerlink" title="使用 docker-compose 部署 Laravel-LEMP"></a>使用 docker-compose 部署 Laravel-LEMP</h2><h3 id="下載專案並安裝依賴"><a href="#下載專案並安裝依賴" class="headerlink" title="下載專案並安裝依賴"></a>下載專案並安裝依賴</h3><ul>
<li><p>下載專案</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">git <span class="hljs-built_in">clone</span> https://github.com/laravel/laravel.git laravel-app</span><br></pre></td></tr></table></figure></li>
<li><p>進到資料夾</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">cd</span> laravel-app</span><br></pre></td></tr></table></figure></li>
<li><p>安裝依賴套件</p>
<ul>
<li><code>-v</code> 同步當層目錄與容器內的 /app</li>
<li>執行命令 composer install</li>
<li><code>--rm</code> 當容器關閉時, 自動刪除容器</li>
<li>容器建立時, 外頭的 <code>laravel-app</code> 會與容器內的 <code>/app</code> 同步, 這時候在容器內部的 <code>/app</code> 執行 composer install, 安裝在容器內部 <code>/app</code> 資料夾內的 composer 套件會即時的同步到外頭的 <code>laravel-app</code> 資料夾內。 執行完畢後, 容器沒有其餘的任務, 因此容器會關閉, <code>--rm</code> 會自動刪除容器</li>
<li>更多 docker composer 的應用可參考<a target="_blank" rel="noopener" href="https://hub.docker.com/_/composer">官方文件</a></li>
</ul>
</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker run --<span class="hljs-built_in">rm</span> -v $(<span class="hljs-built_in">pwd</span>):/app composer install</span><br></pre></td></tr></table></figure>
<ul>
<li>更改權限<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">sudo <span class="hljs-built_in">chown</span> -R <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> ~/laravel-app</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h3 id="建立-Docker-Compose-檔案"><a href="#建立-Docker-Compose-檔案" class="headerlink" title="建立 Docker Compose 檔案"></a>建立 Docker Compose 檔案</h3><ul>
<li><p>建立並打開 docker-compose 設定檔</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">vim ~/laravel-app/docker-compose.yml</span><br></pre></td></tr></table></figure></li>
<li><p>在 <code>docker-compose</code> 檔案中, 你將會自定義三個服務： <code>app</code>, <code>webserver</code>, 以及 <code>db</code> 。 在檔案中輸入以下的代碼, 別忘了將 <code>MY_SQL_ROOT_PASSWORD</code> 替換成你自己的密碼</p>
</li>
</ul>
<figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-comment"># 版本</span></span><br><span class="line"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span></span><br><span class="line"><span class="hljs-attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">#PHP Service</span></span><br><span class="line">  <span class="hljs-attr">app:</span></span><br><span class="line">    <span class="hljs-comment"># 這裡建構客製鏡像, Dockerfile 之後會提到</span></span><br><span class="line">    <span class="hljs-attr">build:</span></span><br><span class="line">      <span class="hljs-comment"># 上下文目錄為當層</span></span><br><span class="line">      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span></span><br><span class="line">      <span class="hljs-comment"># Dockerfile 為當層的 dockerfile</span></span><br><span class="line">      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span></span><br><span class="line">    <span class="hljs-comment"># 客製化鏡像的名稱</span></span><br><span class="line">    <span class="hljs-attr">image:</span> <span class="hljs-string">digitalocean.com/php</span></span><br><span class="line">    <span class="hljs-comment"># 容器名稱, 若不指定也可, 但 docker 會用歷史名人命名</span></span><br><span class="line">    <span class="hljs-attr">container_name:</span> <span class="hljs-string">app</span></span><br><span class="line">    <span class="hljs-comment"># 若停止自動重啟</span></span><br><span class="line">    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span></span><br><span class="line">    <span class="hljs-comment"># 為避免容器開啟後即關閉, 設定 tty: true</span></span><br><span class="line">    <span class="hljs-attr">tty:</span> <span class="hljs-literal">true</span></span><br><span class="line">    <span class="hljs-comment"># 環境變數</span></span><br><span class="line">    <span class="hljs-attr">environment:</span></span><br><span class="line">      <span class="hljs-attr">SERVICE_NAME:</span> <span class="hljs-string">app</span></span><br><span class="line">      <span class="hljs-attr">SERVICE_TAGS:</span> <span class="hljs-string">dev</span></span><br><span class="line">    <span class="hljs-comment"># 當前工作目錄</span></span><br><span class="line">    <span class="hljs-attr">working_dir:</span> <span class="hljs-string">/var/www</span></span><br><span class="line">    <span class="hljs-comment"># 持久化數據</span></span><br><span class="line">    <span class="hljs-attr">volumes:</span></span><br><span class="line">      <span class="hljs-comment"># 將當層目錄與容器內的 /var/www 同步</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">./:/var/www</span></span><br><span class="line">      <span class="hljs-comment"># 將當層目錄下的 php/local.ini 與容器內的 /usr/local/etc/php/conf.d/local.ini 同步</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">./php/local.ini:/usr/local/etc/php/conf.d/local.ini</span></span><br><span class="line">    <span class="hljs-comment"># 使用的網路為 app-network</span></span><br><span class="line">    <span class="hljs-attr">networks:</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">#Nginx Service</span></span><br><span class="line">  <span class="hljs-attr">webserver:</span></span><br><span class="line">    <span class="hljs-comment"># 使用官方 nginx:alpine 鏡像</span></span><br><span class="line">    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:alpine</span></span><br><span class="line">    <span class="hljs-comment"># 容器名稱, 若不指定也可, 但 docker 會用歷史名人命名</span></span><br><span class="line">    <span class="hljs-attr">container_name:</span> <span class="hljs-string">webserver</span></span><br><span class="line">    <span class="hljs-comment"># 若停止自動重啟</span></span><br><span class="line">    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span></span><br><span class="line">    <span class="hljs-comment"># 為避免容器開啟後即關閉, 設定 tty: true</span></span><br><span class="line">    <span class="hljs-attr">tty:</span> <span class="hljs-literal">true</span></span><br><span class="line">    <span class="hljs-comment"># 將容器內的 80, 443 port 跟宿主機的 80, 443 port 對接</span></span><br><span class="line">    <span class="hljs-attr">ports:</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;443:443&quot;</span></span><br><span class="line">    <span class="hljs-comment"># 持久化數據</span></span><br><span class="line">    <span class="hljs-attr">volumes:</span></span><br><span class="line">      <span class="hljs-comment"># 將當層目錄與容器內的 /var/www 同步</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">./:/var/www</span></span><br><span class="line">      <span class="hljs-comment"># 將當層目錄下的 nginx/conf.d/ 與容器內的 /etc/nginx/conf.d/ 目錄同步</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx/conf.d/:/etc/nginx/conf.d/</span></span><br><span class="line">    <span class="hljs-comment"># 使用的網路為 app-network</span></span><br><span class="line">    <span class="hljs-attr">networks:</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">#MySQL Service</span></span><br><span class="line">  <span class="hljs-attr">db:</span></span><br><span class="line">    <span class="hljs-comment"># 使用官方 mysql:5.7.22 鏡像</span></span><br><span class="line">    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7.22</span></span><br><span class="line">    <span class="hljs-comment"># 容器名稱, 若不指定也可, 但 docker 會用歷史名人命名</span></span><br><span class="line">    <span class="hljs-attr">container_name:</span> <span class="hljs-string">db</span></span><br><span class="line">    <span class="hljs-comment"># 若停止自動重啟</span></span><br><span class="line">    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span></span><br><span class="line">    <span class="hljs-comment"># 為避免容器開啟後即關閉, 設定 tty: true</span></span><br><span class="line">    <span class="hljs-attr">tty:</span> <span class="hljs-literal">true</span></span><br><span class="line">    <span class="hljs-comment"># 將容器內的 3306 port 跟宿主機的 3306 port 對接</span></span><br><span class="line">    <span class="hljs-attr">ports:</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="hljs-comment"># 設定環境變數</span></span><br><span class="line">    <span class="hljs-attr">environment:</span></span><br><span class="line">      <span class="hljs-comment"># 資料庫名稱, 可自定義</span></span><br><span class="line">      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">laravel</span></span><br><span class="line">      <span class="hljs-comment"># 資料庫密碼, 可自定義</span></span><br><span class="line">      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">your_mysql_root_password</span></span><br><span class="line">      <span class="hljs-attr">SERVICE_TAGS:</span> <span class="hljs-string">dev</span></span><br><span class="line">      <span class="hljs-attr">SERVICE_NAME:</span> <span class="hljs-string">mysql</span></span><br><span class="line">    <span class="hljs-comment"># 持久化數據</span></span><br><span class="line">    <span class="hljs-attr">volumes:</span></span><br><span class="line">      <span class="hljs-comment"># 將自定義的數據卷 dbdata 跟容器內的 /var/lib/mysql/ 目錄做同步</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">dbdata:/var/lib/mysql/</span></span><br><span class="line">      <span class="hljs-comment"># 將當層目錄下的 mysql/my.cnf 跟容器內的 /etc/mysql/my.cnf 做同步</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql/my.cnf:/etc/mysql/my.cnf</span></span><br><span class="line">    <span class="hljs-comment"># 使用的網路為 app-network</span></span><br><span class="line">    <span class="hljs-attr">networks:</span></span><br><span class="line">      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#Docker Networks</span></span><br><span class="line"><span class="hljs-attr">networks:</span></span><br><span class="line">  <span class="hljs-comment"># 定義 network 名稱</span></span><br><span class="line">  <span class="hljs-attr">app-network:</span></span><br><span class="line">    <span class="hljs-comment"># 定義 network driver 為 bridge, 還有其他類型如 host, none, container 等等...</span></span><br><span class="line">    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span></span><br><span class="line"><span class="hljs-comment">#Volumes</span></span><br><span class="line"><span class="hljs-attr">volumes:</span></span><br><span class="line">  <span class="hljs-comment"># 定義數據卷名稱</span></span><br><span class="line">  <span class="hljs-attr">dbdata:</span></span><br><span class="line">    <span class="hljs-comment"># 定義數據卷類型</span></span><br><span class="line">    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>app</strong>: <ul>
<li>運行 Laravel </li>
<li>build 客制鏡像 <code>digitalocean.com/php</code>, 下面會有建立的 dockerfile</li>
<li>使用客製的鏡像 <code>digitalocean.com/php</code>, </li>
<li>將當前工作目錄設在了 <code>/var/www</code></li>
</ul>
</li>
<li><strong>webserver</strong>: <ul>
<li>使用官方 <code>nginx:aline</code> 鏡像</li>
<li>將容器內的 80 以及 443 port 接到宿主機的 80 以及 443 port</li>
</ul>
</li>
<li><strong>db</strong>: <ul>
<li>使用官方 <code>mysql:5.7.22</code> 鏡像</li>
<li>定義一些環境變數, 包含資料庫名稱, 資料庫密碼, 這部分可以依個人需求更改</li>
<li>將容器內的 3306 接到宿主機的 3306 port</li>
</ul>
</li>
<li>我們把容器名稱跟服務名稱定義成一樣, 如果我們不定義容器名稱, Docker 會自動使用歷史上有名的人物的名稱來命名</li>
<li>我們為不同容器群組定義了專屬的 network, 位於相同 network 下的容器可以互相溝通, 反之則不行, 這確保了高等級的安全性, 不同類型的容器群不可以互相溝通, 像是前端只能跟前端溝通, 後端跟後端</li>
</ul>
<br>
<br>
<br>

<h3 id="建立-Dockerfile"><a href="#建立-Dockerfile" class="headerlink" title="建立 Dockerfile"></a>建立 Dockerfile</h3><figure class="highlight yaml hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-comment"># 使用官方 php:7.3-fpm</span></span><br><span class="line"><span class="hljs-string">FROM</span> <span class="hljs-string">php:7.3-fpm</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 複製 composer.lock 以及 composer.json 從上下文資料夾複製到鏡像內的 /var/www/</span></span><br><span class="line"><span class="hljs-string">COPY</span> <span class="hljs-string">composer.lock</span> <span class="hljs-string">composer.json</span> <span class="hljs-string">/var/www/</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 設定工作目錄為 /var/www</span></span><br><span class="line"><span class="hljs-string">WORKDIR</span> <span class="hljs-string">/var/www</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 安裝依賴</span></span><br><span class="line"><span class="hljs-comment"># mariadb-client</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">apt-get</span> <span class="hljs-string">update</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">apt-get</span> <span class="hljs-string">install</span> <span class="hljs-string">-y</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">build-essential</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">mariadb-client</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">mysql-client</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">libpng-dev</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">libjpeg62-turbo-dev</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">libfreetype6-dev</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">locales</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">zip</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">jpegoptim</span> <span class="hljs-string">optipng</span> <span class="hljs-string">pngquant</span> <span class="hljs-string">gifsicle</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">vim</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">unzip</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">git</span> <span class="hljs-string">\</span></span><br><span class="line">    <span class="hljs-string">curl</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 清除 /var/cache/apt/archives 下的所有 deb 檔, 以及清除 /var/lib/apt/lists/ 下的所有安裝檔</span></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">apt-get</span> <span class="hljs-string">clean</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">rm</span> <span class="hljs-string">-rf</span> <span class="hljs-string">/var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 安裝 extensions</span></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">docker-php-ext-install</span> <span class="hljs-string">pdo_mysql</span> <span class="hljs-string">mbstring</span> <span class="hljs-string">zip</span> <span class="hljs-string">exif</span> <span class="hljs-string">pcntl</span></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">docker-php-ext-configure</span> <span class="hljs-string">gd</span> <span class="hljs-string">--with-gd</span> <span class="hljs-string">--with-freetype-dir=/usr/include/</span> <span class="hljs-string">--with-jpeg-dir=/usr/include/</span> <span class="hljs-string">--with-png-dir=/usr/include/</span></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">docker-php-ext-install</span> <span class="hljs-string">gd</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Install composer</span></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">curl</span> <span class="hljs-string">-sS</span> <span class="hljs-string">https://getcomposer.org/installer</span> <span class="hljs-string">|</span> <span class="hljs-string">php</span> <span class="hljs-string">--</span> <span class="hljs-string">--install-dir=/usr/local/bin</span> <span class="hljs-string">--filename=composer</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 建立 laravel 應用 user</span></span><br><span class="line"><span class="hljs-comment"># 建立 group www 並指定 GID 為 1001</span></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">groupadd</span> <span class="hljs-string">-g</span> <span class="hljs-number">1001 </span><span class="hljs-string">www</span></span><br><span class="line"><span class="hljs-comment"># 建立 user www 並指定 UID 為 1001, 將之加入群組 www</span></span><br><span class="line"><span class="hljs-string">RUN</span> <span class="hljs-string">useradd</span> <span class="hljs-string">-u</span> <span class="hljs-number">1001</span> <span class="hljs-string">-ms</span> <span class="hljs-string">/bin/bash</span> <span class="hljs-string">-g</span> <span class="hljs-string">www</span> <span class="hljs-string">www</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 複製檔案以及重新定義權限</span></span><br><span class="line"><span class="hljs-string">COPY</span> <span class="hljs-string">--chown=www:www</span> <span class="hljs-string">.</span> <span class="hljs-string">/var/www</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 將使用者切換到 www</span></span><br><span class="line"><span class="hljs-string">USER</span> <span class="hljs-string">www</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 暴露 9000 port</span></span><br><span class="line"><span class="hljs-string">EXPOSE</span> <span class="hljs-number">9000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 執行 php-fpm</span></span><br><span class="line"><span class="hljs-string">CMD</span> [<span class="hljs-string">&quot;php-fpm&quot;</span>]</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h3 id="PHP-設定檔"><a href="#PHP-設定檔" class="headerlink" title="PHP 設定檔"></a>PHP 設定檔</h3><p>現在我們需要建一個 PHP 設定檔來同步宿主機以及容器內</p>
<ul>
<li><p>建立資料夾</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">mkdir</span> ~/laravel-app/php</span><br></pre></td></tr></table></figure></li>
<li><p>設定檔</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">vim ~/laravel-app/php/local.ini</span><br></pre></td></tr></table></figure></li>
<li><p>設定檔內容範例, 你可以添加其他設定</p>
<figure class="highlight plaintext hljs"><table><tr><td class="code"><pre><span class="line"># 單檔的最大上傳限制</span><br><span class="line">upload_max_filesize=40M</span><br><span class="line"></span><br><span class="line"># 整個 post 的最大限制</span><br><span class="line">post_max_size=40M</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h3 id="Nginx-設定檔"><a href="#Nginx-設定檔" class="headerlink" title="Nginx 設定檔"></a>Nginx 設定檔</h3><ul>
<li><p>建立資料夾 </p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">mkdir</span> -p ~/laravel-app/nginx/conf.d</span><br></pre></td></tr></table></figure></li>
<li><p>建立設定檔</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">vim ~/laravel-app/nginx/conf.d/app.conf</span><br></pre></td></tr></table></figure></li>
<li><p>範例設定檔內容, 可視需求添加</p>
<figure class="highlight nginx hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-section">server</span> &#123;</span><br><span class="line">    <span class="hljs-comment"># 監聽 80 port</span></span><br><span class="line">    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># 尋找 index.php index.html</span></span><br><span class="line">    <span class="hljs-attribute">index</span> index.php index.html;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># error log 位置</span></span><br><span class="line">    <span class="hljs-attribute">error_log</span>  /var/log/nginx/<span class="hljs-literal">error</span>.log;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># access log 位置</span></span><br><span class="line">    <span class="hljs-attribute">access_log</span> /var/log/nginx/access.log;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># 資源的默認位置</span></span><br><span class="line">    <span class="hljs-attribute">root</span> /var/www/public;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"># 如果請求是 php 結尾的話, 進到 location</span></span><br><span class="line">    <span class="hljs-section">location</span> <span class="hljs-regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="hljs-comment"># 尋找 uri, 若沒找到則 404</span></span><br><span class="line">        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> =<span class="hljs-number">404</span>;</span><br><span class="line">        <span class="hljs-comment"># </span></span><br><span class="line">        <span class="hljs-attribute">fastcgi_split_path_info</span><span class="hljs-regexp"> ^(.+\.php)(/.+)$</span>;</span><br><span class="line">        <span class="hljs-attribute">fastcgi_pass</span> app:<span class="hljs-number">9000</span>;</span><br><span class="line">        <span class="hljs-attribute">fastcgi_index</span> index.php;</span><br><span class="line">        <span class="hljs-attribute">include</span> fastcgi_params;</span><br><span class="line">        <span class="hljs-attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="hljs-variable">$document_root</span><span class="hljs-variable">$fastcgi_script_name</span>;</span><br><span class="line">        <span class="hljs-attribute">fastcgi_param</span> PATH_INFO <span class="hljs-variable">$fastcgi_path_info</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-section">location</span> / &#123;</span><br><span class="line">        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.php?<span class="hljs-variable">$query_string</span>;</span><br><span class="line">        <span class="hljs-attribute">gzip_static</span> <span class="hljs-literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h3 id="設定-MySQL"><a href="#設定-MySQL" class="headerlink" title="設定 MySQL"></a>設定 MySQL</h3><ul>
<li><p>建立資料夾</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">mkdir</span> ~/laravel-app/mysql</span><br></pre></td></tr></table></figure></li>
<li><p>建立設定檔</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">vim ~/laravel-app/mysql/my.cnf</span><br></pre></td></tr></table></figure></li>
<li><p>輸入設定檔內容, 可自行添加</p>
<figure class="highlight plaintext hljs"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># 產生 log</span><br><span class="line">general_log = 1</span><br><span class="line"></span><br><span class="line"># log 位址</span><br><span class="line">general_log_file = /var/lib/mysql/general.log</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
<br>
<br>

<h3 id="運行容器以及修改-env-設定"><a href="#運行容器以及修改-env-設定" class="headerlink" title="運行容器以及修改 env 設定"></a>運行容器以及修改 env 設定</h3><ul>
<li><p>建立 .env</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line"><span class="hljs-built_in">cp</span> .env.example .<span class="hljs-built_in">env</span></span><br></pre></td></tr></table></figure></li>
<li><p>運行容器</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></li>
<li><p>查看容器</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></li>
<li><p>修改 .env 檔</p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker-compose <span class="hljs-built_in">exec</span> app vim .<span class="hljs-built_in">env</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext hljs"><table><tr><td class="code"><pre><span class="line">DB_CONNECTION=mysql</span><br><span class="line"># DB 容器服務</span><br><span class="line">DB_HOST=db</span><br><span class="line">DB_PORT=3306</span><br><span class="line"># 上面設定的 databaseName</span><br><span class="line">DB_DATABASE=laravel</span><br><span class="line"># 上面設定的 userName</span><br><span class="line">DB_USERNAME=laraveluser</span><br><span class="line"># 上面設定的 password</span><br><span class="line">DB_PASSWORD=your_laravel_db_password</span><br></pre></td></tr></table></figure>

<ul>
<li><p>產生 key </p>
<figure class="highlight bash hljs"><table><tr><td class="code"><pre><span class="line">docker-compose <span class="hljs-built_in">exec</span> app php artisan key:generate</span><br></pre></td></tr></table></figure></li>
<li><p>開啟 cache</p>
</li>
</ul>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Image/">#Docker Image</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Container/">#Docker Container</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Swarm/">#Docker Swarm</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Multi-Stage/">#Docker Multi Stage</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Compose/">#Docker Compose</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Service/">#Docker Service</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Rolling-Update/">#Docker Rolling Update</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Push/">#Docker Push</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/zh-tw/tags/Docker-Deployment/">#Docker Deployment</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/zh-tw/Node-js/">Node.js 學習筆記</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/zh-tw/kubernetesEngineQwikStart/">Kubernetes Engine - 入門</a>
            
        </span>
    </div>
    
</article>


<div class="sharebox">
    
<div class="sharethis-inline-share-buttons"></div>
<script type='text/javascript' src='//platform-api.sharethis.com/js/sharethis.js#property=5c72643b9ea706001139fd89&amp;product=inline-share-buttons' async='async'></script>

</div>



<div class="comments">
    <h3 class="title is-4">留言</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'https://tn710617.github.io/zh-tw/docker/';
        this.page.identifier = 'zh-tw/docker/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'rayscodingjourney' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2022 Ray&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
            <script>
                mermaid.initialize({ theme: 'default' });
            </script>

            
            
            <a class="navbar-item" title="GitHub" target="_blank" rel="noopener" href="https://github.com/tn710617">
                
                    <i class="fab fa-github"></i>
                
            </a>
            
            <a class="navbar-item" title="Medium" target="_blank" rel="noopener" href="https://medium.com/@raycodingjourney">
                
                    <i class="fab fa-medium"></i>
                
            </a>
            
            <a class="navbar-item" title="Linkedin" target="_blank" rel="noopener" href="https://www.linkedin.com/in/ray-lee-99315315a">
                
                    <i class="fab fa-linkedin"></i>
                
            </a>
            
            <a class="navbar-item" title="Facebook" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=100001626039430">
                
                    <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="navbar-item" title="CakeResume" target="_blank" rel="noopener" href="https://www.cakeresume.com/resumes/ray-6edaef/edit">
                
                    <i class="far fa-address-card"></i>
                
            </a>
            
            <a class="navbar-item" title="E-Mail" href="mailto:tn710617@gmail.com">
                
                    <i class="far fa-envelope"></i>
                
            </a>
            
            <a class="navbar-item" title="Skype" href="skype:adad0310?call|chat">
                
                    <i class="fab fa-skype"></i>
                
            </a>
            
            

        </div>
    </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站內搜尋" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '頁面',
                CATEGORIES: '分類',
                TAGS: '標籤',
                UNTITLED: '(無標題)',
            },
            CONTENT_URL: '/content.zh-tw.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>